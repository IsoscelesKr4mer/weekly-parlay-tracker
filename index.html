<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantasy Football Parlay Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .tabs {
            display: flex;
            background: #f5f5f5;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            background: #e0e0e0;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            background: white;
            color: #4CAF50;
        }
        
        .tab:hover {
            background: #d5d5d5;
        }
        
        .tab.active:hover {
            background: white;
        }
        
        .tab-content {
            padding: 30px;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: block;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        
        .form-group input, .form-group select {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }
        
        .picks-container {
            margin-top: 30px;
        }
        
        .pick-slot {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        .pick-slot.filled {
            border-color: #4CAF50;
            background: linear-gradient(135deg, #f0f9ff, #e0f7fa);
        }
        
        .pick-slot.win {
            background: linear-gradient(135deg, #e8f5e8, #d4edda);
            border-color: #4CAF50;
            box-shadow: 0 6px 16px rgba(76, 175, 80, 0.2);
        }
        
        .pick-slot.loss {
            background: linear-gradient(135deg, #fdeaea, #f8d7da);
            border-color: #f44336;
            box-shadow: 0 6px 16px rgba(244, 67, 54, 0.2);
        }
        
        .pick-slot.draw {
            background: linear-gradient(135deg, #fff3e0, #ffe0b3);
            border-color: #FF9800;
            box-shadow: 0 6px 16px rgba(255, 152, 0, 0.2);
        }
        
        .sgp-group {
            border: 3px solid #FF9800;
            border-radius: 15px;
            background: linear-gradient(135deg, rgba(255, 152, 0, 0.1), rgba(255, 224, 179, 0.1));
            padding: 15px;
            padding-top: 25px;
            margin-bottom: 25px;
            position: relative;
        }
        
        .sgp-group::before {
            content: "üéØ Same Game Parlay";
            position: absolute;
            top: -12px;
            left: 20px;
            background: #FF9800;
            color: white;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .sgp-odds-container {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 15px;
        }
        
        .sgp-odds-field {
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            border: 2px solid #FF9800;
            border-radius: 8px;
            padding: 8px 12px;
        }
        
        .sgp-odds-field label {
            font-size: 14px;
            font-weight: bold;
            color: #FF9800;
            margin: 0;
            white-space: nowrap;
        }
        
        .sgp-odds-field input {
            width: 120px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            color: #333;
        }
        
        .sgp-odds-field input::placeholder {
            color: #999;
            font-weight: normal;
        }
        
        .sgp-odds-field input:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .pick-slot.sgp-pick .pick-slot-field input[id*="odds"],
        .pick-slot.sgp-pick .pick-slot-field input[id*="odds"]:focus {
            text-decoration: line-through;
            color: #999;
            background: #f9f9f9;
            border-color: #ddd;
        }
        
        .pick-slot.sgp-pick .pick-slot-field label[for*="odds"]:after {
            content: " (not used in SGP)";
            font-size: 10px;
            color: #999;
            font-weight: normal;
        }
        
        .pick-slot.sgp-pick {
            background: rgba(255, 152, 0, 0.05);
            border-color: #FFB74D;
            margin-bottom: 15px;
        }
        
        .pick-slot.sgp-pick:last-child {
            margin-bottom: 0;
        }
        
        .pick-slot.in-sgp {
            opacity: 1;
            background: rgba(255, 152, 0, 0.05);
            border-color: #FFB74D;
            position: relative;
        }
        
        .pick-slot.in-sgp::after {
            content: "üîó Grouped in SGP above";
            position: absolute;
            top: 10px;
            right: 15px;
            background: #FF9800;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .pick-slot.saved {
            border: 3px solid #4CAF50;
            background: linear-gradient(135deg, #e8f5e8, #d4edda);
            transform: none;
            transition: all 0.3s ease;
        }
        
        .save-indicator {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #4CAF50;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            animation: saveSuccess 2s ease-in-out;
            z-index: 10;
        }
        
        @keyframes saveSuccess {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .pick-slot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        @media (max-width: 600px) {
            .pick-slot-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .pick-slot-header > div {
                width: 100%;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
        }
        
        .pick-slot-fields {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        @media (max-width: 1200px) {
            .pick-slot-fields {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 900px) {
            .pick-slot-fields {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 600px) {
            .pick-slot-fields {
                grid-template-columns: 1fr;
            }
        }
        
        .pick-slot-field {
            display: flex;
            flex-direction: column;
        }
        
        .pick-slot-field label {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 5px;
            color: #666;
        }
        
        .pick-slot-field input,
        .pick-slot-field select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            min-width: 0; /* Allow fields to shrink */
            width: 100%;
        }
        
        .pick-slot-field input:focus,
        .pick-slot-field select:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .result-indicator {
            font-weight: bold;
            font-size: 20px;
            padding: 8px 16px;
            border-radius: 8px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .result-indicator.win {
            background: #4CAF50;
            color: white;
        }
        
        .result-indicator.loss {
            background: #f44336;
            color: white;
        }
        
        .result-indicator.draw {
            background: #FF9800;
            color: white;
        }
        
        .result-indicator.pending {
            background: #757575;
            color: white;
        }
        
        .result-buttons {
            display: flex;
            gap: 8px;
            margin-top: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        @media (max-width: 600px) {
            .result-buttons {
                justify-content: stretch;
            }
            
            .result-btn {
                flex: 1;
                min-width: 70px;
            }
        }
        
        .result-btn {
            padding: 10px 16px;
            font-size: 14px;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 80px;
        }
        
        .result-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .result-btn.win {
            background: #4CAF50;
            color: white;
        }
        
        .result-btn.loss {
            background: #f44336;
            color: white;
        }
        
        .result-btn.draw {
            background: #FF9800;
            color: white;
        }
        
        .result-btn.save {
            background: #2196F3;
            color: white;
        }
        
        .result-btn.reset {
            background: #757575;
            color: white;
        }
        
        .pick-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .pick-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }
        
        .summary-card {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .summary-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
        }
        
        .summary-item h3 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }
        
        .leaderboard {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        
        .leaderboard-header {
            background: linear-gradient(135deg, #9C27B0, #7B1FA2);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .leaderboard table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .leaderboard th, .leaderboard td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .leaderboard th {
            background: #f5f5f5;
            font-weight: 600;
        }
        
        .leaderboard tr:nth-child(even) {
            background: #fafafa;
        }
        
        .same-game-indicator {
            background: #FF9800;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .week-selector {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .week-selector > div {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        @media (max-width: 768px) {
            .week-selector {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }
            
            .week-selector > div {
                width: 100%;
                justify-content: space-between;
            }
        }
        
        .current-week {
            font-size: 1.2em;
            font-weight: 600;
            color: #4CAF50;
        }
        
        .odds-converter {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .odds-converter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            align-items: end;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèà Fantasy Football Parlay Tracker</h1>
            <p>Collective Hive Mind Betting</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('picks', this)">Weekly Picks</button>
            <button class="tab" onclick="switchTab('summary', this)">Parlay Summary</button>
            <button class="tab" onclick="switchTab('leaderboard', this)">Leaderboard</button>
        </div>
        
        <div class="tab-content">
            <!-- Weekly Picks Tab -->
            <div id="picks" class="tab-pane active">
                <div class="week-selector">
                    <label for="nflWeek">NFL Week:</label>
                    <select id="nflWeek" onchange="updateNFLWeek()">
                        <option value="1">Week 1</option>
                        <option value="2">Week 2</option>
                        <option value="3">Week 3</option>
                        <option value="4">Week 4</option>
                        <option value="5">Week 5</option>
                        <option value="6">Week 6</option>
                        <option value="7">Week 7</option>
                        <option value="8">Week 8</option>
                        <option value="9">Week 9</option>
                        <option value="10">Week 10</option>
                        <option value="11">Week 11</option>
                        <option value="12">Week 12</option>
                        <option value="13">Week 13</option>
                        <option value="14">Week 14</option>
                        <option value="15">Week 15</option>
                        <option value="16">Week 16</option>
                        <option value="17">Week 17</option>
                        <option value="18">Week 18</option>
                        <option value="19">Wild Card</option>
                        <option value="20">Divisional</option>
                        <option value="21">Conference Championship</option>
                        <option value="22">Super Bowl</option>
                    </select>
                    
                    <label for="currentWeek" style="margin-left: 30px;">Parlay Week:</label>
                    <select id="currentWeek" onchange="updateWeek()">
                        <option value="1">Week 1</option>
                        <option value="2">Week 2</option>
                        <option value="3">Week 3</option>
                        <option value="4">Week 4</option>
                        <option value="5">Week 5</option>
                        <option value="6">Week 6</option>
                        <option value="7">Week 7</option>
                        <option value="8">Week 8</option>
                        <option value="9">Week 9</option>
                        <option value="10">Week 10</option>
                        <option value="11">Week 11</option>
                        <option value="12">Week 12</option>
                        <option value="13">Week 13</option>
                        <option value="14">Week 14</option>
                        <option value="15">Week 15</option>
                        <option value="16">Week 16</option>
                        <option value="17">Week 17</option>
                        <option value="18">Week 18</option>
                    </select>
                    <div class="current-week">Parlay Week <span id="weekDisplay">1</span></div>
                    
                    <div style="margin-left: 40px; display: flex; align-items: center; gap: 15px;">
                        <label for="numberOfLegs">Parlay Legs:</label>
                        <select id="numberOfLegs" onchange="generatePickSlots()">
                            <option value="2">2 Legs</option>
                            <option value="3">3 Legs</option>
                            <option value="4">4 Legs</option>
                            <option value="5">5 Legs</option>
                            <option value="6">6 Legs</option>
                            <option value="7">7 Legs</option>
                            <option value="8">8 Legs</option>
                            <option value="9">9 Legs</option>
                            <option value="10">10 Legs</option>
                            <option value="11">11 Legs</option>
                            <option value="12" selected>12 Legs</option>
                            <option value="13">13 Legs</option>
                            <option value="14">14 Legs</option>
                            <option value="15">15 Legs</option>
                            <option value="16">16 Legs</option>
                            <option value="17">17 Legs</option>
                            <option value="18">18 Legs</option>
                            <option value="19">19 Legs</option>
                            <option value="20">20 Legs</option>
                        </select>
                    </div>
                </div>
                
                <div class="odds-converter">
                    <h3>Odds Converter</h3>
                    <div class="odds-converter-grid">
                        <div class="form-group">
                            <label>American Odds</label>
                            <input type="text" id="americanOdds" placeholder="-110" onchange="convertOdds()">
                        </div>
                        <div class="form-group">
                            <label>Decimal Odds</label>
                            <input type="text" id="decimalOdds" placeholder="1.91" onchange="convertFromDecimal()">
                        </div>
                        <div class="form-group">
                            <label>Implied Probability</label>
                            <input type="text" id="impliedProb" readonly>
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; margin-bottom: 30px;">
                    <button class="btn" onclick="saveAllPicks()" style="background: #4CAF50;">üíæ Save All Picks</button>
                    <button class="btn" onclick="clearAllPicks()" style="background: #f44336;">üóëÔ∏è Clear All</button>
                </div>
                
                <div id="pickSlotsContainer">
                    <!-- Pick slots will be generated here -->
                </div>
            </div>
            
            <!-- Parlay Summary Tab -->
            <div id="summary" class="tab-pane">
                <div class="summary-card">
                    <h2>Week <span id="summaryWeek">1</span> Parlay Summary</h2>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <h3 id="totalOdds">+0</h3>
                            <p>Total Parlay Odds</p>
                        </div>
                        <div class="summary-item">
                            <h3 id="totalPicks">0</h3>
                            <p>Total Picks</p>
                        </div>
                        <div class="summary-item">
                            <h3 id="betAmount">$10</h3>
                            <p>Bet Amount</p>
                        </div>
                        <div class="summary-item">
                            <h3 id="potentialWinnings">$0</h3>
                            <p>Potential Winnings</p>
                        </div>
                    </div>
                </div>
                
                <div class="form-group" style="max-width: 200px; margin-bottom: 20px;">
                    <label for="betAmountInput">Bet Amount ($)</label>
                    <input type="number" id="betAmountInput" value="10" min="1" onchange="updateCalculations()">
                </div>
                
                <div class="summary-card">
                    <h3>Payout Breakdown</h3>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <h3 id="grossWinnings">$0</h3>
                            <p>Gross Winnings</p>
                        </div>
                        <div class="summary-item">
                            <h3 id="taxes">$0</h3>
                            <p>Taxes (30%)</p>
                        </div>
                        <div class="summary-item">
                            <h3 id="netWinnings">$0</h3>
                            <p>Net Winnings</p>
                        </div>
                        <div class="summary-item">
                            <h3 id="perPerson">$0</h3>
                            <p>Per Person (Net)</p>
                        </div>
                    </div>
                </div>
                
                <div id="sameGameParlays" style="margin-top: 30px;">
                    <h3>Same Game Parlays</h3>
                    <div id="sameGameContainer">
                        <!-- Same game parlays will be shown here -->
                    </div>
                </div>
            </div>
            
            <!-- Leaderboard Tab -->
            <div id="leaderboard" class="tab-pane">
                <div class="leaderboard">
                    <div class="leaderboard-header">
                        <h2>Season Leaderboard</h2>
                        <p>Track everyone's picking performance</p>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Player</th>
                                <th>Wins</th>
                                <th>Losses</th>
                                <th>Draws</th>
                                <th>Win %</th>
                                <th>Contribution to Winning Parlays</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboardBody">
                            <!-- Leaderboard data will be populated here -->
                        </tbody>
                    </table>
                </div>
                
                <div style="margin-top: 30px;">
                    <button class="btn" onclick="resetLeaderboard()">Reset Season Stats</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <script>
        // Global variables
        let weeklyPicks = {};
        let leaderboardData = {};
        let currentWeek = 1;
        let currentNFLWeek = 1;
        let nflSchedule = {};
        let database = null;

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCSen1b1IDNvRXg96CZXf9PTGURvCga3Cs",
            authDomain: "parlay-picker.firebaseapp.com",
            databaseURL: "https://parlay-picker-default-rtdb.firebaseio.com/",
            projectId: "parlay-picker",
            storageBucket: "parlay-picker.firebasestorage.app",
            messagingSenderId: "1086482831557",
            appId: "1:1086482831557:web:16e5f542a0d48e0dc538ac",
            measurementId: "G-E7F4G8DEN8"
        };

        // Sample NFL schedule data
        const sampleNFLSchedule = {
            1: [
                { id: 'buf-ari', matchup: 'Buffalo Bills @ Arizona Cardinals', time: 'Early', day: 'Sunday' },
                { id: 'pit-atl', matchup: 'Pittsburgh Steelers @ Atlanta Falcons', time: 'Early', day: 'Sunday' },
                { id: 'hou-ind', matchup: 'Houston Texans @ Indianapolis Colts', time: 'Early', day: 'Sunday' },
                { id: 'mia-jax', matchup: 'Miami Dolphins @ Jacksonville Jaguars', time: 'Early', day: 'Sunday' },
                { id: 'ne-cin', matchup: 'New England Patriots @ Cincinnati Bengals', time: 'Early', day: 'Sunday' },
                { id: 'car-no', matchup: 'Carolina Panthers @ New Orleans Saints', time: 'Early', day: 'Sunday' },
                { id: 'min-nyg', matchup: 'Minnesota Vikings @ New York Giants', time: 'Early', day: 'Sunday' },
                { id: 'ten-chi', matchup: 'Tennessee Titans @ Chicago Bears', time: 'Early', day: 'Sunday' },
                { id: 'lac-lv', matchup: 'Los Angeles Chargers @ Las Vegas Raiders', time: 'Late', day: 'Sunday' },
                { id: 'den-sea', matchup: 'Denver Broncos @ Seattle Seahawks', time: 'Late', day: 'Sunday' },
                { id: 'gb-phi', matchup: 'Green Bay Packers @ Philadelphia Eagles', time: 'Late', day: 'Sunday' },
                { id: 'tb-wsh', matchup: 'Tampa Bay Buccaneers @ Washington Commanders', time: 'Late', day: 'Sunday' },
                { id: 'cle-dal', matchup: 'Cleveland Browns @ Dallas Cowboys', time: 'Late', day: 'Sunday' },
                { id: 'sf-lar', matchup: 'San Francisco 49ers @ Los Angeles Rams', time: 'SNF', day: 'Sunday' },
                { id: 'nyj-bal', matchup: 'New York Jets @ Baltimore Ravens', time: 'MNF', day: 'Monday' },
                { id: 'kc-det', matchup: 'Kansas City Chiefs @ Detroit Lions', time: 'TNF', day: 'Thursday' }
            ]
        };
        
        function initializeNFLSchedule() {
            nflSchedule = sampleNFLSchedule;
        }

        // Initialize everything when page loads
        window.onload = function() {
            console.log('Page loaded, initializing...');
            initializeFirebase();
        };

        function initializeFirebase() {
            try {
                // Initialize Firebase
                firebase.initializeApp(firebaseConfig);
                database = firebase.database();
                console.log('Firebase initialized successfully');
                
                // Test connection
                testFirebaseConnection();
                
            } catch (error) {
                console.error('Firebase initialization failed:', error);
                console.log('Running in local mode without real-time sync');
                initializeData();
            }
        }

        async function testFirebaseConnection() {
            try {
                await database.ref('test').set({
                    message: 'Connected',
                    timestamp: Date.now()
                });
                console.log('Firebase connection successful - enabling real-time sync');
                initializeData();
                setupRealtimeListeners();
                
            } catch (error) {
                console.error('Firebase connection failed:', error);
                console.log('Running in local mode');
                initializeData();
            }
        }

        function initializeData() {
            weeklyPicks = {};
            leaderboardData = {};
            currentWeek = 1;
            currentNFLWeek = 1;
            
            initializeNFLSchedule();
            
            document.getElementById('currentWeek').value = currentWeek;
            document.getElementById('nflWeek').value = currentNFLWeek;
            document.getElementById('weekDisplay').textContent = currentWeek;
            document.getElementById('summaryWeek').textContent = currentWeek;
            
            generatePickSlots();
            updateCalculations();
            updateLeaderboard();
        }

        function updateNFLWeek() {
            currentNFLWeek = parseInt(document.getElementById('nflWeek').value);
            generatePickSlots();
        }

        function updateWeek() {
            currentWeek = parseInt(document.getElementById('currentWeek').value);
            document.getElementById('weekDisplay').textContent = currentWeek;
            document.getElementById('summaryWeek').textContent = currentWeek;
            generatePickSlots();
            updateCalculations();
        }

        // Firebase Database Functions
        async function savePicksToFirebase(week, picks) {
            if (!database) {
                console.log('Firebase not available - data saved locally only');
                return;
            }
            
            try {
                await database.ref(`weeklyPicks/${week}`).set(picks);
                console.log(`Picks synced to Firebase for week ${week}`);
                showNotification('Picks synced to all league members!', 'success');
            } catch (error) {
                console.error('Error syncing picks:', error);
                showNotification('Sync failed - picks saved locally only', 'warning');
            }
        }

        async function loadPicksFromFirebase(week) {
            if (!database) return [];
            
            try {
                const snapshot = await database.ref(`weeklyPicks/${week}`).once('value');
                return snapshot.exists() ? snapshot.val() : [];
            } catch (error) {
                console.error('Error loading picks:', error);
                return [];
            }
        }

        function setupRealtimeListeners() {
            if (!database) return;
            
            // Listen for changes to current week
            database.ref(`weeklyPicks/${currentWeek}`).on('value', (snapshot) => {
                if (snapshot.exists()) {
                    weeklyPicks[currentWeek] = snapshot.val();
                    console.log('Real-time update received');
                    
                    const activeTab = document.querySelector('.tab-pane.active');
                    if (activeTab && activeTab.id === 'picks') {
                        generatePickSlots();
                    }
                    updateCalculations();
                }
            });
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const colors = {
                success: '#4CAF50',
                warning: '#FF9800',
                error: '#f44336',
                info: '#2196F3'
            };
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${colors[type]};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                z-index: 1000;
                font-weight: bold;
                max-width: 300px;
            `;
            notification.innerHTML = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }

        function generatePickSlots() {
            const numberOfLegs = parseInt(document.getElementById('numberOfLegs').value);
            const container = document.getElementById('pickSlotsContainer');
            container.innerHTML = '';
            
            const existingPicks = weeklyPicks[currentWeek] || [];
            
            for (let i = 0; i < numberOfLegs; i++) {
                const existingPick = existingPicks[i] || null;
                const slotDiv = createPickSlot(i, existingPick);
                container.appendChild(slotDiv);
            }
        }

        function createPickSlot(i, existingPick) {
            const slotDiv = document.createElement('div');
            slotDiv.className = getSlotClass(existingPick);
            slotDiv.id = `pickSlot${i}`;
            
            const resultText = getResultText(existingPick);
            const resultClass = getResultClass(existingPick);
            
            slotDiv.innerHTML = `
                <div class="pick-slot-header">
                    <h4>Pick ${i + 1}</h4>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <span class="result-indicator ${resultClass}">${resultText}</span>
                    </div>
                </div>
                <div class="pick-slot-fields">
                    <div class="pick-slot-field">
                        <label>Player Name</label>
                        <input type="text" id="player${i}" value="${existingPick?.playerName || ''}" placeholder="Player name">
                    </div>
                    <div class="pick-slot-field">
                        <label>Pick/Bet</label>
                        <input type="text" id="pick${i}" value="${existingPick?.pick || ''}" placeholder="Team to win, over/under, etc.">
                    </div>
                    <div class="pick-slot-field">
                        <label>Odds</label>
                        <input type="text" id="odds${i}" value="${existingPick?.odds || ''}" placeholder="-110, +200" onblur="formatOdds(${i})">
                    </div>
                    <div class="pick-slot-field">
                        <label>Game</label>
                        <select id="game${i}" onchange="updateTimeSlotFromGame(${i})">
                            <option value="">Select Game</option>
                            ${generateGameOptions(existingPick?.game)}
                        </select>
                    </div>
                    <div class="pick-slot-field">
                        <label>Time Slot</label>
                        <select id="timeSlot${i}">
                            <option value="">Select</option>
                            <option value="TNF" ${existingPick?.timeSlot === 'TNF' ? 'selected' : ''}>TNF</option>
                            <option value="Early" ${existingPick?.timeSlot === 'Early' ? 'selected' : ''}>Early</option>
                            <option value="Late" ${existingPick?.timeSlot === 'Late' ? 'selected' : ''}>Late</option>
                            <option value="SNF" ${existingPick?.timeSlot === 'SNF' ? 'selected' : ''}>SNF</option>
                            <option value="MNF" ${existingPick?.timeSlot === 'MNF' ? 'selected' : ''}>MNF</option>
                        </select>
                    </div>
                </div>
                <div class="result-buttons">
                    <button class="result-btn" onclick="saveIndividualPick(${i})" style="background: #2196F3; color: white;">üíæ Save</button>
                    <button class="result-btn win" onclick="updateSlotResult(${i}, true)">‚úì Win</button>
                    <button class="result-btn loss" onclick="updateSlotResult(${i}, false)">‚úó Loss</button>
                    <button class="result-btn draw" onclick="updateSlotResult(${i}, 'draw')">ü§ù Draw</button>
                    <button class="result-btn reset" onclick="updateSlotResult(${i}, null)">‚Üª Reset</button>
                </div>
            `;
            
            return slotDiv;
        }

        function saveIndividualPick(slotIndex) {
            const playerName = document.getElementById(`player${slotIndex}`).value.trim();
            const pick = document.getElementById(`pick${slotIndex}`).value.trim();
            const odds = document.getElementById(`odds${slotIndex}`).value.trim();
            const game = document.getElementById(`game${slotIndex}`).value;
            const timeSlot = document.getElementById(`timeSlot${slotIndex}`).value;
            
            if (!playerName || !pick || !odds) {
                alert('Please fill in Player Name, Pick, and Odds before saving.');
                return;
            }
            
            if (!weeklyPicks[currentWeek]) {
                weeklyPicks[currentWeek] = [];
            }
            
            const pickData = {
                id: Date.now() + slotIndex,
                playerName,
                pick,
                odds,
                game,
                timeSlot,
                result: null,
                isSaved: true
            };
            
            // Find existing or add new
            let actualPickIndex = -1;
            let filledSlots = 0;
            
            for (let i = 0; i <= slotIndex; i++) {
                const pName = document.getElementById(`player${i}`).value.trim();
                const pPick = document.getElementById(`pick${i}`).value.trim();
                const pOdds = document.getElementById(`odds${i}`).value.trim();
                
                if (pName && pPick && pOdds) {
                    if (i === slotIndex) {
                        actualPickIndex = filledSlots;
                        break;
                    }
                    filledSlots++;
                }
            }
            
            if (actualPickIndex >= 0 && actualPickIndex < weeklyPicks[currentWeek].length) {
                weeklyPicks[currentWeek][actualPickIndex] = pickData;
            } else {
                weeklyPicks[currentWeek].push(pickData);
            }
            
            // Save to Firebase for real-time sync
            savePicksToFirebase(currentWeek, weeklyPicks[currentWeek]);
            
            // Show success feedback
            const saveButton = document.querySelector(`#pickSlot${slotIndex} .result-btn[onclick*="saveIndividualPick"]`);
            const originalText = saveButton.innerHTML;
            saveButton.innerHTML = '‚úÖ Saved!';
            saveButton.style.background = '#4CAF50';
            
            setTimeout(() => {
                saveButton.innerHTML = originalText;
                saveButton.style.background = '#2196F3';
            }, 1500);
            
            if (game) {
                autoDetectAndGroupSGPs(game);
            }
            
            updateCalculations();
            console.log('Pick saved:', pickData);
        }

        function autoDetectAndGroupSGPs(savedGame) {
            const currentPicks = weeklyPicks[currentWeek] || [];
            const sameGamePicks = currentPicks.filter(pick => 
                pick && pick.isSaved && pick.game === savedGame
            );
            
            if (sameGamePicks.length >= 2) {
                console.log(`Auto-detected SGP: ${sameGamePicks.length} picks for ${savedGame}`);
                showSGPAutoDetectedNotification(savedGame, sameGamePicks.length);
                refreshSGPs();
            } else {
                generatePickSlots();
            }
        }

        function showSGPAutoDetectedNotification(game, pickCount) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #FF9800;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                z-index: 1000;
                font-weight: bold;
                max-width: 300px;
            `;
            notification.innerHTML = `
                üéØ SGP Auto-Detected!<br>
                <small>${pickCount} picks found for ${game}<br>
                Please enter SGP odds from your sportsbook</small>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 4000);
        }

        function refreshSGPs() {
            console.log('refreshSGPs called');
            const numberOfLegs = parseInt(document.getElementById('numberOfLegs').value);
            
            // First, capture all current values before regenerating
            const currentValues = {};
            for (let i = 0; i < numberOfLegs; i++) {
                const playerEl = document.getElementById(`player${i}`);
                const pickEl = document.getElementById(`pick${i}`);
                const oddsEl = document.getElementById(`odds${i}`);
                const gameEl = document.getElementById(`game${i}`);
                const timeSlotEl = document.getElementById(`timeSlot${i}`);
                
                if (playerEl) {
                    currentValues[i] = {
                        playerName: playerEl.value || '',
                        pick: pickEl ? pickEl.value || '' : '',
                        odds: oddsEl ? oddsEl.value || '' : '',
                        game: gameEl ? gameEl.value || '' : '',
                        timeSlot: timeSlotEl ? timeSlotEl.value || '' : ''
                    };
                }
            }
            
            const container = document.getElementById('pickSlotsContainer');
            container.innerHTML = '';
            
            // Group picks by game for SGP organization
            const gameGroups = {};
            const individualPicks = [];
            
            for (let i = 0; i < numberOfLegs; i++) {
                const values = currentValues[i];
                if (!values) continue;
                
                const game = values.game;
                
                if (game && values.playerName && values.pick && values.odds) {
                    // Check if there's a saved pick for this combination
                    const savedPick = weeklyPicks[currentWeek] && weeklyPicks[currentWeek].find(p => 
                        p.playerName === values.playerName && p.pick === values.pick && p.isSaved
                    );
                    
                    if (savedPick) {
                        // Check for other picks with same game
                        let hasSameGame = false;
                        for (let j = 0; j < numberOfLegs; j++) {
                            const otherValues = currentValues[j];
                            if (i !== j && otherValues && otherValues.game === game && 
                                otherValues.playerName && otherValues.pick && otherValues.odds) {
                                
                                // Check if the other pick is also saved
                                const otherSavedPick = weeklyPicks[currentWeek] && weeklyPicks[currentWeek].find(p => 
                                    p.playerName === otherValues.playerName && p.pick === otherValues.pick && p.isSaved
                                );
                                
                                if (otherSavedPick) {
                                    hasSameGame = true;
                                    break;
                                }
                            }
                        }
                        
                        if (hasSameGame) {
                            if (!gameGroups[game]) {
                                gameGroups[game] = [];
                            }
                            gameGroups[game].push({ index: i, values: values });
                        } else {
                            individualPicks.push({ index: i, values: values });
                        }
                    } else {
                        individualPicks.push({ index: i, values: values });
                    }
                } else {
                    individualPicks.push({ index: i, values: values });
                }
            }
            
            // First, render SGP groups at the top
            Object.entries(gameGroups).forEach(([game, picks]) => {
                if (picks.length > 1) {
                    const sgpGroupDiv = document.createElement('div');
                    sgpGroupDiv.className = 'sgp-group';
                    
                    // Determine overall SGP result
                    const sgpPicks = picks.map(p => weeklyPicks[currentWeek] && weeklyPicks[currentWeek].find(wp => 
                        wp.playerName === p.values.playerName && wp.pick === p.values.pick
                    )).filter(p => p);
                    
                    let sgpResultText = '‚è≥ SGP PENDING';
                    let sgpResultClass = 'pending';
                    
                    if (sgpPicks.length > 0) {
                        const results = sgpPicks.map(pick => pick.result);
                        
                        if (results.every(result => result === true)) {
                            sgpResultText = '‚úÖ SGP WIN';
                            sgpResultClass = 'win';
                        } else if (results.some(result => result === false)) {
                            sgpResultText = '‚ùå SGP LOSS';
                            sgpResultClass = 'loss';
                        } else if (results.some(result => result === 'draw')) {
                            sgpResultText = 'ü§ù SGP DRAW';
                            sgpResultClass = 'draw';
                        }
                    }
                    
                    // Add SGP header with overall result
                    const sgpHeader = document.createElement('div');
                    sgpHeader.style.cssText = `
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 15px;
                        padding: 10px 0;
                    `;
                    sgpHeader.innerHTML = `
                        <div style="font-size: 16px; font-weight: bold; color: #FF9800;">
                            üéØ Same Game Parlay - ${game}
                        </div>
                        <span class="result-indicator ${sgpResultClass}" style="font-size: 14px;">
                            ${sgpResultText}
                        </span>
                    `;
                    sgpGroupDiv.appendChild(sgpHeader);
                    
                    // Add SGP odds field
                    const oddsContainer = document.createElement('div');
                    oddsContainer.className = 'sgp-odds-container';
                    oddsContainer.innerHTML = `
                        <div class="sgp-odds-field">
                            <label>SGP Odds:</label>
                            <input type="text" placeholder="-110, +200" id="sgp-odds-${game.replace(/[^a-zA-Z0-9]/g, '')}" 
                                   onblur="formatSGPOdds('${game.replace(/[^a-zA-Z0-9]/g, '')}')">
                        </div>
                    `;
                    sgpGroupDiv.appendChild(oddsContainer);
                    
                    // Add each pick in the SGP with preserved values
                    picks.forEach(({ index, values }) => {
                        const slotDiv = createPickSlotWithValues(index, values, true);
                        sgpGroupDiv.appendChild(slotDiv);
                    });
                    
                    // Add SGP action buttons
                    const actionsDiv = document.createElement('div');
                    actionsDiv.style.textAlign = 'center';
                    actionsDiv.style.marginTop = '15px';
                    actionsDiv.innerHTML = `
                        <button class="btn" onclick="saveSGP('${game}')" style="background: #4CAF50; color: white;">
                            üíæ Save SGP
                        </button>
                    `;
                    sgpGroupDiv.appendChild(actionsDiv);
                    
                    container.appendChild(sgpGroupDiv);
                }
            });
            
            // Then render individual picks with preserved values
            individualPicks.forEach(({ index, values }) => {
                const slotDiv = createPickSlotWithValues(index, values, false);
                container.appendChild(slotDiv);
            });
        }

        // Create a pick slot element with preserved values
        function createPickSlotWithValues(i, values, isSGP = false) {
            const slotDiv = document.createElement('div');
            slotDiv.className = 'pick-slot' + (isSGP ? ' sgp-pick' : '');
            slotDiv.id = `pickSlot${i}`;
            
            // Check if this pick is saved by looking at weeklyPicks data
            const savedPick = weeklyPicks[currentWeek] && weeklyPicks[currentWeek].find(p => 
                p.isSaved && p.playerName === values?.playerName && p.pick === values?.pick
            );
            
            if (savedPick) {
                slotDiv.className += ' permanently-saved';
            }
            
            // Get result text and class for individual pick
            let resultText = '‚è≥ PENDING';
            let resultClass = 'pending';
            
            if (savedPick) {
                if (savedPick.result === true) {
                    resultText = '‚úÖ WIN';
                    resultClass = 'win';
                } else if (savedPick.result === false) {
                    resultText = '‚ùå LOSS';
                    resultClass = 'loss';
                } else if (savedPick.result === 'draw') {
                    resultText = 'ü§ù DRAW';
                    resultClass = 'draw';
                }
            }
            
            slotDiv.innerHTML = `
                <div class="pick-slot-header">
                    <h4>Pick ${i + 1}</h4>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <span class="result-indicator ${resultClass}">${resultText}</span>
                    </div>
                </div>
                <div class="pick-slot-fields">
                    <div class="pick-slot-field">
                        <label>Player Name</label>
                        <input type="text" id="player${i}" value="${values?.playerName || ''}" placeholder="Player name">
                    </div>
                    <div class="pick-slot-field">
                        <label>Pick/Bet</label>
                        <input type="text" id="pick${i}" value="${values?.pick || ''}" placeholder="Team to win, over/under, etc.">
                    </div>
                    <div class="pick-slot-field">
                        <label>Odds</label>
                        <input type="text" id="odds${i}" value="${values?.odds || ''}" placeholder="-110, +200" onblur="formatOdds(${i})" ${isSGP ? 'readonly' : ''}>
                    </div>
                    <div class="pick-slot-field">
                        <label>Game</label>
                        <select id="game${i}" onchange="updateTimeSlotFromGame(${i})">
                            <option value="">Select Game</option>
                            ${generateGameOptionsWithSelected(values?.game || '')}
                        </select>
                    </div>
                    <div class="pick-slot-field">
                        <label>Time Slot</label>
                        <select id="timeSlot${i}">
                            <option value="">Select</option>
                            <option value="TNF" ${values?.timeSlot === 'TNF' ? 'selected' : ''}>TNF</option>
                            <option value="Early" ${values?.timeSlot === 'Early' ? 'selected' : ''}>Early</option>
                            <option value="Late" ${values?.timeSlot === 'Late' ? 'selected' : ''}>Late</option>
                            <option value="SNF" ${values?.timeSlot === 'SNF' ? 'selected' : ''}>SNF</option>
                            <option value="MNF" ${values?.timeSlot === 'MNF' ? 'selected' : ''}>MNF</option>
                        </select>
                    </div>
                </div>
                <div class="result-buttons">
                    <button class="result-btn" onclick="saveIndividualPick(${i})" style="background: #2196F3; color: white;">üíæ Save</button>
                    <button class="result-btn win" onclick="updateSlotResult(${i}, true)">‚úì Win</button>
                    <button class="result-btn loss" onclick="updateSlotResult(${i}, false)">‚úó Loss</button>
                    <button class="result-btn draw" onclick="updateSlotResult(${i}, 'draw')">ü§ù Draw</button>
                    <button class="result-btn reset" onclick="updateSlotResult(${i}, null)">‚Üª Reset</button>
                </div>
            `;
            
            return slotDiv;
        }

        // Generate game options with preserved selection
        function generateGameOptionsWithSelected(selectedGame = '') {
            const currentWeekSchedule = nflSchedule[currentNFLWeek] || [];
            
            return currentWeekSchedule.map(game => 
                `<option value="${game.matchup}" ${selectedGame === game.matchup ? 'selected' : ''}>
                    ${game.matchup} (${game.time})
                </option>`
            ).join('');
        }

        // Format SGP odds input
        function formatSGPOdds(gameId) {
            const oddsInput = document.getElementById(`sgp-odds-${gameId}`);
            if (!oddsInput) return;
            
            let oddsValue = oddsInput.value.trim();
            
            if (!oddsValue) return;
            
            const cleanOdds = oddsValue.replace(/[+-]/g, '');
            
            if (isNaN(cleanOdds) || cleanOdds === '') {
                return;
            }
            
            const numericOdds = parseInt(cleanOdds);
            
            if (!oddsValue.includes('+') && !oddsValue.includes('-')) {
                if (numericOdds >= 100) {
                    oddsInput.value = '+' + numericOdds;
                } else {
                    oddsInput.value = '-' + numericOdds;
                }
            } else if (oddsValue.startsWith('+') || oddsValue.startsWith('-')) {
                oddsInput.value = oddsValue.charAt(0) + numericOdds;
            }
        }

        // Save SGP with validation
        function saveSGP(game) {
            const gameId = game.replace(/[^a-zA-Z0-9]/g, '');
            const sgpOddsInput = document.getElementById(`sgp-odds-${gameId}`);
            const sgpOdds = sgpOddsInput ? sgpOddsInput.value.trim() : '';
            
            if (!sgpOdds) {
                alert('‚ö†Ô∏è Please enter the SGP odds from your sportsbook before saving.');
                sgpOddsInput.focus();
                return;
            }
            
            // Find all picks in this SGP and validate they're complete
            const numberOfLegs = parseInt(document.getElementById('numberOfLegs').value);
            const sgpPicks = [];
            
            for (let i = 0; i < numberOfLegs; i++) {
                const gameElement = document.getElementById(`game${i}`);
                if (gameElement && gameElement.value === game) {
                    const playerName = document.getElementById(`player${i}`).value.trim();
                    const pick = document.getElementById(`pick${i}`).value.trim();
                    const odds = document.getElementById(`odds${i}`).value.trim();
                    
                    if (playerName && pick && odds) {
                        sgpPicks.push({
                            slotIndex: i,
                            playerName,
                            pick,
                            odds,
                            game,
                            timeSlot: document.getElementById(`timeSlot${i}`).value,
                            sameGameGroup: gameId
                        });
                    }
                }
            }
            
            // Update each individual pick with SGP information
            sgpPicks.forEach(pickData => {
                const existingIndex = weeklyPicks[currentWeek].findIndex(p => 
                    p.playerName === pickData.playerName && p.pick === pickData.pick
                );
                
                if (existingIndex >= 0) {
                    weeklyPicks[currentWeek][existingIndex].sgpOdds = sgpOdds;
                    weeklyPicks[currentWeek][existingIndex].isSGP = true;
                    weeklyPicks[currentWeek][existingIndex].sameGameGroup = gameId;
                }
            });
            
            // Save to Firebase
            savePicksToFirebase(currentWeek, weeklyPicks[currentWeek]);
            
            showNotification(`SGP saved successfully for ${game}!`, 'success');
            updateCalculations();
        }

        // Helper functions
        function getSlotClass(pick) {
            let baseClass = 'pick-slot';
            if (!pick) return baseClass;
            
            if (pick.playerName && pick.pick && pick.odds) {
                baseClass += ' filled';
            }
            
            if (pick.result === true) return baseClass + ' win';
            if (pick.result === false) return baseClass + ' loss';
            if (pick.result === 'draw') return baseClass + ' draw';
            
            return baseClass;
        }
        
        function getResultText(pick) {
            if (!pick || pick.result === null) return '‚è≥ PENDING';
            if (pick.result === true) return '‚úÖ WIN';
            if (pick.result === false) return '‚ùå LOSS';
            if (pick.result === 'draw') return 'ü§ù DRAW';
            return '‚è≥ PENDING';
        }
        
        function getResultClass(pick) {
            if (!pick || pick.result === null) return 'pending';
            if (pick.result === true) return 'win';
            if (pick.result === false) return 'loss';
            if (pick.result === 'draw') return 'draw';
            return 'pending';
        }

        function generateGameOptions(selectedGame = '') {
            const currentWeekSchedule = nflSchedule[currentNFLWeek] || [];
            return currentWeekSchedule.map(game => 
                `<option value="${game.matchup}" ${selectedGame === game.matchup ? 'selected' : ''}>
                    ${game.matchup} (${game.time})
                </option>`
            ).join('');
        }

        function formatOdds(slotIndex) {
            const oddsInput = document.getElementById(`odds${slotIndex}`);
            let oddsValue = oddsInput.value.trim();
            
            if (!oddsValue) return;
            
            const cleanOdds = oddsValue.replace(/[+-]/g, '');
            
            if (isNaN(cleanOdds) || cleanOdds === '') {
                return;
            }
            
            const numericOdds = parseInt(cleanOdds);
            
            if (!oddsValue.includes('+') && !oddsValue.includes('-')) {
                if (numericOdds >= 100) {
                    oddsInput.value = '+' + numericOdds;
                } else {
                    oddsInput.value = '-' + numericOdds;
                }
            } else if (oddsValue.startsWith('+') || oddsValue.startsWith('-')) {
                oddsInput.value = oddsValue.charAt(0) + numericOdds;
            }
        }

        function updateTimeSlotFromGame(slotIndex) {
            const gameSelect = document.getElementById(`game${slotIndex}`);
            const timeSlotSelect = document.getElementById(`timeSlot${slotIndex}`);
            const selectedGame = gameSelect.value;
            
            if (selectedGame) {
                const currentWeekSchedule = nflSchedule[currentNFLWeek] || [];
                const game = currentWeekSchedule.find(g => g.matchup === selectedGame);
                
                if (game) {
                    timeSlotSelect.value = game.time;
                }
            }
        }

        function updateSlotResult(slotIndex, result) {
            if (!weeklyPicks[currentWeek]) weeklyPicks[currentWeek] = [];
            
            let actualPickIndex = -1;
            let filledSlots = 0;
            
            for (let i = 0; i <= slotIndex; i++) {
                const playerName = document.getElementById(`player${i}`).value.trim();
                const pick = document.getElementById(`pick${i}`).value.trim();
                const odds = document.getElementById(`odds${i}`).value.trim();
                
                if (playerName && pick && odds) {
                    if (i === slotIndex) {
                        actualPickIndex = filledSlots;
                        break;
                    }
                    filledSlots++;
                }
            }
            
            if (actualPickIndex >= 0 && weeklyPicks[currentWeek][actualPickIndex]) {
                if (result === null) {
                    // Reset - remove pick
                    weeklyPicks[currentWeek].splice(actualPickIndex, 1);
                } else {
                    // Update result
                    weeklyPicks[currentWeek][actualPickIndex].result = result;
                }
                
                // Sync changes to Firebase
                savePicksToFirebase(currentWeek, weeklyPicks[currentWeek]);
                
                generatePickSlots();
                updateLeaderboardData();
                updateCalculations();
            }
        }

        // Calculation functions
        function americanToDecimal(american) {
            const odds = parseFloat(american.replace('+', ''));
            if (odds > 0) {
                return (odds / 100) + 1;
            } else {
                return (100 / Math.abs(odds)) + 1;
            }
        }
        
        function decimalToAmerican(decimal) {
            if (decimal >= 2) {
                return '+' + Math.round((decimal - 1) * 100);
            } else {
                return '-' + Math.round(100 / (decimal - 1));
            }
        }

        function calculateParlayOdds(picks) {
            if (picks.length === 0) return 1;
            
            let totalOdds = 1;
            picks.forEach(pick => {
                totalOdds *= americanToDecimal(pick.odds);
            });
            
            return totalOdds;
        }

        function updateCalculations() {
            const picks = weeklyPicks[currentWeek] || [];
            const betAmount = parseFloat(document.getElementById('betAmountInput').value) || 10;
            
            const totalOdds = calculateParlayOdds(picks);
            const americanOdds = decimalToAmerican(totalOdds);
            const potentialWinnings = betAmount * totalOdds;
            const grossWinnings = potentialWinnings - betAmount;
            const taxes = grossWinnings * 0.3;
            const netWinnings = grossWinnings - taxes;
            const perPerson = picks.length > 0 ? netWinnings / picks.length : 0;
            
            document.getElementById('totalOdds').textContent = americanOdds;
            document.getElementById('totalPicks').textContent = picks.length;
            document.getElementById('betAmount').textContent = '$' + betAmount.toFixed(2);
            document.getElementById('potentialWinnings').textContent = '$' + potentialWinnings.toFixed(2);
            document.getElementById('grossWinnings').textContent = '$' + grossWinnings.toFixed(2);
            document.getElementById('taxes').textContent = '$' + taxes.toFixed(2);
            document.getElementById('netWinnings').textContent = '$' + netWinnings.toFixed(2);
            document.getElementById('perPerson').textContent = '$' + perPerson.toFixed(2);
        }

        function updateLeaderboardData() {
            leaderboardData = {};
            
            Object.entries(weeklyPicks).forEach(([week, picks]) => {
                picks.forEach(pick => {
                    if (!leaderboardData[pick.playerName]) {
                        leaderboardData[pick.playerName] = {
                            wins: 0,
                            losses: 0,
                            draws: 0,
                            contributions: 0
                        };
                    }
                    
                    if (pick.result === true) {
                        leaderboardData[pick.playerName].wins++;
                    } else if (pick.result === false) {
                        leaderboardData[pick.playerName].losses++;
                    } else if (pick.result === 'draw') {
                        leaderboardData[pick.playerName].draws++;
                    }
                });
            });
            
            updateLeaderboard();
        }

        function updateLeaderboard() {
            const tbody = document.getElementById('leaderboardBody');
            tbody.innerHTML = '';
            
            const players = Object.entries(leaderboardData)
                .map(([name, data]) => ({
                    name,
                    wins: data.wins,
                    losses: data.losses,
                    draws: data.draws || 0,
                    winRate: data.wins + data.losses + (data.draws || 0) > 0 ? 
                        (data.wins / (data.wins + data.losses + (data.draws || 0)) * 100) : 0,
                    contributions: data.contributions
                }))
                .sort((a, b) => b.winRate - a.winRate || b.wins - a.wins);
            
            if (players.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #666;">No data available</td></tr>';
                return;
            }
            
            players.forEach((player, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${player.name}</td>
                    <td style="color: #4CAF50; font-weight: bold;">${player.wins}</td>
                    <td style="color: #f44336; font-weight: bold;">${player.losses}</td>
                    <td style="color: #FF9800; font-weight: bold;">${player.draws}</td>
                    <td>${player.winRate.toFixed(1)}%</td>
                    <td>${player.contributions}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function switchTab(tabName, clickedButton) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
            
            clickedButton.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'summary') {
                updateCalculations();
            } else if (tabName === 'leaderboard') {
                updateLeaderboard();
            }
        }

        function convertOdds() {
            const american = parseFloat(document.getElementById('americanOdds').value);
            if (!isNaN(american)) {
                let decimal;
                if (american > 0) {
                    decimal = (american / 100) + 1;
                } else {
                    decimal = (100 / Math.abs(american)) + 1;
                }
                document.getElementById('decimalOdds').value = decimal.toFixed(2);
                
                const impliedProb = american > 0 ? 
                    (100 / (american + 100)) * 100 : 
                    (Math.abs(american) / (Math.abs(american) + 100)) * 100;
                document.getElementById('impliedProb').value = impliedProb.toFixed(1) + '%';
            }
        }
        
        function convertFromDecimal() {
            const decimal = parseFloat(document.getElementById('decimalOdds').value);
            if (!isNaN(decimal) && decimal > 1) {
                let american;
                if (decimal >= 2) {
                    american = '+' + Math.round((decimal - 1) * 100);
                } else {
                    american = '-' + Math.round(100 / (decimal - 1));
                }
                document.getElementById('americanOdds').value = american;
                
                const impliedProb = (1 / decimal) * 100;
                document.getElementById('impliedProb').value = impliedProb.toFixed(1) + '%';
            }
        }

        function clearAllPicks() {
            if (confirm('Are you sure you want to clear all picks for this week?')) {
                weeklyPicks[currentWeek] = [];
                generatePickSlots();
                updateCalculations();
            }
        }

        function saveAllPicks() {
            const numberOfLegs = parseInt(document.getElementById('numberOfLegs').value);
            const newPicks = [];
            
            for (let i = 0; i < numberOfLegs; i++) {
                const playerName = document.getElementById(`player${i}`).value.trim();
                const pick = document.getElementById(`pick${i}`).value.trim();
                const odds = document.getElementById(`odds${i}`).value.trim();
                const game = document.getElementById(`game${i}`).value;
                const timeSlot = document.getElementById(`timeSlot${i}`).value;
                
                if (playerName && pick && odds) {
                    const newPick = {
                        id: Date.now() + i,
                        playerName,
                        pick,
                        odds,
                        game,
                        timeSlot,
                        result: null,
                        isSaved: true
                    };
                    newPicks.push(newPick);
                }
            }
            
            weeklyPicks[currentWeek] = newPicks;
            alert('All picks saved successfully!');
            generatePickSlots();
            updateCalculations();
        }

        function resetLeaderboard() {
            if (confirm('Are you sure you want to reset all season stats? This cannot be undone.')) {
                leaderboardData = {};
                weeklyPicks = {};
                generatePickSlots();
                updateCalculations();
                updateLeaderboard();
            }
        }
    </script>
</body>
</html>