<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantasy Football Parlay Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: #f1f5f9;
            color: #1e293b;
            line-height: 1.6;
            font-size: 16px;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(16, 185, 129, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(245, 158, 11, 0.05) 0%, transparent 50%);
            z-index: -1;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }
        
        .header {
            background: white;
            border-radius: 16px;
            padding: 48px 32px;
            text-align: center;
            margin-bottom: 32px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #10b981, #f59e0b);
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 8px;
            letter-spacing: -0.025em;
        }
        
        .header p {
            font-size: 1.125rem;
            color: #64748b;
            font-weight: 400;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }
        
        .tab {
            flex: 1;
            padding: 16px 24px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            color: #64748b;
            transition: all 0.2s ease;
            border-radius: 8px;
            position: relative;
        }
        
        .tab:hover {
            color: #334155;
            background: #f1f5f9;
        }
        
        .tab.active {
            background: #3b82f6;
            color: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .tab.active:hover {
            background: white;
        }
        
        .tab-content {
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: block;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 24px;
        }
        
        .form-group label {
            font-weight: 500;
            margin-bottom: 8px;
            color: #374151;
            font-size: 14px;
        }
        
        .form-group input, .form-group select {
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.2s ease;
            background: white;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .btn {
            background: #3b82f6;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            background: #2563eb;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: #6b7280;
        }
        
        .btn-secondary:hover {
            background: #4b5563;
            box-shadow: 0 4px 12px rgba(107, 114, 128, 0.3);
        }
        
        .btn-danger {
            background: #ef4444;
        }
        
        .btn-danger:hover {
            background: #dc2626;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        
        .pick-slot {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 16px;
            transition: all 0.2s ease;
            position: relative;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .pick-slot:hover {
            border-color: #cbd5e1;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.05);
            transform: translateY(-1px);
        }
        
        .pick-slot.filled {
            border-color: #10b981;
            background: linear-gradient(135deg, #f0fdf4 0%, #ffffff 100%);
            box-shadow: 0 2px 4px rgba(16, 185, 129, 0.1);
        }
        
        .pick-slot.win {
            border-color: #10b981;
            background: linear-gradient(135deg, #f0fdf4 0%, #ffffff 100%);
            box-shadow: 0 2px 4px rgba(16, 185, 129, 0.1);
        }
        
        .pick-slot.loss {
            border-color: #ef4444;
            background: linear-gradient(135deg, #fef2f2 0%, #ffffff 100%);
            box-shadow: 0 2px 4px rgba(239, 68, 68, 0.1);
        }
        
        .pick-slot.draw {
            border-color: #f59e0b;
            background: linear-gradient(135deg, #fffbeb 0%, #ffffff 100%);
            box-shadow: 0 2px 4px rgba(245, 158, 11, 0.1);
        }
        
        .sgp-group {
            border: 2px solid #FF9800;
            border-radius: 12px;
            background: linear-gradient(135deg, rgba(255, 152, 0, 0.08), rgba(255, 224, 179, 0.08));
            padding: 12px;
            padding-top: 28px;
            margin-bottom: 16px;
            position: relative;
        }
        
        .sgp-group::before {
            content: "🎯 Same Game Parlay";
            position: absolute;
            top: -10px;
            left: 16px;
            background: #FF9800;
            color: white;
            padding: 3px 10px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: bold;
        }
        
        .pick-slot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .pick-slot-fields {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .pick-slot-field {
            display: flex;
            flex-direction: column;
        }
        
        .pick-slot-field label {
            font-size: 12px;
            font-weight: 500;
            color: #6b7280;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .pick-slot-field input,
        .pick-slot-field select {
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            width: 100%;
            background: white;
        }
        
        .pick-slot-field input:focus,
        .pick-slot-field select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }
        
        .result-indicator {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .result-indicator.win {
            background: #dcfce7;
            color: #166534;
        }
        
        .result-indicator.loss {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .result-indicator.draw {
            background: #fef3c7;
            color: #92400e;
        }
        
        .result-indicator.submitted {
            background: #dbeafe;
            color: #1e40af;
        }

        .result-indicator.pending {
            background: #f3f4f6;
            color: #374151;
        }
        
        .button-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .button-group-left {
            justify-content: flex-start;
        }
        
        .button-group-right {
            justify-content: flex-end;
        }
        
        .result-buttons {
            display: flex;
            gap: 8px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .result-btn {
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 500;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 70px;
        }
        
        .result-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .result-btn.win {
            background: #10b981;
            color: white;
        }
        
        .result-btn.win.active {
            background: #059669;
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
        }
        
        .result-btn.loss {
            background: #ef4444;
            color: white;
        }
        
        .result-btn.loss.active {
            background: #dc2626;
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.2);
        }
        
        .result-btn.draw {
            background: #f59e0b;
            color: white;
        }
        
        .result-btn.draw.active {
            background: #d97706;
            box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.2);
        }
        
        .result-btn.reset {
            background: #6b7280;
            color: white;
        }
        
        .summary-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }
        
        .summary-card h3 {
            font-size: 18px;
            font-weight: 600;
            color: #0f172a;
            margin-bottom: 16px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
            text-align: center;
            transition: all 0.2s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .stat-card .stat-label {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .stat-card .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #0f172a;
        }
        
        .stat-card.primary .stat-value {
            color: #3b82f6;
        }
        
        .stat-card.success .stat-value {
            color: #10b981;
        }
        
        .stat-card.warning .stat-value {
            color: #f59e0b;
        }
        
        .stat-card.danger .stat-value {
            color: #ef4444;
        }
        
        .week-selector {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }
        
        .week-selector label {
            font-weight: 500;
            color: #374151;
        }
        
        .week-selector select {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
        }
        
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }
        
        .leaderboard-table th {
            background: #f8fafc;
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .leaderboard-table td {
            padding: 16px;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .leaderboard-table tr:hover {
            background: #f8fafc;
        }
        
        .leaderboard-table tr:last-child td {
            border-bottom: none;
        }
        
        .notification {
            position: fixed;
            top: 24px;
            right: 24px;
            padding: 16px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: #10b981;
        }
        
        .notification.error {
            background: #ef4444;
        }
        
        .notification.info {
            background: #3b82f6;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }
            
            .header {
                padding: 32px 24px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .tab-content {
                padding: 24px;
            }
            
            .pick-slot-fields {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            /* Tab mobile optimizations */
            .tabs {
                flex-direction: column;
                gap: 4px;
            }
            
            .tab {
                padding: 12px 16px;
                font-size: 14px;
            }
            
            .tab.active {
                background: #3b82f6 !important;
                color: white !important;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
            }
            
            .tab.active:hover {
                background: #2563eb !important;
                color: white !important;
            }
            
            /* Week selector mobile */
            .week-selector {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            
            /* Mobile button optimizations */
            .pick-slot {
                padding: 16px;
            }
            
            .sgp-group {
                padding: 12px;
                padding-top: 24px;
            }
            
            .result-btn {
                padding: 8px 12px !important;
                font-size: 12px !important;
                min-width: 60px;
            }
            
            /* SGP mobile optimizations */
            .sgp-group .result-btn {
                padding: 6px 10px !important;
                font-size: 11px !important;
            }
            
            /* Stack buttons vertically on very small screens */
            @media (max-width: 480px) {
                .pick-slot > div[style*="justify-content: space-between"] {
                    flex-direction: column !important;
                    gap: 12px !important;
                }
                
                .pick-slot > div[style*="justify-content: space-between"] > div {
                    justify-content: center !important;
                    flex-wrap: wrap !important;
                }
                
                .result-btn {
                    flex: 1;
                    min-width: 70px;
                }
            }
            
            /* Summary page mobile optimizations */
            @media (max-width: 768px) {
                /* Summary header mobile layout */
                .summary-header {
                    flex-direction: column !important;
                    gap: 16px !important;
                    align-items: stretch !important;
                }
                
                .summary-title-section {
                    align-items: center !important;
                    text-align: center !important;
                }
                
                .summary-title-section h2 {
                    font-size: 20px !important;
                    margin-bottom: 8px !important;
                }
                
                #parlayStatus {
                    justify-content: center !important;
                    font-size: 16px !important;
                    padding: 10px 16px !important;
                    align-self: center !important;
                }
                
                /* Week selector mobile layout */
                .summary-week-selector {
                    justify-content: center !important;
                    align-items: center !important;
                }
                
                .summary-week-selector select {
                    min-width: 120px !important;
                }
                
                /* Stats grid mobile optimization */
                .stats-grid {
                    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)) !important;
                    gap: 12px !important;
                }
                
                .stat-card {
                    padding: 16px !important;
                }
                
                .stat-card .stat-label {
                    font-size: 12px !important;
                }
                
                .stat-card .stat-value {
                    font-size: 20px !important;
                }
                
                /* Summary cards mobile optimization */
                .summary-card {
                    padding: 16px !important;
                    margin-bottom: 12px !important;
                }
                
                .summary-card h3 {
                    font-size: 16px !important;
                    margin-bottom: 12px !important;
                }
                
                /* SGP and individual pick cards mobile layout */
                #picksSummary > div[style*="margin-bottom: 16px"] {
                    margin-bottom: 12px !important;
                }
                
                #picksSummary h4 {
                    font-size: 13px !important;
                    padding: 6px 10px !important;
                }
                
                /* SGP cards mobile layout */
                #picksSummary div[style*="border: 2px solid #FF9800"] {
                    padding: 10px !important;
                    margin-bottom: 6px !important;
                }
                
                #picksSummary div[style*="border: 2px solid #FF9800"] > div[style*="justify-content: space-between"] {
                    flex-direction: column !important;
                    gap: 8px !important;
                    align-items: flex-start !important;
                }
                
                #picksSummary div[style*="border: 2px solid #FF9800"] strong {
                    font-size: 14px !important;
                }
                
                #picksSummary div[style*="border: 2px solid #FF9800"] span[style*="background:"] {
                    font-size: 11px !important;
                    padding: 3px 6px !important;
                }
                
                /* Individual pick cards mobile layout */
                #picksSummary div[style*="border: 2px solid #e0e0e0"] {
                    padding: 10px !important;
                    margin-bottom: 6px !important;
                }
                
                #picksSummary div[style*="border: 2px solid #e0e0e0"] > div[style*="justify-content: space-between"] {
                    flex-direction: column !important;
                    gap: 8px !important;
                    align-items: flex-start !important;
                }
                
                #picksSummary div[style*="border: 2px solid #e0e0e0"] strong {
                    font-size: 14px !important;
                }
                
                #picksSummary div[style*="border: 2px solid #e0e0e0"] span[style*="background:"] {
                    font-size: 11px !important;
                    padding: 3px 6px !important;
                }
                
                /* Text content mobile optimization */
                #picksSummary div[style*="color: #666"] {
                    font-size: 12px !important;
                    margin-top: 3px !important;
                }
                
                #picksSummary div[style*="padding: 4px 0"] {
                    padding: 3px 0 !important;
                    font-size: 13px !important;
                }
            }
            
            /* Extra small screens */
            @media (max-width: 480px) {
                .summary-title-section h2 {
                    font-size: 18px !important;
                }
                
                #parlayStatus {
                    font-size: 14px !important;
                    padding: 8px 12px !important;
                }
                
                .summary-week-selector {
                    flex-direction: column !important;
                    gap: 6px !important;
                }
                
                .summary-week-selector select {
                    min-width: 100px !important;
                }
                
                .stats-grid {
                    grid-template-columns: 1fr !important;
                    gap: 8px !important;
                }
                
                .summary-card {
                    padding: 12px !important;
                }
                
                #picksSummary h4 {
                    font-size: 12px !important;
                    padding: 4px 8px !important;
                }
                
                #picksSummary div[style*="border: 2px solid #FF9800"],
                #picksSummary div[style*="border: 2px solid #e0e0e0"] {
                    padding: 8px !important;
                }
                
                #picksSummary div[style*="border: 2px solid #FF9800"] strong,
                #picksSummary div[style*="border: 2px solid #e0e0e0"] strong {
                    font-size: 13px !important;
                }
                
                #picksSummary div[style*="color: #666"] {
                    font-size: 11px !important;
                }
                
                #picksSummary div[style*="padding: 4px 0"] {
                    font-size: 12px !important;
                }
            }
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .summary-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
        }
        
        .summary-item h3 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }
        
        .leaderboard {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        
        .leaderboard-header {
            background: linear-gradient(135deg, #9C27B0, #7B1FA2);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .leaderboard table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .leaderboard th, .leaderboard td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .leaderboard th {
            background: #f5f5f5;
            font-weight: 600;
        }
        
        .leaderboard tr:nth-child(even) {
            background: #fafafa;
        }
        
        .week-selector {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .current-week {
            font-size: 1.2em;
            font-weight: 600;
            color: #4CAF50;
        }
        
        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            gap: 16px;
        }
        
        .summary-title-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
            flex: 1;
        }
        
        .summary-week-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }
        
        .summary-week-selector label {
            font-weight: 500;
            color: #374151;
            white-space: nowrap;
        }
        
        .summary-week-selector select {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            font-size: 14px;
            min-width: 100px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏈 Fantasy Football Parlay Tracker</h1>
            <p>Collective Hive Mind Betting</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('picks', this)">Weekly Picks</button>
            <button class="tab" onclick="switchTab('summary', this)">Parlay Summary</button>
            <button class="tab" onclick="switchTab('leaderboard', this)">Leaderboard</button>
        </div>
        
        <div class="tab-content">
            <div id="picks" class="tab-pane active">
                <div class="week-selector">
                    <label for="currentWeek">Week:</label>
                    <select id="currentWeek" onchange="updateWeek()">
                        <option value="1">Week 1</option>
                        <option value="2">Week 2</option>
                        <option value="3">Week 3</option>
                        <option value="4">Week 4</option>
                        <option value="5">Week 5</option>
                        <option value="6">Week 6</option>
                        <option value="7">Week 7</option>
                        <option value="8">Week 8</option>
                        <option value="9">Week 9</option>
                        <option value="10">Week 10</option>
                        <option value="11">Week 11</option>
                        <option value="12">Week 12</option>
                        <option value="13">Week 13</option>
                        <option value="14">Week 14</option>
                        <option value="15">Week 15</option>
                        <option value="16">Week 16</option>
                        <option value="17">Week 17</option>
                        <option value="18">Week 18</option>
                    </select>
                    
                    <div style="margin-left: 40px; display: flex; align-items: center; gap: 15px;">
                        <label for="numberOfLegs">Parlay Legs:</label>
                        <select id="numberOfLegs" onchange="renderAllPicks()">
                            <option value="2">2 Legs</option>
                            <option value="3">3 Legs</option>
                            <option value="4">4 Legs</option>
                            <option value="5">5 Legs</option>
                            <option value="6">6 Legs</option>
                            <option value="7">7 Legs</option>
                            <option value="8">8 Legs</option>
                            <option value="9">9 Legs</option>
                            <option value="10">10 Legs</option>
                            <option value="11">11 Legs</option>
                            <option value="12" selected>12 Legs</option>
                            <option value="13">13 Legs</option>
                            <option value="14">14 Legs</option>
                            <option value="15">15 Legs</option>
                            <option value="16">16 Legs</option>
                            <option value="17">17 Legs</option>
                            <option value="18">18 Legs</option>
                            <option value="19">19 Legs</option>
                            <option value="20">20 Legs</option>
                        </select>
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; margin-bottom: 30px;">
                    <button class="btn" onclick="saveAllPicks()">💾 Save All Picks</button>
                    <button class="btn" onclick="clearAllPicks()" style="background: #f44336;">🗑️ Clear All</button>
                </div>
                
                <div id="pickSlotsContainer"></div>
            </div>
            
            <div id="summary" class="tab-pane">
                <div class="summary-header">
                    <div class="summary-title-section">
                    <h2 style="color: #333; margin: 0;">Week <span id="summaryWeek">1</span> Parlay Summary</h2>
                        <div id="parlayStatus" style="display: flex; align-items: center; gap: 10px; padding: 12px 20px; border-radius: 25px; font-size: 18px; font-weight: bold; background: linear-gradient(135deg, #4CAF50, #45a049); color: white; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
                            <span id="parlayStatusIcon">💚</span>
                            <span id="parlayStatusText">Parlay Still Alive</span>
                        </div>
                    </div>
                    <div class="summary-week-selector">
                        <label for="summaryWeekSelect">Week:</label>
                        <select id="summaryWeekSelect" onchange="updateWeekFromSummary()">
                            <option value="1">Week 1</option>
                            <option value="2">Week 2</option>
                            <option value="3">Week 3</option>
                            <option value="4">Week 4</option>
                            <option value="5">Week 5</option>
                            <option value="6">Week 6</option>
                            <option value="7">Week 7</option>
                            <option value="8">Week 8</option>
                            <option value="9">Week 9</option>
                            <option value="10">Week 10</option>
                            <option value="11">Week 11</option>
                            <option value="12">Week 12</option>
                            <option value="13">Week 13</option>
                            <option value="14">Week 14</option>
                            <option value="15">Week 15</option>
                            <option value="16">Week 16</option>
                            <option value="17">Week 17</option>
                            <option value="18">Week 18</option>
                        </select>
                    </div>
                </div>
                
                <div style="background: white; border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 15px; color: #333;">Your Picks</h3>
                    <div id="picksSummary" style="display: flex; flex-direction: column; gap: 10px;"></div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px;">
                    <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); border-left: 4px solid #4CAF50;">
                        <div style="color: #666; font-size: 14px; margin-bottom: 5px;">Total Parlay Odds</div>
                        <div id="totalOdds" style="font-size: 28px; font-weight: bold; color: #4CAF50;">+0</div>
                    </div>
                    <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); border-left: 4px solid #2196F3;">
                        <div style="color: #666; font-size: 14px; margin-bottom: 5px;">Total Picks</div>
                        <div id="totalPicks" style="font-size: 28px; font-weight: bold; color: #2196F3;">0</div>
                    </div>
                    <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); border-left: 4px solid #FF9800;">
                        <div style="color: #666; font-size: 14px; margin-bottom: 5px;">Bet Amount</div>
                        <div id="betAmount" style="font-size: 28px; font-weight: bold; color: #FF9800;">$10</div>
                    </div>
                    <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); border-left: 4px solid #9C27B0;">
                        <div style="color: #666; font-size: 14px; margin-bottom: 5px;">Potential Winnings</div>
                        <div id="potentialWinnings" style="font-size: 28px; font-weight: bold; color: #9C27B0;">$0</div>
                    </div>
                </div>
                
                <div class="form-group" style="max-width: 200px; margin-bottom: 20px;">
                    <label for="betAmountInput">Bet Amount ($)</label>
                    <input type="number" id="betAmountInput" value="10" min="1" onchange="updateCalculations()">
                </div>
                
                <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 20px; color: #333;">Payout Breakdown</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div style="padding: 15px; background: #f5f5f5; border-radius: 8px;">
                            <div style="color: #666; font-size: 14px; margin-bottom: 5px;">Gross Winnings</div>
                            <div id="grossWinnings" style="font-size: 24px; font-weight: bold; color: #333;">$0</div>
                        </div>
                        <div style="padding: 15px; background: #f5f5f5; border-radius: 8px;">
                            <div style="color: #666; font-size: 14px; margin-bottom: 5px;">Taxes (30%)</div>
                            <div id="taxes" style="font-size: 24px; font-weight: bold; color: #f44336;">$0</div>
                        </div>
                        <div style="padding: 15px; background: #f5f5f5; border-radius: 8px;">
                            <div style="color: #666; font-size: 14px; margin-bottom: 5px;">Net Winnings</div>
                            <div id="netWinnings" style="font-size: 24px; font-weight: bold; color: #4CAF50;">$0</div>
                        </div>
                        <div style="padding: 15px; background: #f5f5f5; border-radius: 8px;">
                            <div style="color: #666; font-size: 14px; margin-bottom: 5px;">Per Person (Net)</div>
                            <div id="perPerson" style="font-size: 24px; font-weight: bold; color: #2196F3;">$0</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="leaderboard" class="tab-pane">
                <div class="leaderboard">
                    <div class="leaderboard-header">
                        <h2>Season Leaderboard</h2>
                        <p>Track everyone picking performance</p>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Player</th>
                                <th>Wins</th>
                                <th>Losses</th>
                                <th>Draws</th>
                                <th>Win %</th>
                                <th>Contributions</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboardBody">
                            <tr><td colspan="7" style="text-align: center; color: #666;">No data available</td></tr>
                        </tbody>
                    </table>
                </div>
                
                <div style="margin-top: 30px;">
                    <button class="btn" onclick="resetLeaderboard()">Reset Season Stats</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <script>
        var weeklyPicks = {};
        var leaderboardData = {};
        var isSavingToFirebase = false; // Flag to prevent Firebase listener from overriding our saves
        function getCurrentNFLWeek() {
            // 2025 NFL Season started September 4, 2025 (Week 1)
            var seasonStart = new Date('2025-09-04');
            var today = new Date();
            
            // Calculate days since season start
            var daysSinceStart = Math.floor((today - seasonStart) / (1000 * 60 * 60 * 24));
            
            // NFL weeks run Tuesday to Monday, but Week 1 started on Thursday
            // Adjust for the Thursday start of Week 1
            var adjustedDays = daysSinceStart + 2; // Thursday = 2 days into the week
            
            // Calculate current week (each week is 7 days)
            var calculatedWeek = Math.floor(adjustedDays / 7) + 1;
            
            // Ensure we don't go beyond Week 18
            return Math.min(Math.max(calculatedWeek, 1), 18);
        }

        function updateCurrentWeekDropdown() {
            var currentNFLWeek = getCurrentNFLWeek();
            var mainSelect = document.getElementById('currentWeek');
            var summarySelect = document.getElementById('summaryWeekSelect');
            
            // Update main dropdown
            if (mainSelect) {
                // Clear existing "(Current Week)" labels
                for (var i = 0; i < mainSelect.options.length; i++) {
                    var option = mainSelect.options[i];
                    option.text = option.text.replace(' (Current Week)', '');
                }
                
                // Add "(Current Week)" to the current week
                var currentOption = mainSelect.options[currentNFLWeek - 1];
                if (currentOption) {
                    currentOption.text += ' (Current Week)';
                    currentOption.selected = true;
                }
            }
            
            // Update summary dropdown
            if (summarySelect) {
                // Clear existing "(Current Week)" labels
                for (var i = 0; i < summarySelect.options.length; i++) {
                    var option = summarySelect.options[i];
                    option.text = option.text.replace(' (Current Week)', '');
                }
                
                // Add "(Current Week)" to the current week
                var currentSummaryOption = summarySelect.options[currentNFLWeek - 1];
                if (currentSummaryOption) {
                    currentSummaryOption.text += ' (Current Week)';
                    currentSummaryOption.selected = true;
                }
            }
            
            return currentNFLWeek;
        }
        var nflSchedule = {};
        var database = null;
        
        var playerNames = [
            'Jace Allison',
            'Khaled Daher',
            'Michael Dixon',
            'Michael Hedges',
            'Elliott Kalin',
            'Brendan McAleer',
            'Nehad Osman',
            'Nick Rose',
            'Mario Sanelli',
            'Tyler Vander Boegh',
            'Jared Warren',
            'Taylor Young'
        ];

        var firebaseConfig = {
            apiKey: "AIzaSyCSen1b1IDNvRXg96CZXf9PTGURvCga3Cs",
            authDomain: "parlay-picker.firebaseapp.com",
            databaseURL: "https://parlay-picker-default-rtdb.firebaseio.com/",
            projectId: "parlay-picker",
            storageBucket: "parlay-picker.firebasestorage.app",
            messagingSenderId: "1086482831557",
            appId: "1:1086482831557:web:16e5f542a0d48e0dc538ac",
            measurementId: "G-E7F4G8DEN8"
        };

        var nfl2025Schedule = {
            1: [
                { matchup: 'Dallas Cowboys @ Philadelphia Eagles', time: 'TNF' },
                { matchup: 'Kansas City Chiefs @ Los Angeles Chargers', time: 'Early' },
                { matchup: 'Las Vegas Raiders @ New England Patriots', time: 'Early' },
                { matchup: 'Pittsburgh Steelers @ New York Jets', time: 'Early' },
                { matchup: 'Miami Dolphins @ Indianapolis Colts', time: 'Early' },
                { matchup: 'Arizona Cardinals @ New Orleans Saints', time: 'Early' },
                { matchup: 'New York Giants @ Washington Commanders', time: 'Early' },
                { matchup: 'Carolina Panthers @ Jacksonville Jaguars', time: 'Early' },
                { matchup: 'Cincinnati Bengals @ Cleveland Browns', time: 'Early' },
                { matchup: 'Tampa Bay Buccaneers @ Atlanta Falcons', time: 'Early' },
                { matchup: 'Tennessee Titans @ Denver Broncos', time: 'Late' },
                { matchup: 'San Francisco 49ers @ Seattle Seahawks', time: 'Late' },
                { matchup: 'Detroit Lions @ Green Bay Packers', time: 'Late' },
                { matchup: 'Houston Texans @ Los Angeles Rams', time: 'Late' },
                { matchup: 'Baltimore Ravens @ Buffalo Bills', time: 'SNF' },
                { matchup: 'Minnesota Vikings @ Chicago Bears', time: 'MNF' }
            ],
            2: [
                { matchup: 'Washington Commanders @ Green Bay Packers', time: 'TNF' },
                { matchup: 'Jacksonville Jaguars @ Cincinnati Bengals', time: 'Early' },
                { matchup: 'Buffalo Bills @ New York Jets', time: 'Early' },
                { matchup: 'New England Patriots @ Miami Dolphins', time: 'Early' },
                { matchup: 'Los Angeles Rams @ Tennessee Titans', time: 'Early' },
                { matchup: 'Cleveland Browns @ Baltimore Ravens', time: 'Early' },
                { matchup: 'San Francisco 49ers @ New Orleans Saints', time: 'Early' },
                { matchup: 'New York Giants @ Dallas Cowboys', time: 'Early' },
                { matchup: 'Seattle Seahawks @ Pittsburgh Steelers', time: 'Early' },
                { matchup: 'Chicago Bears @ Detroit Lions', time: 'Early' },
                { matchup: 'Denver Broncos @ Indianapolis Colts', time: 'Late' },
                { matchup: 'Carolina Panthers @ Arizona Cardinals', time: 'Late' },
                { matchup: 'Philadelphia Eagles @ Kansas City Chiefs', time: 'Late' },
                { matchup: 'Atlanta Falcons @ Minnesota Vikings', time: 'SNF' },
                { matchup: 'Tampa Bay Buccaneers @ Houston Texans', time: 'MNF' },
                { matchup: 'Los Angeles Chargers @ Las Vegas Raiders', time: 'MNF' }
            ],
            3: [
                { matchup: 'Miami Dolphins @ Buffalo Bills', time: 'TNF' },
                { matchup: 'Pittsburgh Steelers @ New England Patriots', time: 'Early' },
                { matchup: 'Houston Texans @ Jacksonville Jaguars', time: 'Early' },
                { matchup: 'Indianapolis Colts @ Tennessee Titans', time: 'Early' },
                { matchup: 'Cincinnati Bengals @ Minnesota Vikings', time: 'Early' },
                { matchup: 'New York Jets @ Tampa Bay Buccaneers', time: 'Early' },
                { matchup: 'Green Bay Packers @ Cleveland Browns', time: 'Early' },
                { matchup: 'Las Vegas Raiders @ Washington Commanders', time: 'Early' },
                { matchup: 'Atlanta Falcons @ Carolina Panthers', time: 'Early' },
                { matchup: 'Los Angeles Rams @ Philadelphia Eagles', time: 'Early' },
                { matchup: 'New Orleans Saints @ Seattle Seahawks', time: 'Late' },
                { matchup: 'Denver Broncos @ Los Angeles Chargers', time: 'Late' },
                { matchup: 'Dallas Cowboys @ Chicago Bears', time: 'Late' },
                { matchup: 'Arizona Cardinals @ San Francisco 49ers', time: 'Late' },
                { matchup: 'Kansas City Chiefs @ New York Giants', time: 'SNF' },
                { matchup: 'Detroit Lions @ Baltimore Ravens', time: 'MNF' }
            ],
            4: [
                { matchup: 'Seattle Seahawks @ Arizona Cardinals', time: 'TNF' },
                { matchup: 'Minnesota Vikings @ Pittsburgh Steelers', time: 'Early' },
                { matchup: 'New Orleans Saints @ Buffalo Bills', time: 'Early' },
                { matchup: 'Washington Commanders @ Atlanta Falcons', time: 'Early' },
                { matchup: 'Los Angeles Chargers @ New York Giants', time: 'Early' },
                { matchup: 'Tennessee Titans @ Houston Texans', time: 'Early' },
                { matchup: 'Cleveland Browns @ Detroit Lions', time: 'Early' },
                { matchup: 'Carolina Panthers @ New England Patriots', time: 'Early' },
                { matchup: 'Philadelphia Eagles @ Tampa Bay Buccaneers', time: 'Early' },
                { matchup: 'Jacksonville Jaguars @ San Francisco 49ers', time: 'Late' },
                { matchup: 'Indianapolis Colts @ Los Angeles Rams', time: 'Late' },
                { matchup: 'Baltimore Ravens @ Kansas City Chiefs', time: 'Late' },
                { matchup: 'Chicago Bears @ Las Vegas Raiders', time: 'Late' },
                { matchup: 'Green Bay Packers @ Dallas Cowboys', time: 'SNF' },
                { matchup: 'New York Jets @ Miami Dolphins', time: 'MNF' },
                { matchup: 'Cincinnati Bengals @ Denver Broncos', time: 'MNF' }
            ],
            5: [
                { matchup: 'San Francisco 49ers @ Los Angeles Rams', time: 'TNF' },
                { matchup: 'Minnesota Vikings @ Cleveland Browns', time: 'Early' },
                { matchup: 'New York Giants @ New Orleans Saints', time: 'Early' },
                { matchup: 'Denver Broncos @ Philadelphia Eagles', time: 'Early' },
                { matchup: 'Houston Texans @ Baltimore Ravens', time: 'Early' },
                { matchup: 'Dallas Cowboys @ New York Jets', time: 'Early' },
                { matchup: 'Las Vegas Raiders @ Indianapolis Colts', time: 'Early' },
                { matchup: 'Miami Dolphins @ Carolina Panthers', time: 'Early' },
                { matchup: 'Tennessee Titans @ Arizona Cardinals', time: 'Late' },
                { matchup: 'Tampa Bay Buccaneers @ Seattle Seahawks', time: 'Late' },
                { matchup: 'Washington Commanders @ Los Angeles Chargers', time: 'Late' },
                { matchup: 'Detroit Lions @ Cincinnati Bengals', time: 'Late' },
                { matchup: 'New England Patriots @ Buffalo Bills', time: 'SNF' },
                { matchup: 'Kansas City Chiefs @ Jacksonville Jaguars', time: 'MNF' }
            ],
            6: [
                { matchup: 'Philadelphia Eagles @ New York Giants', time: 'TNF' },
                { matchup: 'Denver Broncos @ New York Jets', time: 'Early' },
                { matchup: 'Cleveland Browns @ Pittsburgh Steelers', time: 'Early' },
                { matchup: 'Los Angeles Chargers @ Miami Dolphins', time: 'Early' },
                { matchup: 'San Francisco 49ers @ Tampa Bay Buccaneers', time: 'Early' },
                { matchup: 'Seattle Seahawks @ Jacksonville Jaguars', time: 'Early' },
                { matchup: 'Dallas Cowboys @ Carolina Panthers', time: 'Early' },
                { matchup: 'Los Angeles Rams @ Baltimore Ravens', time: 'Early' },
                { matchup: 'Arizona Cardinals @ Indianapolis Colts', time: 'Early' },
                { matchup: 'Tennessee Titans @ Las Vegas Raiders', time: 'Late' },
                { matchup: 'Cincinnati Bengals @ Green Bay Packers', time: 'Late' },
                { matchup: 'New England Patriots @ New Orleans Saints', time: 'Late' },
                { matchup: 'Detroit Lions @ Kansas City Chiefs', time: 'SNF' },
                { matchup: 'Chicago Bears @ Washington Commanders', time: 'MNF' },
                { matchup: 'Buffalo Bills @ Atlanta Falcons', time: 'MNF' }
            ],
            7: [
                { matchup: 'Pittsburgh Steelers @ Cincinnati Bengals', time: 'TNF' },
                { matchup: 'Los Angeles Rams @ Jacksonville Jaguars', time: 'Early' },
                { matchup: 'New England Patriots @ Tennessee Titans', time: 'Early' },
                { matchup: 'Miami Dolphins @ Cleveland Browns', time: 'Early' },
                { matchup: 'Las Vegas Raiders @ Kansas City Chiefs', time: 'Early' },
                { matchup: 'Carolina Panthers @ New York Jets', time: 'Early' },
                { matchup: 'New Orleans Saints @ Chicago Bears', time: 'Early' },
                { matchup: 'Philadelphia Eagles @ Minnesota Vikings', time: 'Early' },
                { matchup: 'New York Giants @ Denver Broncos', time: 'Late' },
                { matchup: 'Indianapolis Colts @ Los Angeles Chargers', time: 'Late' },
                { matchup: 'Washington Commanders @ Dallas Cowboys', time: 'Late' },
                { matchup: 'Green Bay Packers @ Arizona Cardinals', time: 'Late' },
                { matchup: 'Atlanta Falcons @ San Francisco 49ers', time: 'SNF' },
                { matchup: 'Tampa Bay Buccaneers @ Detroit Lions', time: 'MNF' },
                { matchup: 'Houston Texans @ Seattle Seahawks', time: 'MNF' }
            ],
            8: [
                { matchup: 'Minnesota Vikings @ Los Angeles Chargers', time: 'TNF' },
                { matchup: 'New York Jets @ Cincinnati Bengals', time: 'Early' },
                { matchup: 'Chicago Bears @ Baltimore Ravens', time: 'Early' },
                { matchup: 'Miami Dolphins @ Atlanta Falcons', time: 'Early' },
                { matchup: 'Cleveland Browns @ New England Patriots', time: 'Early' },
                { matchup: 'New York Giants @ Philadelphia Eagles', time: 'Early' },
                { matchup: 'Buffalo Bills @ Carolina Panthers', time: 'Early' },
                { matchup: 'San Francisco 49ers @ Houston Texans', time: 'Early' },
                { matchup: 'Tampa Bay Buccaneers @ New Orleans Saints', time: 'Late' },
                { matchup: 'Dallas Cowboys @ Denver Broncos', time: 'Late' },
                { matchup: 'Tennessee Titans @ Indianapolis Colts', time: 'Late' },
                { matchup: 'Green Bay Packers @ Pittsburgh Steelers', time: 'SNF' },
                { matchup: 'Washington Commanders @ Kansas City Chiefs', time: 'MNF' }
            ],
            9: [
                { matchup: 'Baltimore Ravens @ Miami Dolphins', time: 'TNF' },
                { matchup: 'Indianapolis Colts @ Pittsburgh Steelers', time: 'Early' },
                { matchup: 'Atlanta Falcons @ New England Patriots', time: 'Early' },
                { matchup: 'Chicago Bears @ Cincinnati Bengals', time: 'Early' },
                { matchup: 'Los Angeles Chargers @ Tennessee Titans', time: 'Early' },
                { matchup: 'San Francisco 49ers @ New York Giants', time: 'Early' },
                { matchup: 'Carolina Panthers @ Green Bay Packers', time: 'Early' },
                { matchup: 'Denver Broncos @ Houston Texans', time: 'Early' },
                { matchup: 'Minnesota Vikings @ Detroit Lions', time: 'Early' },
                { matchup: 'Jacksonville Jaguars @ Las Vegas Raiders', time: 'Late' },
                { matchup: 'New Orleans Saints @ Los Angeles Rams', time: 'Late' },
                { matchup: 'Kansas City Chiefs @ Buffalo Bills', time: 'Late' },
                { matchup: 'Seattle Seahawks @ Washington Commanders', time: 'SNF' },
                { matchup: 'Arizona Cardinals @ Dallas Cowboys', time: 'MNF' }
            ],
            10: [
                { matchup: 'Las Vegas Raiders @ Denver Broncos', time: 'TNF' },
                { matchup: 'Atlanta Falcons @ Indianapolis Colts', time: 'Early' },
                { matchup: 'Jacksonville Jaguars @ Houston Texans', time: 'Early' },
                { matchup: 'Buffalo Bills @ Miami Dolphins', time: 'Early' },
                { matchup: 'New England Patriots @ Tampa Bay Buccaneers', time: 'Early' },
                { matchup: 'Cleveland Browns @ New York Jets', time: 'Early' },
                { matchup: 'New York Giants @ Chicago Bears', time: 'Early' },
                { matchup: 'New Orleans Saints @ Carolina Panthers', time: 'Early' },
                { matchup: 'Baltimore Ravens @ Minnesota Vikings', time: 'Early' },
                { matchup: 'Arizona Cardinals @ Seattle Seahawks', time: 'Late' },
                { matchup: 'Los Angeles Rams @ San Francisco 49ers', time: 'Late' },
                { matchup: 'Detroit Lions @ Washington Commanders', time: 'Late' },
                { matchup: 'Pittsburgh Steelers @ Los Angeles Chargers', time: 'SNF' },
                { matchup: 'Philadelphia Eagles @ Green Bay Packers', time: 'MNF' }
            ],
            11: [
                { matchup: 'New York Jets @ New England Patriots', time: 'TNF' },
                { matchup: 'Washington Commanders @ Miami Dolphins', time: 'Early' },
                { matchup: 'Tampa Bay Buccaneers @ Buffalo Bills', time: 'Early' },
                { matchup: 'Los Angeles Chargers @ Jacksonville Jaguars', time: 'Early' },
                { matchup: 'Cincinnati Bengals @ Pittsburgh Steelers', time: 'Early' },
                { matchup: 'Carolina Panthers @ Atlanta Falcons', time: 'Early' },
                { matchup: 'Green Bay Packers @ New York Giants', time: 'Early' },
                { matchup: 'Chicago Bears @ Minnesota Vikings', time: 'Early' },
                { matchup: 'Houston Texans @ Tennessee Titans', time: 'Early' },
                { matchup: 'San Francisco 49ers @ Arizona Cardinals', time: 'Late' },
                { matchup: 'Seattle Seahawks @ Los Angeles Rams', time: 'Late' },
                { matchup: 'Kansas City Chiefs @ Denver Broncos', time: 'Late' },
                { matchup: 'Baltimore Ravens @ Cleveland Browns', time: 'Late' },
                { matchup: 'Detroit Lions @ Philadelphia Eagles', time: 'SNF' },
                { matchup: 'Dallas Cowboys @ Las Vegas Raiders', time: 'MNF' }
            ],
            12: [
                { matchup: 'Buffalo Bills @ Houston Texans', time: 'TNF' },
                { matchup: 'New England Patriots @ Cincinnati Bengals', time: 'Early' },
                { matchup: 'Pittsburgh Steelers @ Chicago Bears', time: 'Early' },
                { matchup: 'Indianapolis Colts @ Kansas City Chiefs', time: 'Early' },
                { matchup: 'New York Jets @ Baltimore Ravens', time: 'Early' },
                { matchup: 'New York Giants @ Detroit Lions', time: 'Early' },
                { matchup: 'Seattle Seahawks @ Tennessee Titans', time: 'Early' },
                { matchup: 'Minnesota Vikings @ Green Bay Packers', time: 'Early' },
                { matchup: 'Cleveland Browns @ Las Vegas Raiders', time: 'Late' },
                { matchup: 'Jacksonville Jaguars @ Arizona Cardinals', time: 'Late' },
                { matchup: 'Atlanta Falcons @ New Orleans Saints', time: 'Late' },
                { matchup: 'Philadelphia Eagles @ Dallas Cowboys', time: 'Late' },
                { matchup: 'Tampa Bay Buccaneers @ Los Angeles Rams', time: 'SNF' },
                { matchup: 'Carolina Panthers @ San Francisco 49ers', time: 'MNF' }
            ],
            13: [
                { matchup: 'Green Bay Packers @ Detroit Lions', time: 'TNF' },
                { matchup: 'Kansas City Chiefs @ Dallas Cowboys', time: 'Early' },
                { matchup: 'Cincinnati Bengals @ Baltimore Ravens', time: 'Late' },
                { matchup: 'Chicago Bears @ Philadelphia Eagles', time: 'Early' },
                { matchup: 'San Francisco 49ers @ Cleveland Browns', time: 'Early' },
                { matchup: 'Jacksonville Jaguars @ Tennessee Titans', time: 'Early' },
                { matchup: 'Houston Texans @ Indianapolis Colts', time: 'Early' },
                { matchup: 'Arizona Cardinals @ Tampa Bay Buccaneers', time: 'Early' },
                { matchup: 'New Orleans Saints @ Miami Dolphins', time: 'Early' },
                { matchup: 'Atlanta Falcons @ New York Jets', time: 'Early' },
                { matchup: 'Los Angeles Rams @ Carolina Panthers', time: 'Early' },
                { matchup: 'Minnesota Vikings @ Seattle Seahawks', time: 'Late' },
                { matchup: 'Buffalo Bills @ Pittsburgh Steelers', time: 'Late' },
                { matchup: 'Las Vegas Raiders @ Los Angeles Chargers', time: 'Late' },
                { matchup: 'Denver Broncos @ Washington Commanders', time: 'SNF' },
                { matchup: 'New York Giants @ New England Patriots', time: 'MNF' }
            ],
            14: [
                { matchup: 'Dallas Cowboys @ Detroit Lions', time: 'TNF' },
                { matchup: 'Indianapolis Colts @ Jacksonville Jaguars', time: 'Early' },
                { matchup: 'New Orleans Saints @ Tampa Bay Buccaneers', time: 'Early' },
                { matchup: 'Miami Dolphins @ New York Jets', time: 'Early' },
                { matchup: 'Pittsburgh Steelers @ Baltimore Ravens', time: 'Early' },
                { matchup: 'Seattle Seahawks @ Atlanta Falcons', time: 'Early' },
                { matchup: 'Tennessee Titans @ Cleveland Browns', time: 'Early' },
                { matchup: 'Washington Commanders @ Minnesota Vikings', time: 'Early' },
                { matchup: 'Chicago Bears @ Green Bay Packers', time: 'Early' },
                { matchup: 'Denver Broncos @ Las Vegas Raiders', time: 'Late' },
                { matchup: 'Los Angeles Rams @ Arizona Cardinals', time: 'Late' },
                { matchup: 'Cincinnati Bengals @ Buffalo Bills', time: 'Late' },
                { matchup: 'Houston Texans @ Kansas City Chiefs', time: 'SNF' },
                { matchup: 'Philadelphia Eagles @ Los Angeles Chargers', time: 'MNF' }
            ],
            15: [
                { matchup: 'Atlanta Falcons @ Tampa Bay Buccaneers', time: 'TNF' },
                { matchup: 'Los Angeles Chargers @ Kansas City Chiefs', time: 'Early' },
                { matchup: 'Buffalo Bills @ New England Patriots', time: 'Early' },
                { matchup: 'New York Jets @ Jacksonville Jaguars', time: 'Early' },
                { matchup: 'Baltimore Ravens @ Cincinnati Bengals', time: 'Early' },
                { matchup: 'Las Vegas Raiders @ Philadelphia Eagles', time: 'Early' },
                { matchup: 'Arizona Cardinals @ Houston Texans', time: 'Early' },
                { matchup: 'Washington Commanders @ New York Giants', time: 'Early' },
                { matchup: 'Cleveland Browns @ Chicago Bears', time: 'Early' },
                { matchup: 'Detroit Lions @ Los Angeles Rams', time: 'Late' },
                { matchup: 'Tennessee Titans @ San Francisco 49ers', time: 'Late' },
                { matchup: 'Carolina Panthers @ New Orleans Saints', time: 'Late' },
                { matchup: 'Green Bay Packers @ Denver Broncos', time: 'Late' },
                { matchup: 'Indianapolis Colts @ Seattle Seahawks', time: 'Late' },
                { matchup: 'Minnesota Vikings @ Dallas Cowboys', time: 'SNF' },
                { matchup: 'Miami Dolphins @ Pittsburgh Steelers', time: 'MNF' }
            ],
            16: [
                { matchup: 'Los Angeles Rams @ Seattle Seahawks', time: 'TNF' },
                { matchup: 'Green Bay Packers @ Chicago Bears', time: 'Early' },
                { matchup: 'Philadelphia Eagles @ Washington Commanders', time: 'Early' },
                { matchup: 'Kansas City Chiefs @ Tennessee Titans', time: 'Early' },
                { matchup: 'New York Jets @ New Orleans Saints', time: 'Early' },
                { matchup: 'New England Patriots @ Baltimore Ravens', time: 'Early' },
                { matchup: 'Buffalo Bills @ Cleveland Browns', time: 'Early' },
                { matchup: 'Tampa Bay Buccaneers @ Carolina Panthers', time: 'Early' },
                { matchup: 'Minnesota Vikings @ New York Giants', time: 'Early' },
                { matchup: 'Los Angeles Chargers @ Dallas Cowboys', time: 'Early' },
                { matchup: 'Atlanta Falcons @ Arizona Cardinals', time: 'Late' },
                { matchup: 'Jacksonville Jaguars @ Denver Broncos', time: 'Late' },
                { matchup: 'Pittsburgh Steelers @ Detroit Lions', time: 'Late' },
                { matchup: 'Las Vegas Raiders @ Houston Texans', time: 'Late' },
                { matchup: 'Cincinnati Bengals @ Miami Dolphins', time: 'SNF' },
                { matchup: 'San Francisco 49ers @ Indianapolis Colts', time: 'MNF' }
            ],
            17: [
                { matchup: 'Dallas Cowboys @ Washington Commanders', time: 'Early' },
                { matchup: 'Detroit Lions @ Minnesota Vikings', time: 'Early' },
                { matchup: 'Denver Broncos @ Kansas City Chiefs', time: 'Late' },
                { matchup: 'New York Giants @ Las Vegas Raiders', time: 'Early' },
                { matchup: 'Houston Texans @ Los Angeles Chargers', time: 'Early' },
                { matchup: 'Arizona Cardinals @ Cincinnati Bengals', time: 'Early' },
                { matchup: 'Baltimore Ravens @ Green Bay Packers', time: 'Early' },
                { matchup: 'Seattle Seahawks @ Carolina Panthers', time: 'Early' },
                { matchup: 'New Orleans Saints @ Tennessee Titans', time: 'Early' },
                { matchup: 'Pittsburgh Steelers @ Cleveland Browns', time: 'Early' },
                { matchup: 'New England Patriots @ New York Jets', time: 'Early' },
                { matchup: 'Jacksonville Jaguars @ Indianapolis Colts', time: 'Early' },
                { matchup: 'Tampa Bay Buccaneers @ Miami Dolphins', time: 'Early' },
                { matchup: 'Philadelphia Eagles @ Buffalo Bills', time: 'Late' },
                { matchup: 'Chicago Bears @ San Francisco 49ers', time: 'SNF' },
                { matchup: 'Los Angeles Rams @ Atlanta Falcons', time: 'MNF' }
            ],
            18: [
                { matchup: 'New York Jets @ Buffalo Bills', time: 'Early' },
                { matchup: 'Kansas City Chiefs @ Las Vegas Raiders', time: 'Early' },
                { matchup: 'Baltimore Ravens @ Pittsburgh Steelers', time: 'Early' },
                { matchup: 'Cleveland Browns @ Cincinnati Bengals', time: 'Early' },
                { matchup: 'Miami Dolphins @ New England Patriots', time: 'Early' },
                { matchup: 'Tennessee Titans @ Jacksonville Jaguars', time: 'Early' },
                { matchup: 'Los Angeles Chargers @ Denver Broncos', time: 'Early' },
                { matchup: 'Indianapolis Colts @ Houston Texans', time: 'Early' },
                { matchup: 'Detroit Lions @ Chicago Bears', time: 'Early' },
                { matchup: 'Green Bay Packers @ Minnesota Vikings', time: 'Early' },
                { matchup: 'New Orleans Saints @ Atlanta Falcons', time: 'Early' },
                { matchup: 'Seattle Seahawks @ San Francisco 49ers', time: 'Early' },
                { matchup: 'Washington Commanders @ Philadelphia Eagles', time: 'Early' },
                { matchup: 'Dallas Cowboys @ New York Giants', time: 'Early' },
                { matchup: 'Carolina Panthers @ Tampa Bay Buccaneers', time: 'Early' },
                { matchup: 'Arizona Cardinals @ Los Angeles Rams', time: 'Early' }
            ]
        };

        window.onload = function() {
            initializeApp();
        };

        function initializeApp() {
            try {
                if (typeof firebase !== 'undefined') {
                    firebase.initializeApp(firebaseConfig);
                    database = firebase.database();
                    console.log('Firebase initialized successfully');
                    
                    // Load data from Firebase
                    loadDataFromFirebase();
                } else {
                    console.log('Firebase not available - using local storage only');
                }
            } catch (error) {
                console.error('Firebase error:', error);
            }
            
            // Set current week dynamically
            var calculatedCurrentWeek = updateCurrentWeekDropdown();
            currentWeek = calculatedCurrentWeek;
            currentNFLWeek = calculatedCurrentWeek;
            
            // Update the summary week display text
            document.getElementById('summaryWeek').textContent = calculatedCurrentWeek;
            
            nflSchedule = nfl2025Schedule;
            renderAllPicks();
            updateCalculations();
        }

        function loadDataFromFirebase() {
            if (!database) return;
            
            // Load weekly picks
            database.ref('weeklyPicks').on('value', function(snapshot) {
                // Skip if we're currently saving to prevent race condition
                if (isSavingToFirebase) return;
                
                var data = snapshot.val();
                if (data) {
                    weeklyPicks = data;
                    renderAllPicks();
                    updateCalculations();
                    updateParlayStatus();
                    console.log('Loaded picks from Firebase');
                }
            });
            
            // Load leaderboard data
            database.ref('leaderboardData').on('value', function(snapshot) {
                var data = snapshot.val();
                if (data) {
                    leaderboardData = data;
                    updateLeaderboard();
                    console.log('Loaded leaderboard from Firebase');
                }
            });
        }

        function saveToFirebase() {
            if (!database) {
                console.log('Firebase not available - data not saved');
                return;
            }
            
            try {
                // Set flag to prevent Firebase listener from overriding our save
                isSavingToFirebase = true;
                
                // Save weekly picks
                database.ref('weeklyPicks').set(weeklyPicks);
                
                // Update leaderboard data
                updateLeaderboardData();
                database.ref('leaderboardData').set(leaderboardData);
                
                console.log('Data saved to Firebase');
                
                // Clear flag after a short delay to allow Firebase to process
                setTimeout(function() {
                    isSavingToFirebase = false;
                }, 1000);
                
            } catch (error) {
                console.error('Error saving to Firebase:', error);
                showNotification('Error saving to database. Changes may not sync.', 'error');
                isSavingToFirebase = false; // Clear flag on error
            }
        }

        function updateWeek() {
            currentWeek = parseInt(document.getElementById('currentWeek').value);
            currentNFLWeek = currentWeek; // Keep them synced
            
            // Sync the summary week selector
            var summarySelect = document.getElementById('summaryWeekSelect');
            if (summarySelect) {
                summarySelect.value = currentWeek;
            }
            
            document.getElementById('summaryWeek').textContent = currentWeek;
            renderAllPicks();
            updateCalculations();
            updateParlayStatus();
        }

        function updateWeekFromSummary() {
            currentWeek = parseInt(document.getElementById('summaryWeekSelect').value);
            currentNFLWeek = currentWeek; // Keep them synced
            
            // Sync the main week selector
            var mainSelect = document.getElementById('currentWeek');
            if (mainSelect) {
                mainSelect.value = currentWeek;
            }
            
            document.getElementById('summaryWeek').textContent = currentWeek;
            renderAllPicks();
            updateCalculations();
            updateParlayStatus();
        }

        function renderAllPicks() {
            var container = document.getElementById('pickSlotsContainer');
            container.innerHTML = '';
            
            var savedPicks = weeklyPicks[currentWeek] || [];
            
            // Ensure savedPicks is always an array
            if (!Array.isArray(savedPicks)) {
                savedPicks = [];
                weeklyPicks[currentWeek] = savedPicks;
            }
            
            var numberOfLegs = parseInt(document.getElementById('numberOfLegs').value);
            
            var gameGroups = {};
            savedPicks.forEach(function(pick, index) {
                if (pick && pick.game) {
                    if (!gameGroups[pick.game]) {
                        gameGroups[pick.game] = [];
                    }
                    gameGroups[pick.game].push(pick);
                }
            });
            
            var renderedSlots = {};
            
            for (var game in gameGroups) {
                if (gameGroups[game].length >= 2) {
                    var sgpDiv = createSGPGroup(game, gameGroups[game]);
                    container.appendChild(sgpDiv);
                    
                    gameGroups[game].forEach(function(pick) {
                        var index = savedPicks.indexOf(pick);
                        if (index >= 0) renderedSlots[index] = true;
                    });
                }
            }
            
            for (var i = 0; i < numberOfLegs; i++) {
                if (!renderedSlots[i]) {
                    var pick = savedPicks[i] || null;
                    var slot = createPickSlot(i, pick);
                    container.appendChild(slot);
                }
            }
        }

        function createSGPGroup(game, picks) {
            var gameId = game.replace(/[^a-zA-Z0-9]/g, '');
            var div = document.createElement('div');
            div.className = 'sgp-group';
            
            var activeLegs = picks.filter(function(p) { return p.result !== 'draw'; });
            var hasOnlyOneLeg = activeLegs.length === 1;
            
            // Determine SGP status
            var status = 'PENDING';
            var statusClass = 'pending';
            var results = picks.map(function(p) { return p.result; });
            
            if (results.every(function(r) { return r === true; })) {
                status = 'WIN';
                statusClass = 'win';
            } else if (results.some(function(r) { return r === false; })) {
                status = 'LOSS';
                statusClass = 'loss';
            } else if (results.some(function(r) { return r === 'draw'; })) {
                status = 'DRAW';
                statusClass = 'draw';
            } else if (picks[0].sgpOdds && picks[0].sgpOdds.trim() !== '') {
                status = '✓ SUBMITTED';
                statusClass = 'submitted';
            }
            
            var sgpOddsStyle = hasOnlyOneLeg ? 
                'width: 100px; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; text-decoration: line-through; color: #999; background: #f5f5f5;' :
                'width: 100px; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px;';
            
            var sgpOddsValue = picks[0].sgpOdds || '';
            var saveButtonStyle = (sgpOddsValue && sgpOddsValue.trim() !== '') ? 
                'background: #757575; cursor: not-allowed;' : 
                'background: #4CAF50; cursor: pointer;';
            var saveButtonText = (sgpOddsValue && sgpOddsValue.trim() !== '') ? 
                '💾 SGP Saved' : 
                '💾 Save SGP';
            var saveButtonDisabled = (sgpOddsValue && sgpOddsValue.trim() !== '') ? 
                'disabled' : '';
            
            var html = '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">' +
                '<div style="font-size: 15px; font-weight: bold; color: #FF9800;">' + game + (hasOnlyOneLeg ? ' (Single Bet)' : '') + '</div>' +
                '<span class="result-indicator ' + statusClass + '" style="font-size: 13px;">' + (hasOnlyOneLeg ? '' : 'SGP ') + status + '</span>' +
                '</div>' +
                '<div style="display: flex; justify-content: flex-end; margin-bottom: 10px;">' +
                '<div style="display: flex; align-items: center; gap: 8px; background: white; border: 1px solid #FF9800; border-radius: 6px; padding: 6px 10px;">' +
                '<label style="font-size: 13px; font-weight: bold; color: #FF9800; margin: 0;">SGP Odds' + (hasOnlyOneLeg ? ' (not used)' : '') + ':</label>' +
                '<input type="text" value="' + sgpOddsValue + '" placeholder="-110, +200" data-game="' + game + '" class="sgp-odds-input" style="' + sgpOddsStyle + '" onblur="formatSGPOddsInput(this)" onchange="enableSGPSaveButton(\'' + game + '\')" data-original="' + sgpOddsValue + '" ' + (hasOnlyOneLeg ? 'readonly' : '') + '>' +
                '</div>' +
                '</div>';
            
            div.innerHTML = html;
            
            picks.forEach(function(pick) {
                var pickIndex = weeklyPicks[currentWeek].indexOf(pick);
                var pickDiv = createSGPPickSlot(pickIndex, pick, hasOnlyOneLeg);
                div.appendChild(pickDiv);
            });
            
            var btnDiv = document.createElement('div');
            btnDiv.style.cssText = 'text-align: center; margin-top: 10px;';
            var saveBtn = document.createElement('button');
            saveBtn.className = 'btn';
            saveBtn.style.cssText = saveButtonStyle + '; color: white; padding: 8px 16px; font-size: 13px;';
            saveBtn.textContent = saveButtonText;
            saveBtn.id = 'sgpSaveBtn_' + gameId;
            if (saveButtonDisabled) saveBtn.disabled = true;
            saveBtn.onclick = function() {
                saveSGPOdds(game);
            };
            btnDiv.appendChild(saveBtn);
            div.appendChild(btnDiv);
            
            return div;
        }

        function createSGPPickSlot(index, pick, hasOnlyOneLeg) {
            var div = document.createElement('div');
            div.className = 'pick-slot';
            div.style.cssText = 'background: rgba(255, 152, 0, 0.05); border-color: #FFB74D; margin-bottom: 8px; padding: 16px;';
            
            // Determine result status and styling  
            var resultClass, resultText;
            var isSubmitted = pick && pick.playerName && pick.pick && pick.odds;
            
            if (pick.result === true) {
                resultClass = 'win';
                resultText = 'WIN';
            } else if (pick.result === false) {
                resultClass = 'loss';
                resultText = 'LOSS';
            } else if (pick.result === 'draw') {
                resultClass = 'draw';
                resultText = 'DRAW';
            } else if (isSubmitted) {
                resultClass = 'submitted';
                resultText = '✓ SUBMITTED';
            } else {
                resultClass = 'pending';
                resultText = 'PENDING';
            }
            
            var winActive = pick.result === true ? 'active' : '';
            var lossActive = pick.result === false ? 'active' : '';
            var drawActive = pick.result === 'draw' ? 'active' : '';
            
            var voidWarning = '';
            if (pick.result === 'draw') {
                voidWarning = '<div style="background: #FF9800; color: white; padding: 6px; border-radius: 4px; margin-top: 6px; font-size: 11px; font-weight: bold;">⚠️ VOIDED LEG - Removed from SGP calculation</div>';
            }
            
            var oddsLabel = hasOnlyOneLeg ? 'Odds' : 'Odds <span style="font-size: 10px; color: #999;">(not used in SGP)</span>';
            var oddsStyle = hasOnlyOneLeg ? 'background: white;' : 'text-decoration: line-through; color: #666; background: #f5f5f5;';
            var oddsValue = pick.odds || '';
            
            var playerName = pick.playerName || ('Pick ' + (index + 1));
            
            var html;
            var isEditing = pick && pick.isEditing;
            
            if (isSubmitted && !isEditing) {
                // Truncated view for submitted SGP picks (similar to summary page)
                var textStyle = pick.result === 'draw' ? 'text-decoration: line-through; opacity: 0.5;' : '';
                
                html = '<div style="background: linear-gradient(135deg, #FF9800, #F57C00); color: white; padding: 8px 16px; margin: -16px -16px 10px -16px; border-radius: 8px 8px 0 0; display: flex; justify-content: space-between; align-items: center;">' +
                    '<div style="display: flex; align-items: center; gap: 8px;">' +
                    '<span id="playerNameDisplay' + index + '" style="font-size: 16px; font-weight: bold;">' + playerName + '</span>' +
                    '<input type="text" id="playerNameEdit' + index + '" value="' + playerName + '" style="display: none; padding: 4px 8px; border: 2px solid white; border-radius: 4px; font-size: 14px; font-weight: bold;">' +
                    '<button onclick="toggleEditPlayerName(' + index + ')" id="editBtn' + index + '" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">✏️ Edit</button>' +
                '</div>' +
                    '<span class="result-indicator ' + resultClass + '" style="font-size: 12px;">' + resultText + '</span>' +
                '</div>' +
                    '<div style="padding: 12px; ' + textStyle + '">' +
                    '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">' +
                    '<div>' +
                    '<strong>' + playerName + ':</strong> ' + pick.pick +
                    '<div style="color: #666; font-size: 12px; margin-top: 3px;">' +
                    (pick.game ? pick.game : 'No game selected') +
                    ' • <strong>' + pick.odds + '</strong>' +
                    (pick.timeSlot ? ' • <span style="color: #FF9800; font-weight: 500;">' + pick.timeSlot + '</span>' : '') +
                    '</div>' +
                    '</div>' +
                    '<span style="background: ' + (resultClass === 'win' ? '#4CAF50' : resultClass === 'loss' ? '#f44336' : resultClass === 'draw' ? '#FF9800' : '#757575') + '; color: white; padding: 3px 6px; border-radius: 4px; font-size: 11px; font-weight: bold;">' + resultText + '</span>' +
                    '</div>' +
                    '</div>' +
                    '<div style="display: flex; gap: 6px; margin-top: 8px; align-items: center; flex-wrap: wrap; justify-content: space-between;">' +
                    '<div style="display: flex; gap: 6px;">' +
                    '<button class="result-btn win ' + winActive + '" onclick="toggleResult(' + index + ', true)" style="padding: 6px 12px; font-size: 12px;">✓ Win</button>' +
                    '<button class="result-btn loss ' + lossActive + '" onclick="toggleResult(' + index + ', false)" style="padding: 6px 12px; font-size: 12px;">✗ Loss</button>' +
                    '<button class="result-btn draw ' + drawActive + '" onclick="toggleResult(' + index + ', \'draw\')" style="padding: 6px 12px; font-size: 12px;">🤝 Draw</button>' +
                    '<button class="result-btn reset" onclick="toggleResult(' + index + ', null)" style="padding: 6px 12px; font-size: 12px;">↻ Reset</button>' +
                    '</div>' +
                    '<div style="display: flex; gap: 6px;">' +
                    '<button class="result-btn" style="background: #2196F3; color: white; padding: 6px 12px; font-size: 12px;" onclick="expandSGPPickSlot(' + index + ')">✏️ Edit Pick</button>' +
                    '<button class="result-btn" style="background: #f44336; color: white; padding: 6px 12px; font-size: 12px;" onclick="removeSGPPick(' + index + ')">🗑️ Remove</button>' +
                    '</div>' +
                    '</div>';
            } else {
                // Full form view for unsaved SGP picks or when editing
                html = '<div style="background: linear-gradient(135deg, #FF9800, #F57C00); color: white; padding: 8px 16px; margin: -16px -16px 10px -16px; border-radius: 8px 8px 0 0; display: flex; justify-content: space-between; align-items: center;">' +
                    '<div style="display: flex; align-items: center; gap: 8px;">' +
                    '<span id="playerNameDisplay' + index + '" style="font-size: 16px; font-weight: bold;">' + playerName + '</span>' +
                    '<input type="text" id="playerNameEdit' + index + '" value="' + playerName + '" style="display: none; padding: 4px 8px; border: 2px solid white; border-radius: 4px; font-size: 14px; font-weight: bold;">' +
                    '<button onclick="toggleEditPlayerName(' + index + ')" id="editBtn' + index + '" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">✏️ Edit</button>' +
                    '</div>' +
                    '<span class="result-indicator ' + resultClass + '" style="font-size: 12px;">' + resultText + '</span>' +
                    '</div>' +
                    '<div class="pick-slot-fields" style="gap: 8px; margin-bottom: 8px;">' +
                    '<div class="pick-slot-field"><label style="font-size: 11px;">Pick/Bet</label><input type="text" id="pick' + index + '" value="' + (pick.pick || '') + '" ' + (isEditing ? 'onchange="checkForChanges(' + index + ')" data-original="' + (pick.pick || '') + '"' : 'readonly style="background: #f5f5f5; padding: 6px 8px; font-size: 13px;"') + '></div>' +
                    '<div class="pick-slot-field"><label style="font-size: 11px;">' + oddsLabel + '</label><input type="text" id="odds' + index + '" value="' + oddsValue + '" ' + (isEditing ? 'onblur="formatOdds(' + index + ')" onchange="checkForChanges(' + index + ')" data-original="' + oddsValue + '"' : 'readonly style="' + oddsStyle + '; padding: 6px 8px; font-size: 13px;"') + '></div>' +
                    '<div class="pick-slot-field"><label style="font-size: 11px;">Game</label>' + (isEditing ? '<select id="game' + index + '" onchange="updateTimeSlotFromGame(' + index + '); checkForChanges(' + index + ')" data-original="' + (pick.game || '') + '"><option value="">Select Game</option>' + generateGameOptions(pick.game) + '</select>' : '<input type="text" value="' + (pick.game || '') + '" readonly style="background: #f5f5f5; padding: 6px 8px; font-size: 13px;">') + '</div>' +
                    '<div class="pick-slot-field"><label style="font-size: 11px;">Time Slot</label>' + (isEditing ? '<select id="timeSlot' + index + '" onchange="checkForChanges(' + index + ')" data-original="' + (pick.timeSlot || '') + '"><option value="">Select</option><option value="TNF"' + (pick.timeSlot === 'TNF' ? ' selected' : '') + '>TNF</option><option value="Early"' + (pick.timeSlot === 'Early' ? ' selected' : '') + '>Early</option><option value="Late"' + (pick.timeSlot === 'Late' ? ' selected' : '') + '>Late</option><option value="SNF"' + (pick.timeSlot === 'SNF' ? ' selected' : '') + '>SNF</option><option value="MNF"' + (pick.timeSlot === 'MNF' ? ' selected' : '') + '>MNF</option></select>' : '<input type="text" value="' + (pick.timeSlot || '') + '" readonly style="background: #f5f5f5; padding: 6px 8px; font-size: 13px;">') + '</div>' +
                '</div>' + voidWarning +
                    '<div style="display: flex; gap: 6px; margin-top: 8px; align-items: center; flex-wrap: wrap; justify-content: space-between;">' +
                    '<div style="display: flex; gap: 6px;">' +
                    '<button class="result-btn win ' + winActive + '" onclick="toggleResult(' + index + ', true)" style="padding: 6px 12px; font-size: 12px;">✓ Win</button>' +
                    '<button class="result-btn loss ' + lossActive + '" onclick="toggleResult(' + index + ', false)" style="padding: 6px 12px; font-size: 12px;">✗ Loss</button>' +
                    '<button class="result-btn draw ' + drawActive + '" onclick="toggleResult(' + index + ', \'draw\')" style="padding: 6px 12px; font-size: 12px;">🤝 Draw</button>' +
                    '<button class="result-btn reset" onclick="toggleResult(' + index + ', null)" style="padding: 6px 12px; font-size: 12px;">↻ Reset</button>' +
                '</div>' +
                    '<div style="border-left: 1px solid #ddd; padding-left: 6px; margin-left: 6px; display: flex; gap: 6px;">' +
                    (isEditing ? '<button class="result-btn" id="saveBtn' + index + '" style="background: #757575; color: white; cursor: not-allowed;" onclick="savePick(' + index + ')" disabled>💾 Save</button><button class="result-btn" style="background: #6b7280; color: white; padding: 6px 12px; font-size: 12px;" onclick="cancelEditSGPPick(' + index + ')">❌ Cancel</button>' : '<button class="result-btn" style="background: #2196F3; color: white; padding: 6px 12px; font-size: 12px;" onclick="expandSGPPickSlot(' + index + ')">✏️ Edit Pick</button>') +
                    '<button class="result-btn" style="background: #f44336; color: white; padding: 6px 12px; font-size: 12px;" onclick="removeSGPPick(' + index + ')">🗑️ Remove</button>' +
                '</div>' +
                '</div>';
            }
            
            div.innerHTML = html;
            return div;
        }

        function createPickSlot(index, pick) {
            var div = document.createElement('div');
            var className = 'pick-slot';
            if (pick) {
                if (pick.playerName && pick.pick && pick.odds) className += ' filled';
                if (pick.result === true) className += ' win';
                else if (pick.result === false) className += ' loss';
                else if (pick.result === 'draw') className += ' draw';
            }
            div.className = className;
            
            // Determine result status and styling
            var resultClass, resultText;
            var isSubmitted = pick && pick.playerName && pick.pick && pick.odds;
            var isEditing = pick && pick.isEditing;
            
            if (pick && pick.result === true) {
                resultClass = 'win';
                resultText = 'WIN';
            } else if (pick && pick.result === false) {
                resultClass = 'loss'; 
                resultText = 'LOSS';
            } else if (pick && pick.result === 'draw') {
                resultClass = 'draw';
                resultText = 'DRAW';
            } else if (isSubmitted) {
                resultClass = 'submitted';
                resultText = '✓ SUBMITTED';
            } else {
                resultClass = 'pending';
                resultText = 'PENDING';
            }
            
            var winActive = pick && pick.result === true ? 'active' : '';
            var lossActive = pick && pick.result === false ? 'active' : '';
            var drawActive = pick && pick.result === 'draw' ? 'active' : '';
            
            var voidWarning = '';
            if (pick && pick.result === 'draw') {
                voidWarning = '<div style="background: #FF9800; color: white; padding: 8px; border-radius: 4px; margin-top: 10px; font-size: 12px; font-weight: bold;">⚠️ VOIDED LEG - Removed from parlay calculation</div>';
            }
            
            var defaultName = index < playerNames.length ? playerNames[index] : 'Pick ' + (index + 1);
            var playerName = pick && pick.playerName ? pick.playerName : defaultName;
            
            var html;
            
            if (isSubmitted && !isEditing) {
                // Truncated view for submitted picks (similar to summary page)
                var textStyle = pick.result === 'draw' ? 'text-decoration: line-through; opacity: 0.5;' : '';
                
                html = '<div style="background: linear-gradient(135deg, #4CAF50, #45a049); color: white; padding: 12px 20px; margin: -20px -20px 15px -20px; border-radius: 12px 12px 0 0; display: flex; justify-content: space-between; align-items: center;">' +
                    '<div style="display: flex; align-items: center; gap: 10px;">' +
                    '<span id="playerNameDisplay' + index + '" style="font-size: 18px; font-weight: bold;">' + playerName + '</span>' +
                    '<input type="text" id="playerNameEdit' + index + '" value="' + playerName + '" style="display: none; padding: 6px 10px; border: 2px solid white; border-radius: 4px; font-size: 16px; font-weight: bold;">' +
                    '<button onclick="toggleEditPlayerName(' + index + ')" id="editBtn' + index + '" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 14px;">✏️ Edit</button>' +
                    '</div>' +
                    '<span class="result-indicator ' + resultClass + '">' + resultText + '</span>' +
                    '</div>' +
                    '<div style="padding: 16px; ' + textStyle + '">' +
                    '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">' +
                    '<div>' +
                    '<strong>' + playerName + ':</strong> ' + pick.pick +
                    '<div style="color: #666; font-size: 13px; margin-top: 4px;">' +
                    (pick.game ? pick.game : 'No game selected') +
                    ' • <strong>' + pick.odds + '</strong>' +
                    (pick.timeSlot ? ' • <span style="color: #3b82f6; font-weight: 500;">' + pick.timeSlot + '</span>' : '') +
                    '</div>' +
                    '</div>' +
                    '<span style="background: ' + (resultClass === 'win' ? '#4CAF50' : resultClass === 'loss' ? '#f44336' : resultClass === 'draw' ? '#FF9800' : '#757575') + '; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold;">' + resultText + '</span>' +
                    '</div>' +
                    '</div>' +
                    '<div style="display: flex; gap: 8px; margin-top: 15px; align-items: center; flex-wrap: wrap; justify-content: space-between;">' +
                    '<div style="display: flex; gap: 8px;">' +
                    '<button class="result-btn win ' + winActive + '" onclick="toggleResult(' + index + ', true)">✓ Win</button>' +
                    '<button class="result-btn loss ' + lossActive + '" onclick="toggleResult(' + index + ', false)">✗ Loss</button>' +
                    '<button class="result-btn draw ' + drawActive + '" onclick="toggleResult(' + index + ', \'draw\')">🤝 Draw</button>' +
                    '<button class="result-btn reset" onclick="toggleResult(' + index + ', null)">↻ Reset</button>' +
                    '</div>' +
                    '<div style="display: flex; gap: 8px;">' +
                    '<button class="result-btn" style="background: #2196F3; color: white;" onclick="expandPickSlot(' + index + ')">✏️ Edit Pick</button>' +
                    '<button class="result-btn" style="background: #f44336; color: white;" onclick="clearIndividualPick(' + index + ')">🗑️ Clear Pick</button>' +
                    '</div>' +
                    '</div>';
            } else {
                // Full form view for unsaved picks
                html = '<div style="background: linear-gradient(135deg, #4CAF50, #45a049); color: white; padding: 12px 20px; margin: -20px -20px 15px -20px; border-radius: 12px 12px 0 0; display: flex; justify-content: space-between; align-items: center;">' +
                '<div style="display: flex; align-items: center; gap: 10px;">' +
                '<span id="playerNameDisplay' + index + '" style="font-size: 18px; font-weight: bold;">' + playerName + '</span>' +
                '<input type="text" id="playerNameEdit' + index + '" value="' + playerName + '" style="display: none; padding: 6px 10px; border: 2px solid white; border-radius: 4px; font-size: 16px; font-weight: bold;">' +
                '<button onclick="toggleEditPlayerName(' + index + ')" id="editBtn' + index + '" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 14px;">✏️ Edit</button>' +
                '</div>' +
                '<span class="result-indicator ' + resultClass + '">' + resultText + '</span>' +
                '</div>' +
                '<div class="pick-slot-fields">' +
                '<div class="pick-slot-field"><label>Pick/Bet</label><input type="text" id="pick' + index + '" value="' + (pick ? pick.pick || '' : '') + '" placeholder="Team to win, over/under" onchange="checkForChanges(' + index + ')" data-original="' + (pick ? pick.pick || '' : '') + '"></div>' +
                '<div class="pick-slot-field"><label>Odds</label><input type="text" id="odds' + index + '" value="' + (pick ? pick.odds || '' : '') + '" placeholder="-110, +200" onblur="formatOdds(' + index + ')" onchange="checkForChanges(' + index + ')" data-original="' + (pick ? pick.odds || '' : '') + '"></div>' +
                '<div class="pick-slot-field"><label>Game</label><select id="game' + index + '" onchange="updateTimeSlotFromGame(' + index + '); checkForChanges(' + index + ')" data-original="' + (pick ? pick.game || '' : '') + '"><option value="">Select Game</option>' + generateGameOptions(pick ? pick.game : '') + '</select></div>' +
                '<div class="pick-slot-field"><label>Time Slot</label><select id="timeSlot' + index + '" onchange="checkForChanges(' + index + ')" data-original="' + (pick ? pick.timeSlot || '' : '') + '"><option value="">Select</option>' +
                '<option value="TNF"' + (pick && pick.timeSlot === 'TNF' ? ' selected' : '') + '>TNF</option>' +
                '<option value="Early"' + (pick && pick.timeSlot === 'Early' ? ' selected' : '') + '>Early</option>' +
                '<option value="Late"' + (pick && pick.timeSlot === 'Late' ? ' selected' : '') + '>Late</option>' +
                '<option value="SNF"' + (pick && pick.timeSlot === 'SNF' ? ' selected' : '') + '>SNF</option>' +
                '<option value="MNF"' + (pick && pick.timeSlot === 'MNF' ? ' selected' : '') + '>MNF</option>' +
                '</select></div>' +
                '</div>' + voidWarning +
                    '<div style="display: flex; gap: 8px; margin-top: 15px; align-items: center; flex-wrap: wrap; justify-content: space-between;">' +
                    '<div style="display: flex; gap: 8px;">' +
                '<button class="result-btn win ' + winActive + '" onclick="toggleResult(' + index + ', true)">✓ Win</button>' +
                '<button class="result-btn loss ' + lossActive + '" onclick="toggleResult(' + index + ', false)">✗ Loss</button>' +
                '<button class="result-btn draw ' + drawActive + '" onclick="toggleResult(' + index + ', \'draw\')">🤝 Draw</button>' +
                '<button class="result-btn reset" onclick="toggleResult(' + index + ', null)">↻ Reset</button>' +
                    '</div>' +
                    '<div style="display: flex; gap: 8px;">' +
                    '<button class="result-btn" id="saveBtn' + index + '" style="background: #757575; color: white; cursor: not-allowed;" onclick="savePick(' + index + ')" disabled>💾 Save</button>' +
                    '<button class="result-btn" style="background: #6b7280; color: white;" onclick="cancelEditPick(' + index + ')">❌ Cancel</button>' +
                    '<button class="result-btn" style="background: #f44336; color: white;" onclick="clearIndividualPick(' + index + ')">🗑️ Clear Pick</button>' +
                    '</div>' +
                '</div>';
            }
            
            div.innerHTML = html;
            return div;
        }

        function expandPickSlot(index) {
            // Mark the pick as being edited so it shows the full form
            if (weeklyPicks[currentWeek] && weeklyPicks[currentWeek][index]) {
                weeklyPicks[currentWeek][index].isEditing = true;
                renderAllPicks();
            }
        }

        function expandSGPPickSlot(index) {
            // Mark the SGP pick as being edited so it shows the full form
            if (weeklyPicks[currentWeek] && weeklyPicks[currentWeek][index]) {
                weeklyPicks[currentWeek][index].isEditing = true;
                renderAllPicks();
            }
        }

        function cancelEditPick(index) {
            // Cancel editing mode and return to truncated view
            console.log('cancelEditPick called with index:', index);
            if (weeklyPicks[currentWeek] && weeklyPicks[currentWeek][index]) {
                console.log('Setting isEditing to false for pick:', index);
                weeklyPicks[currentWeek][index].isEditing = false;
                renderAllPicks();
            }
        }

        function cancelEditSGPPick(index) {
            // Cancel editing mode for SGP pick and return to truncated view
            console.log('cancelEditSGPPick called with index:', index);
            if (weeklyPicks[currentWeek] && weeklyPicks[currentWeek][index]) {
                console.log('Setting isEditing to false for SGP pick:', index);
                weeklyPicks[currentWeek][index].isEditing = false;
                renderAllPicks();
            }
        }

        function toggleEditPlayerName(index) {
            var display = document.getElementById('playerNameDisplay' + index);
            var edit = document.getElementById('playerNameEdit' + index);
            var btn = document.getElementById('editBtn' + index);
            
            if (edit.style.display === 'none') {
                display.style.display = 'none';
                edit.style.display = 'inline-block';
                edit.focus();
                edit.select();
                btn.textContent = '✓ Save';
            } else {
                var newName = edit.value.trim();
                if (newName) {
                    display.textContent = newName;
                    display.style.display = 'inline';
                    edit.style.display = 'none';
                    btn.textContent = '✏️ Edit';
                    
                    if (weeklyPicks[currentWeek] && weeklyPicks[currentWeek][index]) {
                        weeklyPicks[currentWeek][index].playerName = newName;
                    }
                    
                    // Check for changes after updating player name
                    checkForChanges(index);
                    updateCalculations();
                }
            }
        }

        function checkForChanges(index) {
            var pickInput = document.getElementById('pick' + index);
            var oddsInput = document.getElementById('odds' + index);
            var gameSelect = document.getElementById('game' + index);
            var timeSlotSelect = document.getElementById('timeSlot' + index);
            var playerNameDisplay = document.getElementById('playerNameDisplay' + index);
            
            if (!pickInput || !oddsInput || !gameSelect || !timeSlotSelect) return;
            
            // Get current values
            var currentPick = pickInput.value.trim();
            var currentOdds = oddsInput.value.trim();
            var currentGame = gameSelect.value;
            var currentTimeSlot = timeSlotSelect.value;
            var currentPlayerName = playerNameDisplay ? playerNameDisplay.textContent.trim() : '';
            
            // Get original values
            var originalPick = pickInput.getAttribute('data-original') || '';
            var originalOdds = oddsInput.getAttribute('data-original') || '';
            var originalGame = gameSelect.getAttribute('data-original') || '';
            var originalTimeSlot = timeSlotSelect.getAttribute('data-original') || '';
            var originalPlayerName = index < playerNames.length ? playerNames[index] : 'Pick ' + (index + 1);
            
            // Get saved player name if exists
            if (weeklyPicks[currentWeek] && weeklyPicks[currentWeek][index] && weeklyPicks[currentWeek][index].playerName) {
                originalPlayerName = weeklyPicks[currentWeek][index].playerName;
            }
            
            // Check if any values have actually changed
            var hasChanges = currentPick !== originalPick ||
                           currentOdds !== originalOdds ||
                           currentGame !== originalGame ||
                           currentTimeSlot !== originalTimeSlot ||
                           currentPlayerName !== originalPlayerName;
            
            var saveBtn = document.getElementById('saveBtn' + index);
            if (saveBtn) {
                if (hasChanges) {
                    saveBtn.disabled = false;
                    saveBtn.style.background = '#2196F3';
                    saveBtn.style.cursor = 'pointer';
                    saveBtn.textContent = '💾 Save Changes';
                } else {
                    saveBtn.disabled = true;
                    saveBtn.style.background = '#757575';
                    saveBtn.style.cursor = 'not-allowed';
                    saveBtn.textContent = '💾 Save';
                }
            }
        }

        function enableSGPSaveButton(game) {
            var input = document.querySelector('.sgp-odds-input[data-game="' + game + '"]');
            var gameId = game.replace(/[^a-zA-Z0-9]/g, '');
            var saveBtn = document.getElementById('sgpSaveBtn_' + gameId);
            
            if (!input || !saveBtn) return;
            
            var currentValue = input.value.trim();
            var originalValue = input.getAttribute('data-original') || '';
            
            var hasChanges = currentValue !== originalValue;
            
            if (hasChanges) {
                saveBtn.disabled = false;
                saveBtn.style.background = '#4CAF50';
                saveBtn.style.cursor = 'pointer';
                saveBtn.textContent = '💾 Save SGP Changes';
            } else {
                saveBtn.disabled = true;
                saveBtn.style.background = '#757575';
                saveBtn.style.cursor = 'not-allowed';
                saveBtn.textContent = '💾 Save SGP';
            }
        }

        function enableSaveButton(index) {
            // Deprecated - use checkForChanges instead
            checkForChanges(index);
        }

        function disableSaveButton(index) {
            var saveBtn = document.getElementById('saveBtn' + index);
            if (saveBtn) {
                saveBtn.disabled = true;
                saveBtn.style.background = '#757575';
                saveBtn.style.cursor = 'not-allowed';
                saveBtn.textContent = '💾 Saved';
                
                // Update the data-original attributes to current values after save
                var pickInput = document.getElementById('pick' + index);
                var oddsInput = document.getElementById('odds' + index);
                var gameSelect = document.getElementById('game' + index);
                var timeSlotSelect = document.getElementById('timeSlot' + index);
                
                if (pickInput) pickInput.setAttribute('data-original', pickInput.value);
                if (oddsInput) oddsInput.setAttribute('data-original', oddsInput.value);
                if (gameSelect) gameSelect.setAttribute('data-original', gameSelect.value);
                if (timeSlotSelect) timeSlotSelect.setAttribute('data-original', timeSlotSelect.value);
            }
        }

        function savePick(index) {
            var playerNameDisplay = document.getElementById('playerNameDisplay' + index);
            var playerName = playerNameDisplay ? playerNameDisplay.textContent.trim() : '';
            var pick = document.getElementById('pick' + index).value.trim();
            var odds = document.getElementById('odds' + index).value.trim();
            var game = document.getElementById('game' + index).value;
            var timeSlot = document.getElementById('timeSlot' + index).value;
            
            if (!playerName || !pick || !odds) {
                showNotification('Please fill in Player Name, Pick, and Odds before saving.', 'error');
                return;
            }
            
            if (!weeklyPicks[currentWeek]) {
                weeklyPicks[currentWeek] = [];
            }
            
            // Ensure it's an array (safety check)
            if (!Array.isArray(weeklyPicks[currentWeek])) {
                weeklyPicks[currentWeek] = [];
            }
            
            var pickData = {
                playerName: playerName,
                pick: pick,
                odds: odds,
                game: game,
                timeSlot: timeSlot,
                result: weeklyPicks[currentWeek][index] ? weeklyPicks[currentWeek][index].result : null,
                timestamp: Date.now(),
                isEditing: false // Clear editing flag when saving
            };
            
            while (weeklyPicks[currentWeek].length <= index) {
                weeklyPicks[currentWeek].push(null);
            }
            weeklyPicks[currentWeek][index] = pickData;
            
            // Save to Firebase
            saveToFirebase();
            
            // Show prominent save confirmation
            showNotification('Pick saved and synced to all users!', 'success');
            
            // Update UI to reflect saved state
            renderAllPicks();
            updateCalculations();
            updateParlayStatus();
            
            // Disable save button and show "Saved" state
            disableSaveButton(index);
            
            // Add a temporary blue flash to the pick slot
            var pickSlot = document.getElementById('saveBtn' + index).closest('.pick-slot');
            if (pickSlot) {
                pickSlot.style.transition = 'all 0.3s ease';
                pickSlot.style.transform = 'scale(1.02)';
                pickSlot.style.boxShadow = '0 8px 20px rgba(33, 150, 243, 0.3)';
                setTimeout(function() {
                    pickSlot.style.transform = 'scale(1)';
                    pickSlot.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.1)';
                }, 300);
            }
            
            checkForSGPs();
            updateCalculations();
            renderAllPicks();
        }

        function checkForSGPs() {
            var picks = weeklyPicks[currentWeek] || [];
            var gameGroups = {};
            
            picks.forEach(function(pick) {
                if (pick && pick.game) {
                    if (!gameGroups[pick.game]) {
                        gameGroups[pick.game] = [];
                    }
                    gameGroups[pick.game].push(pick);
                }
            });
            
            for (var game in gameGroups) {
                if (gameGroups[game].length >= 2) {
                    showNotification('🎯 SGP Auto-Detected! ' + gameGroups[game].length + ' picks for ' + game + '. Please enter SGP odds from your sportsbook.', 'warning');
                }
            }
        }

        function saveSGPOdds(game) {
            var input = document.querySelector('.sgp-odds-input[data-game="' + game + '"]');
            var sgpOdds = input ? input.value.trim() : '';
            
            if (!sgpOdds) {
                alert('Please enter the SGP odds from your sportsbook before saving.');
                if (input) input.focus();
                return;
            }
            
            var picks = weeklyPicks[currentWeek] || [];
            var updated = 0;
            picks.forEach(function(pick) {
                if (pick && pick.game === game) {
                    pick.sgpOdds = sgpOdds;
                    pick.isSGP = true;
                    updated++;
                }
            });
            
            saveToFirebase();
            showNotification('✓ SGP saved successfully for ' + game + '!', 'success');
            updateCalculations();
            renderAllPicks();
        }

        function toggleResult(index, result) {
            if (!weeklyPicks[currentWeek] || !weeklyPicks[currentWeek][index]) return;
            
            var pick = weeklyPicks[currentWeek][index];
            
            if (pick.result === result) {
                pick.result = null;
            } else {
                pick.result = result;
            }
            
            if (result === 'draw' && pick.isSGP && pick.game) {
                handleSGPVoid(pick.game);
            }
            
            // Save changes to Firebase
            saveToFirebase();
            
            updateCalculations();
            updateLeaderboardData();
            renderAllPicks();
            
            // Update parlay status when results change
            updateParlayStatus();
        }

        function handleSGPVoid(game) {
            var picks = weeklyPicks[currentWeek] || [];
            var gamePicksActive = picks.filter(function(p) { return p && p.game === game && p.result !== 'draw'; });
            
            if (gamePicksActive.length === 1) {
                picks.forEach(function(pick) {
                    if (pick && pick.game === game) {
                        pick.isSGP = false;
                        // Keep sgpOdds to display crossed out, don't set to null
                    }
                });
                showNotification('⚠️ SGP reduced to 1 leg - now a single bet at ' + gamePicksActive[0].odds, 'warning');
            } else if (gamePicksActive.length >= 2) {
                var voidedCount = picks.filter(function(p) { return p && p.game === game && p.result === 'draw'; }).length;
                showNotification('⚠️ ' + voidedCount + ' leg(s) voided from SGP. ' + gamePicksActive.length + ' legs remain. Please enter new SGP odds!', 'warning');
            }
        }

        function formatOdds(index) {
            var oddsInput = document.getElementById('odds' + index);
            if (!oddsInput) return;
            
            var oddsValue = oddsInput.value.trim();
            if (!oddsValue) return;
            
            var cleanOdds = oddsValue.replace(/[+-]/g, '');
            if (isNaN(cleanOdds) || cleanOdds === '') return;
            
            var numericOdds = parseInt(cleanOdds);
            
            if (!oddsValue.includes('+') && !oddsValue.includes('-')) {
                if (numericOdds >= 100) {
                    oddsInput.value = '+' + numericOdds;
                } else {
                    oddsInput.value = '-' + numericOdds;
                }
            } else if (oddsValue.startsWith('+') || oddsValue.startsWith('-')) {
                oddsInput.value = oddsValue.charAt(0) + numericOdds;
            }
        }

        function formatSGPOddsInput(input) {
            var oddsValue = input.value.trim();
            if (!oddsValue) return;
            
            var cleanOdds = oddsValue.replace(/[+-]/g, '');
            if (isNaN(cleanOdds) || cleanOdds === '') return;
            
            var numericOdds = parseInt(cleanOdds);
            
            if (!oddsValue.includes('+') && !oddsValue.includes('-')) {
                if (numericOdds >= 100) {
                    input.value = '+' + numericOdds;
                } else {
                    input.value = '-' + numericOdds;
                }
            } else if (oddsValue.startsWith('+') || oddsValue.startsWith('-')) {
                input.value = oddsValue.charAt(0) + numericOdds;
            }
        }

        function updateTimeSlotFromGame(index) {
            var gameSelect = document.getElementById('game' + index);
            var timeSlotSelect = document.getElementById('timeSlot' + index);
            
            if (!gameSelect || !timeSlotSelect) return;
            
            var selectedGame = gameSelect.value;
            if (!selectedGame) return;
            
            var schedule = nflSchedule[currentNFLWeek] || [];
            var game = schedule.find(function(g) {
                return g.matchup === selectedGame;
            });
            
            if (game) {
                timeSlotSelect.value = game.time;
            }
        }

        function generateGameOptions(selectedGame) {
            var schedule = nflSchedule[currentNFLWeek] || [];
            return schedule.map(function(game) {
                return '<option value="' + game.matchup + '"' + (selectedGame === game.matchup ? ' selected' : '') + '>' +
                    game.matchup + ' (' + game.time + ')' +
                    '</option>';
            }).join('');
        }

        function showNotification(message, type) {
            var colors = {
                success: '#4CAF50',
                warning: '#FF9800',
                error: '#f44336',
                info: '#2196F3'
            };
            
            var notification = document.createElement('div');
            notification.style.cssText =
                'position: fixed; top: 20px; right: 20px; background: ' + colors[type] + '; color: white; ' +
                'padding: 15px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); ' +
                'z-index: 1000; font-weight: bold; max-width: 300px;';
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(function() {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }

        function americanToDecimal(american) {
            var odds = parseFloat(american.replace('+', ''));
            if (odds > 0) {
                return (odds / 100) + 1;
            } else {
                return (100 / Math.abs(odds)) + 1;
            }
        }
        
        function decimalToAmerican(decimal) {
            if (decimal >= 2) {
                return '+' + Math.round((decimal - 1) * 100);
            } else {
                return '-' + Math.round(100 / (decimal - 1));
            }
        }

        function updateCalculations() {
            var picks = weeklyPicks[currentWeek] || [];
            var betAmount = parseFloat(document.getElementById('betAmountInput').value) || 10;
            
            var activePicks = picks.filter(function(p) { return p && p.result !== 'draw'; });
            
            var totalOdds = 1;
            var gameGroups = {};
            var processedGames = {};
            
            // First, count active picks per game
            var gamePickCounts = {};
            activePicks.forEach(function(pick) {
                if (pick.game) {
                    gamePickCounts[pick.game] = (gamePickCounts[pick.game] || 0) + 1;
                }
            });
            
            activePicks.forEach(function(pick) {
                var activeLegsForGame = pick.game ? gamePickCounts[pick.game] : 0;
                
                // If this was an SGP but now only has 1 active leg, treat as individual bet
                if (pick.isSGP && activeLegsForGame === 1) {
                    totalOdds *= americanToDecimal(pick.odds);
                }
                // If it's an SGP with 2+ active legs, use SGP odds (only once per game)
                else if (pick.isSGP && pick.sgpOdds && activeLegsForGame >= 2) {
                    if (!processedGames[pick.game]) {
                        processedGames[pick.game] = true;
                        totalOdds *= americanToDecimal(pick.sgpOdds);
                    }
                }
                // Individual bets (not SGP)
                else if (!pick.isSGP) {
                    totalOdds *= americanToDecimal(pick.odds);
                }
            });
            
            var americanOdds = decimalToAmerican(totalOdds);
            var potentialWinnings = betAmount * totalOdds;
            var grossWinnings = potentialWinnings - betAmount;
            var taxes = grossWinnings * 0.3;
            var netWinnings = grossWinnings - taxes;
            var perPerson = activePicks.length > 0 ? netWinnings / activePicks.length : 0;
            
            document.getElementById('totalOdds').textContent = americanOdds;
            document.getElementById('totalPicks').textContent = picks.filter(function(p) { return p; }).length;
            document.getElementById('betAmount').textContent = '$' + betAmount.toFixed(2);
            document.getElementById('potentialWinnings').textContent = '$' + potentialWinnings.toFixed(2);
            document.getElementById('grossWinnings').textContent = '$' + grossWinnings.toFixed(2);
            document.getElementById('taxes').textContent = '$' + taxes.toFixed(2);
            document.getElementById('netWinnings').textContent = '$' + netWinnings.toFixed(2);
            document.getElementById('perPerson').textContent = '$' + perPerson.toFixed(2);
            
            updatePicksSummary();
        }

        function updateParlayStatus() {
            var picks = weeklyPicks[currentWeek] || [];
            
            // Ensure picks is always an array
            if (!Array.isArray(picks)) {
                picks = [];
                weeklyPicks[currentWeek] = picks;
            }
            
            var statusElement = document.getElementById('parlayStatus');
            var iconElement = document.getElementById('parlayStatusIcon');
            var textElement = document.getElementById('parlayStatusText');
            
            if (!statusElement || !iconElement || !textElement) return;
            
            // Filter out null picks and draws (voided picks)
            var activePicks = picks.filter(function(pick) {
                return pick && pick.result !== 'draw';
            });
            
            // Check if any pick has lost (result === false)
            var hasLoss = activePicks.some(function(pick) {
                return pick.result === false;
            });
            
            if (hasLoss) {
                // Parlay is dead
                statusElement.style.background = 'linear-gradient(135deg, #f44336, #d32f2f)';
                iconElement.textContent = '💀';
                textElement.textContent = 'Parlay Dead';
            } else {
                // Parlay is still alive (all picks are pending, won, or voided)
                statusElement.style.background = 'linear-gradient(135deg, #4CAF50, #45a049)';
                iconElement.textContent = '💚';
                textElement.textContent = 'Parlay Still Alive';
            }
        }

        function getTimeSlotOrder(timeSlot) {
            // Define chronological order of time slots
            var timeOrder = {
                'TNF': 1,    // Thursday Night Football
                'Early': 2,   // Early Sunday games
                'Late': 3,    // Late Sunday games  
                'SNF': 4,     // Sunday Night Football
                'MNF': 5      // Monday Night Football
            };
            return timeOrder[timeSlot] || 999; // Unknown time slots go to end
        }

        function getTimeSlotDisplayName(timeSlot) {
            var displayNames = {
                'TNF': 'Thursday Night Football',
                'Early': 'Early Sunday Games (1:00 PM ET)',
                'Late': 'Late Sunday Games (4:25 PM ET)',
                'SNF': 'Sunday Night Football (8:20 PM ET)',
                'MNF': 'Monday Night Football (8:15 PM ET)'
            };
            return displayNames[timeSlot] || 'Unknown Time Slot';
        }

        function updatePicksSummary() {
            var picks = weeklyPicks[currentWeek] || [];
            
            // Ensure picks is always an array
            if (!Array.isArray(picks)) {
                picks = [];
                weeklyPicks[currentWeek] = picks;
            }
            
            var container = document.getElementById('picksSummary');
            
            if (!container) return;
            
            if (picks.filter(function(p) { return p; }).length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">No picks saved for this week</p>';
                return;
            }
            
            var gameGroups = {};
            var individualPicks = [];
            
            picks.forEach(function(pick) {
                if (!pick) return;
                
                if (pick.game) {
                    if (!gameGroups[pick.game]) {
                        gameGroups[pick.game] = [];
                    }
                    gameGroups[pick.game].push(pick);
                } else {
                    individualPicks.push(pick);
                }
            });
            
            // Sort game groups by time slot (earliest first)
            var sortedGames = Object.keys(gameGroups).sort(function(a, b) {
                var gameA = gameGroups[a][0]; // Get first pick from group to determine time slot
                var gameB = gameGroups[b][0];
                var timeOrderA = getTimeSlotOrder(gameA.timeSlot);
                var timeOrderB = getTimeSlotOrder(gameB.timeSlot);
                
                if (timeOrderA !== timeOrderB) {
                    return timeOrderA - timeOrderB;
                }
                
                // If same time slot, sort alphabetically by game name
                return a.localeCompare(b);
            });
            
            // Sort individual picks by time slot
            individualPicks.sort(function(a, b) {
                var timeOrderA = getTimeSlotOrder(a.timeSlot);
                var timeOrderB = getTimeSlotOrder(b.timeSlot);
                
                if (timeOrderA !== timeOrderB) {
                    return timeOrderA - timeOrderB;
                }
                
                // If same time slot, sort by player name
                return (a.playerName || '').localeCompare(b.playerName || '');
            });
            
            var html = '';
            
            // Combine all picks (SGP groups and individual) and sort by time slot
            var allPicksByTimeSlot = {};
            
            // Process all game groups - SGP groups (2+ picks) and individual picks (1 pick)
            for (var game in gameGroups) {
                var gamePicks = gameGroups[game];
                var firstPick = gamePicks[0];
                var timeSlot = firstPick.timeSlot || 'Unknown';
                
                if (!allPicksByTimeSlot[timeSlot]) {
                    allPicksByTimeSlot[timeSlot] = [];
                }
                
                if (gamePicks.length >= 2) {
                    // This is an SGP group
                    allPicksByTimeSlot[timeSlot].push({
                        type: 'sgp',
                        game: game,
                        picks: gamePicks
                    });
                } else {
                    // This is a single pick - treat as individual
                    allPicksByTimeSlot[timeSlot].push({
                        type: 'individual',
                        pick: firstPick
                    });
                }
            }
            
            // Add individual picks that don't have a game assigned
            individualPicks.forEach(function(pick) {
                var timeSlot = pick.timeSlot || 'Unknown';
                if (!allPicksByTimeSlot[timeSlot]) {
                    allPicksByTimeSlot[timeSlot] = [];
                }
                allPicksByTimeSlot[timeSlot].push({
                    type: 'individual',
                    pick: pick
                });
            });
            
            // Sort time slots chronologically
            var sortedTimeSlots = Object.keys(allPicksByTimeSlot).sort(function(a, b) {
                return getTimeSlotOrder(a) - getTimeSlotOrder(b);
            });
            
            var html = '';
            
            // Display picks grouped by time slot
            sortedTimeSlots.forEach(function(timeSlot) {
                var picksInSlot = allPicksByTimeSlot[timeSlot];
                
                // Add time slot header
                html += '<div style="margin-bottom: 16px;">';
                html += '<h4 style="color: #666; font-size: 14px; font-weight: 600; margin: 0 0 8px 0; padding: 8px 12px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #3b82f6;">' + 
                        getTimeSlotDisplayName(timeSlot) + '</h4>';
                
                // Display all picks in this time slot
                picksInSlot.forEach(function(item) {
                    if (item.type === 'sgp') {
                        var game = item.game;
                        var gamePicks = item.picks;
                        var firstPick = gamePicks[0];
                if (gamePicks.length >= 2) {
                    var activeLegs = gamePicks.filter(function(p) { return p.result !== 'draw'; });
                    var hasOnlyOneLeg = activeLegs.length === 1;
                    var sgpOdds = gamePicks[0].sgpOdds || 'Not Set';
                    
                    var status = 'Pending';
                    var statusColor = '#757575';
                    var results = gamePicks.map(function(p) { return p.result; });
                    
                    if (results.every(function(r) { return r === true; })) {
                        status = 'Win';
                        statusColor = '#4CAF50';
                    } else if (results.some(function(r) { return r === false; })) {
                        status = 'Loss';
                        statusColor = '#f44336';
                    } else if (results.some(function(r) { return r === 'draw'; })) {
                        status = 'Draw';
                        statusColor = '#FF9800';
                    }
                    
                    html += '<div style="border: 2px solid #FF9800; border-radius: 8px; padding: 12px; background: rgba(255, 152, 0, 0.05);">';
                    html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">';
                    html += '<strong style="color: #FF9800;">🎯 SGP: ' + game + (hasOnlyOneLeg ? ' (Single)' : '') + '</strong>';
                    html += '<span style="background: ' + statusColor + '; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold;">' + status + '</span>';
                    html += '</div>';
                    
                    if (!hasOnlyOneLeg) {
                        html += '<div style="font-weight: bold; color: #FF9800; margin-bottom: 8px;">Odds: ' + sgpOdds + '</div>';
                    }
                    
                    gamePicks.forEach(function(pick) {
                        var isVoided = pick.result === 'draw';
                        var textStyle = isVoided ? 'text-decoration: line-through; opacity: 0.5;' : '';
                        var oddsToShow = pick.odds;
                        
                        html += '<div style="' + textStyle + 'padding: 4px 0; font-size: 14px;">';
                        html += '• ' + pick.playerName + ': ' + pick.pick;
                        if (hasOnlyOneLeg && !isVoided) {
                            html += ' @ <strong>' + oddsToShow + '</strong>';
                        }
                        if (isVoided) {
                            html += ' <span style="color: #FF9800; font-weight: bold;">[VOIDED]</span>';
                        }
                        html += '</div>';
                    });
                    
                    html += '</div>';
                }
                    } else if (item.type === 'individual') {
                        var pick = item.pick;
                var status = 'Pending';
                var statusColor = '#757575';
                
                if (pick.result === true) {
                    status = 'Win';
                    statusColor = '#4CAF50';
                } else if (pick.result === false) {
                    status = 'Loss';
                    statusColor = '#f44336';
                } else if (pick.result === 'draw') {
                    status = 'Voided';
                    statusColor = '#FF9800';
                }
                
                var textStyle = pick.result === 'draw' ? 'text-decoration: line-through; opacity: 0.5;' : '';
                
                        html += '<div style="border: 2px solid #e0e0e0; border-radius: 8px; padding: 12px; background: white; margin-bottom: 8px; ' + textStyle + '">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center;">';
                html += '<div>';
                html += '<strong>' + pick.playerName + ':</strong> ' + pick.pick;
                html += '<div style="color: #666; font-size: 13px; margin-top: 4px;">';
                html += pick.game ? pick.game : 'No game selected';
                html += ' • <strong>' + pick.odds + '</strong>';
                html += '</div>';
                html += '</div>';
                html += '<span style="background: ' + statusColor + '; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold;">' + status + '</span>';
                html += '</div>';
                html += '</div>';
                    }
                });
                
                html += '</div>'; // Close time slot group
            });
            
            container.innerHTML = html;
            
            // Update parlay status after updating picks summary
            updateParlayStatus();
        }

        function updateLeaderboardData() {
            leaderboardData = {};
            
            for (var week in weeklyPicks) {
                if (!weeklyPicks[week]) continue;
                
                // Ensure weeklyPicks[week] is an array
                if (!Array.isArray(weeklyPicks[week])) {
                    weeklyPicks[week] = [];
                    continue;
                }
                
                weeklyPicks[week].forEach(function(pick) {
                    if (!pick) return;
                    if (!leaderboardData[pick.playerName]) {
                        leaderboardData[pick.playerName] = {
                            wins: 0,
                            losses: 0,
                            draws: 0,
                            contributions: 0
                        };
                    }
                    
                    if (pick.result === true) leaderboardData[pick.playerName].wins++;
                    else if (pick.result === false) leaderboardData[pick.playerName].losses++;
                    else if (pick.result === 'draw') leaderboardData[pick.playerName].draws++;
                });
            }
            
            updateLeaderboard();
        }

        function updateLeaderboard() {
            var tbody = document.getElementById('leaderboardBody');
            tbody.innerHTML = '';
            
            var players = [];
            for (var name in leaderboardData) {
                var data = leaderboardData[name];
                var total = data.wins + data.losses + data.draws;
                var winRate = total > 0 ? (data.wins / total * 100) : 0;
                
                players.push({
                    name: name,
                    wins: data.wins,
                    losses: data.losses,
                    draws: data.draws,
                    winRate: winRate,
                    contributions: data.contributions
                });
            }
            
            players.sort(function(a, b) {
                return b.winRate - a.winRate || b.wins - a.wins;
            });
            
            if (players.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #666;">No data available</td></tr>';
                return;
            }
            
            players.forEach(function(player, index) {
                var row = document.createElement('tr');
                row.innerHTML =
                    '<td>' + (index + 1) + '</td>' +
                    '<td>' + player.name + '</td>' +
                    '<td style="color: #4CAF50; font-weight: bold;">' + player.wins + '</td>' +
                    '<td style="color: #f44336; font-weight: bold;">' + player.losses + '</td>' +
                    '<td style="color: #FF9800; font-weight: bold;">' + player.draws + '</td>' +
                    '<td>' + player.winRate.toFixed(1) + '%</td>' +
                    '<td>' + player.contributions + '</td>';
                tbody.appendChild(row);
            });
        }

        function switchTab(tabName, clickedButton) {
            var tabs = document.querySelectorAll('.tab');
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            var panes = document.querySelectorAll('.tab-pane');
            for (var i = 0; i < panes.length; i++) {
                panes[i].classList.remove('active');
            }
            
            clickedButton.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'summary') {
                updateCalculations();
            } else if (tabName === 'leaderboard') {
                updateLeaderboard();
            }
        }

        function convertOdds() {
            var american = parseFloat(document.getElementById('americanOdds').value);
            if (!isNaN(american)) {
                var decimal;
                if (american > 0) {
                    decimal = (american / 100) + 1;
                } else {
                    decimal = (100 / Math.abs(american)) + 1;
                }
                document.getElementById('decimalOdds').value = decimal.toFixed(2);
                
                var impliedProb = american > 0 ? 
                    (100 / (american + 100)) * 100 : 
                    (Math.abs(american) / (Math.abs(american) + 100)) * 100;
                document.getElementById('impliedProb').value = impliedProb.toFixed(1) + '%';
            }
        }
        
        function convertFromDecimal() {
            var decimal = parseFloat(document.getElementById('decimalOdds').value);
            if (!isNaN(decimal) && decimal > 1) {
                var american;
                if (decimal >= 2) {
                    american = '+' + Math.round((decimal - 1) * 100);
                } else {
                    american = '-' + Math.round(100 / (decimal - 1));
                }
                document.getElementById('americanOdds').value = american;
                
                var impliedProb = (1 / decimal) * 100;
                document.getElementById('impliedProb').value = impliedProb.toFixed(1) + '%';
            }
        }

        function clearIndividualPick(index) {
            if (confirm('Are you sure you want to clear this pick?')) {
                if (weeklyPicks[currentWeek] && weeklyPicks[currentWeek][index]) {
                    // Clear the pick completely
                    weeklyPicks[currentWeek][index] = null;
                    
                    // Save to Firebase
                    saveToFirebase();
                    
                    showNotification('Pick cleared successfully!', 'success');
                    updateCalculations();
                    renderAllPicks();
                } else {
                    showNotification('No pick to clear at this position.', 'info');
                }
            }
        }

        function clearAllPicks() {
            if (confirm('Are you sure you want to clear all picks for this week?')) {
                weeklyPicks[currentWeek] = [];
                saveToFirebase();
                renderAllPicks();
                updateCalculations();
            }
        }

        function saveAllPicks() {
            var numberOfLegs = parseInt(document.getElementById('numberOfLegs').value);
            var newPicks = [];
            
            for (var i = 0; i < numberOfLegs; i++) {
                var playerDisplay = document.getElementById('playerNameDisplay' + i);
                var pickEl = document.getElementById('pick' + i);
                var oddsEl = document.getElementById('odds' + i);
                var gameEl = document.getElementById('game' + i);
                var timeSlotEl = document.getElementById('timeSlot' + i);
                
                if (playerDisplay && pickEl && oddsEl) {
                    var playerName = playerDisplay.textContent.trim();
                    var pick = pickEl.value.trim();
                    var odds = oddsEl.value.trim();
                    
                    if (playerName && pick && odds) {
                        newPicks.push({
                            playerName: playerName,
                            pick: pick,
                            odds: odds,
                            game: gameEl ? gameEl.value : '',
                            timeSlot: timeSlotEl ? timeSlotEl.value : '',
                            result: null
                        });
                    }
                }
            }
            
            weeklyPicks[currentWeek] = newPicks;
            saveToFirebase();
            alert('All picks saved successfully!');
            checkForSGPs();
            renderAllPicks();
            updateCalculations();
        }

        function editSGPPick(index) {
            // Use the new editing system - mark as editing and re-render
            if (weeklyPicks[currentWeek] && weeklyPicks[currentWeek][index]) {
                weeklyPicks[currentWeek][index].isEditing = true;
                renderAllPicks();
            }
        }

        function formatEditOdds(index) {
            var oddsInput = document.getElementById('editOdds' + index);
            if (!oddsInput) return;
            
            var oddsValue = oddsInput.value.trim();
            if (!oddsValue) return;
            
            var cleanOdds = oddsValue.replace(/[+-]/g, '');
            if (isNaN(cleanOdds) || cleanOdds === '') return;
            
            var numericOdds = parseInt(cleanOdds);
            
            if (!oddsValue.includes('+') && !oddsValue.includes('-')) {
                if (numericOdds >= 100) {
                    oddsInput.value = '+' + numericOdds;
                } else {
                    oddsInput.value = '-' + numericOdds;
                }
            } else if (oddsValue.startsWith('+') || oddsValue.startsWith('-')) {
                oddsInput.value = oddsValue.charAt(0) + numericOdds;
            }
        }

        function updateEditTimeSlot(index) {
            var gameSelect = document.getElementById('editGame' + index);
            var timeSlotSelect = document.getElementById('editTimeSlot' + index);
            
            if (!gameSelect || !timeSlotSelect) return;
            
            var selectedGame = gameSelect.value;
            if (!selectedGame) return;
            
            var schedule = nflSchedule[currentNFLWeek] || [];
            var game = schedule.find(function(g) {
                return g.matchup === selectedGame;
            });
            
            if (game) {
                timeSlotSelect.value = game.time;
            }
        }

        function saveEditedSGPPick(index) {
            var pick = document.getElementById('editPick' + index).value.trim();
            var odds = document.getElementById('editOdds' + index).value.trim();
            var game = document.getElementById('editGame' + index).value;
            var timeSlot = document.getElementById('editTimeSlot' + index).value;
            
            if (!pick || !odds) {
                alert('Please fill in Pick and Odds before saving.');
                return;
            }
            
            // Update the pick
            weeklyPicks[currentWeek][index].pick = pick;
            weeklyPicks[currentWeek][index].odds = odds;
            weeklyPicks[currentWeek][index].game = game;
            weeklyPicks[currentWeek][index].timeSlot = timeSlot;
            weeklyPicks[currentWeek][index].isSGP = false; // Remove from SGP first
            weeklyPicks[currentWeek][index].sgpOdds = null;
            
            showNotification('✓ Pick updated successfully!', 'success');
            checkForSGPs();
            updateCalculations();
            renderAllPicks();
        }

        function removeSGPPick(index) {
            console.log('removeSGPPick called with index:', index);
            
            if (weeklyPicks[currentWeek] && weeklyPicks[currentWeek][index]) {
                console.log('Pick exists, clearing...');
                // Clear the pick completely
                weeklyPicks[currentWeek][index] = null;
                
                console.log('Pick cleared, showing notification and refreshing...');
                showNotification('Pick removed successfully!', 'success');
                updateCalculations();
                renderAllPicks();
            } else {
                console.log('Pick does not exist or is already null');
            }
        }

        function resetLeaderboard() {
            if (confirm('Are you sure you want to reset all season stats? This cannot be undone.')) {
                leaderboardData = {};
                weeklyPicks = {};
                renderAllPicks();
                updateCalculations();
                updateLeaderboard();
            }
        }
    </script>
</body>
</html>