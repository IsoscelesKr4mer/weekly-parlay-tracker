<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantasy Football Parlay Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .tabs {
            display: flex;
            background: #f5f5f5;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            background: #e0e0e0;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            background: white;
            color: #4CAF50;
        }
        
        .tab:hover {
            background: #d5d5d5;
        }
        
        .tab.active:hover {
            background: white;
        }
        
        .tab-content {
            padding: 30px;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: block;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        
        .form-group input, .form-group select {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .pick-slot {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .pick-slot.filled {
            border-color: #4CAF50;
            background: linear-gradient(135deg, #f0f9ff, #e0f7fa);
        }
        
        .pick-slot.win {
            background: linear-gradient(135deg, #e8f5e8, #d4edda);
            border-color: #4CAF50;
        }
        
        .pick-slot.loss {
            background: linear-gradient(135deg, #fdeaea, #f8d7da);
            border-color: #f44336;
        }
        
        .pick-slot.draw {
            background: linear-gradient(135deg, #fff3e0, #ffe0b3);
            border-color: #FF9800;
        }
        
        .sgp-group {
            border: 3px solid #FF9800;
            border-radius: 15px;
            background: linear-gradient(135deg, rgba(255, 152, 0, 0.1), rgba(255, 224, 179, 0.1));
            padding: 15px;
            padding-top: 35px;
            margin-bottom: 25px;
            position: relative;
        }
        
        .sgp-group::before {
            content: "🎯 Same Game Parlay";
            position: absolute;
            top: -12px;
            left: 20px;
            background: #FF9800;
            color: white;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .pick-slot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .pick-slot-fields {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .pick-slot-field {
            display: flex;
            flex-direction: column;
        }
        
        .pick-slot-field label {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 5px;
            color: #666;
        }
        
        .pick-slot-field input,
        .pick-slot-field select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            width: 100%;
        }
        
        .result-indicator {
            font-weight: bold;
            font-size: 20px;
            padding: 8px 16px;
            border-radius: 8px;
        }
        
        .result-indicator.win {
            background: #4CAF50;
            color: white;
        }
        
        .result-indicator.loss {
            background: #f44336;
            color: white;
        }
        
        .result-indicator.draw {
            background: #FF9800;
            color: white;
        }
        
        .result-indicator.pending {
            background: #757575;
            color: white;
        }
        
        .result-buttons {
            display: flex;
            gap: 8px;
            margin-top: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .result-btn {
            padding: 10px 16px;
            font-size: 14px;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 80px;
        }
        
        .result-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .result-btn.win {
            background: #81C784;
            color: white;
        }
        
        .result-btn.win.active {
            background: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.3);
            transform: scale(1.05);
        }
        
        .result-btn.loss {
            background: #E57373;
            color: white;
        }
        
        .result-btn.loss.active {
            background: #f44336;
            box-shadow: 0 0 0 3px rgba(244, 67, 54, 0.3);
            transform: scale(1.05);
        }
        
        .result-btn.draw {
            background: #FFB74D;
            color: white;
        }
        
        .result-btn.draw.active {
            background: #FF9800;
            box-shadow: 0 0 0 3px rgba(255, 152, 0, 0.3);
            transform: scale(1.05);
        }
        
        .result-btn.reset {
            background: #757575;
            color: white;
        }
        
        .summary-card {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .summary-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
        }
        
        .summary-item h3 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }
        
        .leaderboard {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        
        .leaderboard-header {
            background: linear-gradient(135deg, #9C27B0, #7B1FA2);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .leaderboard table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .leaderboard th, .leaderboard td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .leaderboard th {
            background: #f5f5f5;
            font-weight: 600;
        }
        
        .leaderboard tr:nth-child(even) {
            background: #fafafa;
        }
        
        .week-selector {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .current-week {
            font-size: 1.2em;
            font-weight: 600;
            color: #4CAF50;
        }
        
        .odds-converter {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .odds-converter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            align-items: end;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏈 Fantasy Football Parlay Tracker</h1>
            <p>Collective Hive Mind Betting</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('picks', this)">Weekly Picks</button>
            <button class="tab" onclick="switchTab('summary', this)">Parlay Summary</button>
            <button class="tab" onclick="switchTab('leaderboard', this)">Leaderboard</button>
        </div>
        
        <div class="tab-content">
            <div id="picks" class="tab-pane active">
                <div class="week-selector">
                    <label for="nflWeek">NFL Week:</label>
                    <select id="nflWeek" onchange="updateNFLWeek()">
                        <option value="1">Week 1</option>
                        <option value="2">Week 2</option>
                        <option value="3">Week 3</option>
                        <option value="4">Week 4</option>
                        <option value="5">Week 5</option>
                        <option value="6">Week 6</option>
                        <option value="7">Week 7</option>
                        <option value="8">Week 8</option>
                        <option value="9">Week 9</option>
                        <option value="10">Week 10</option>
                        <option value="11">Week 11</option>
                        <option value="12">Week 12</option>
                        <option value="13">Week 13</option>
                        <option value="14">Week 14</option>
                        <option value="15">Week 15</option>
                        <option value="16">Week 16</option>
                        <option value="17">Week 17</option>
                        <option value="18">Week 18</option>
                    </select>
                    
                    <label for="currentWeek" style="margin-left: 30px;">Parlay Week:</label>
                    <select id="currentWeek" onchange="updateWeek()">
                        <option value="1">Week 1</option>
                        <option value="2">Week 2</option>
                        <option value="3">Week 3</option>
                        <option value="4">Week 4</option>
                        <option value="5">Week 5</option>
                        <option value="6">Week 6</option>
                        <option value="7">Week 7</option>
                        <option value="8">Week 8</option>
                        <option value="9">Week 9</option>
                        <option value="10">Week 10</option>
                        <option value="11">Week 11</option>
                        <option value="12">Week 12</option>
                        <option value="13">Week 13</option>
                        <option value="14">Week 14</option>
                        <option value="15">Week 15</option>
                        <option value="16">Week 16</option>
                        <option value="17">Week 17</option>
                        <option value="18">Week 18</option>
                    </select>
                    <div class="current-week">Parlay Week <span id="weekDisplay">1</span></div>
                    
                    <div style="margin-left: 40px; display: flex; align-items: center; gap: 15px;">
                        <label for="numberOfLegs">Parlay Legs:</label>
                        <select id="numberOfLegs" onchange="renderAllPicks()">
                            <option value="2">2 Legs</option>
                            <option value="3">3 Legs</option>
                            <option value="4">4 Legs</option>
                            <option value="5">5 Legs</option>
                            <option value="6">6 Legs</option>
                            <option value="7">7 Legs</option>
                            <option value="8">8 Legs</option>
                            <option value="9">9 Legs</option>
                            <option value="10">10 Legs</option>
                            <option value="11">11 Legs</option>
                            <option value="12" selected>12 Legs</option>
                            <option value="13">13 Legs</option>
                            <option value="14">14 Legs</option>
                            <option value="15">15 Legs</option>
                            <option value="16">16 Legs</option>
                            <option value="17">17 Legs</option>
                            <option value="18">18 Legs</option>
                            <option value="19">19 Legs</option>
                            <option value="20">20 Legs</option>
                        </select>
                    </div>
                </div>
                
                <div class="odds-converter">
                    <h3>Odds Converter</h3>
                    <div class="odds-converter-grid">
                        <div class="form-group">
                            <label>American Odds</label>
                            <input type="text" id="americanOdds" placeholder="-110" onchange="convertOdds()">
                        </div>
                        <div class="form-group">
                            <label>Decimal Odds</label>
                            <input type="text" id="decimalOdds" placeholder="1.91" onchange="convertFromDecimal()">
                        </div>
                        <div class="form-group">
                            <label>Implied Probability</label>
                            <input type="text" id="impliedProb" readonly>
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; margin-bottom: 30px;">
                    <button class="btn" onclick="saveAllPicks()">💾 Save All Picks</button>
                    <button class="btn" onclick="clearAllPicks()" style="background: #f44336;">🗑️ Clear All</button>
                </div>
                
                <div id="pickSlotsContainer"></div>
            </div>
            
            <div id="summary" class="tab-pane">
                <h2 style="margin-bottom: 20px; color: #333;">Week <span id="summaryWeek">1</span> Parlay Summary</h2>
                
                <div style="background: white; border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 15px; color: #333;">Your Picks</h3>
                    <div id="picksSummary" style="display: flex; flex-direction: column; gap: 10px;"></div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px;">
                    <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); border-left: 4px solid #4CAF50;">
                        <div style="color: #666; font-size: 14px; margin-bottom: 5px;">Total Parlay Odds</div>
                        <div id="totalOdds" style="font-size: 28px; font-weight: bold; color: #4CAF50;">+0</div>
                    </div>
                    <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); border-left: 4px solid #2196F3;">
                        <div style="color: #666; font-size: 14px; margin-bottom: 5px;">Total Picks</div>
                        <div id="totalPicks" style="font-size: 28px; font-weight: bold; color: #2196F3;">0</div>
                    </div>
                    <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); border-left: 4px solid #FF9800;">
                        <div style="color: #666; font-size: 14px; margin-bottom: 5px;">Bet Amount</div>
                        <div id="betAmount" style="font-size: 28px; font-weight: bold; color: #FF9800;">$10</div>
                    </div>
                    <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); border-left: 4px solid #9C27B0;">
                        <div style="color: #666; font-size: 14px; margin-bottom: 5px;">Potential Winnings</div>
                        <div id="potentialWinnings" style="font-size: 28px; font-weight: bold; color: #9C27B0;">$0</div>
                    </div>
                </div>
                
                <div class="form-group" style="max-width: 200px; margin-bottom: 20px;">
                    <label for="betAmountInput">Bet Amount ($)</label>
                    <input type="number" id="betAmountInput" value="10" min="1" onchange="updateCalculations()">
                </div>
                
                <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 20px; color: #333;">Payout Breakdown</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div style="padding: 15px; background: #f5f5f5; border-radius: 8px;">
                            <div style="color: #666; font-size: 14px; margin-bottom: 5px;">Gross Winnings</div>
                            <div id="grossWinnings" style="font-size: 24px; font-weight: bold; color: #333;">$0</div>
                        </div>
                        <div style="padding: 15px; background: #f5f5f5; border-radius: 8px;">
                            <div style="color: #666; font-size: 14px; margin-bottom: 5px;">Taxes (30%)</div>
                            <div id="taxes" style="font-size: 24px; font-weight: bold; color: #f44336;">$0</div>
                        </div>
                        <div style="padding: 15px; background: #f5f5f5; border-radius: 8px;">
                            <div style="color: #666; font-size: 14px; margin-bottom: 5px;">Net Winnings</div>
                            <div id="netWinnings" style="font-size: 24px; font-weight: bold; color: #4CAF50;">$0</div>
                        </div>
                        <div style="padding: 15px; background: #f5f5f5; border-radius: 8px;">
                            <div style="color: #666; font-size: 14px; margin-bottom: 5px;">Per Person (Net)</div>
                            <div id="perPerson" style="font-size: 24px; font-weight: bold; color: #2196F3;">$0</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="leaderboard" class="tab-pane">
                <div class="leaderboard">
                    <div class="leaderboard-header">
                        <h2>Season Leaderboard</h2>
                        <p>Track everyone picking performance</p>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Player</th>
                                <th>Wins</th>
                                <th>Losses</th>
                                <th>Draws</th>
                                <th>Win %</th>
                                <th>Contributions</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboardBody">
                            <tr><td colspan="7" style="text-align: center; color: #666;">No data available</td></tr>
                        </tbody>
                    </table>
                </div>
                
                <div style="margin-top: 30px;">
                    <button class="btn" onclick="resetLeaderboard()">Reset Season Stats</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <script>
        var weeklyPicks = {};
        var leaderboardData = {};
        var currentWeek = 1;
        var currentNFLWeek = 1;
        var nflSchedule = {};
        var database = null;
        
        var playerNames = [
            'Jace Allison',
            'Khaled Daher',
            'Michael Dixon',
            'Michael Hedges',
            'Elliott Kalin',
            'Brendan McAleer',
            'Nehad Osman',
            'Nick Rose',
            'Mario Sanelli',
            'Tyler Vander Boegh',
            'Jared Warren',
            'Taylor Young'
        ];

        var firebaseConfig = {
            apiKey: "AIzaSyCSen1b1IDNvRXg96CZXf9PTGURvCga3Cs",
            authDomain: "parlay-picker.firebaseapp.com",
            databaseURL: "https://parlay-picker-default-rtdb.firebaseio.com/",
            projectId: "parlay-picker",
            storageBucket: "parlay-picker.firebasestorage.app",
            messagingSenderId: "1086482831557",
            appId: "1:1086482831557:web:16e5f542a0d48e0dc538ac",
            measurementId: "G-E7F4G8DEN8"
        };

        var sampleNFLSchedule = {
            1: [
                { matchup: 'Kansas City Chiefs @ Detroit Lions', time: 'TNF' },
                { matchup: 'Buffalo Bills @ Arizona Cardinals', time: 'Early' },
                { matchup: 'Pittsburgh Steelers @ Atlanta Falcons', time: 'Early' },
                { matchup: 'Houston Texans @ Indianapolis Colts', time: 'Early' },
                { matchup: 'Miami Dolphins @ Jacksonville Jaguars', time: 'Early' },
                { matchup: 'New England Patriots @ Cincinnati Bengals', time: 'Early' },
                { matchup: 'Carolina Panthers @ New Orleans Saints', time: 'Early' },
                { matchup: 'Minnesota Vikings @ New York Giants', time: 'Early' },
                { matchup: 'Tennessee Titans @ Chicago Bears', time: 'Early' },
                { matchup: 'Los Angeles Chargers @ Las Vegas Raiders', time: 'Late' },
                { matchup: 'Denver Broncos @ Seattle Seahawks', time: 'Late' },
                { matchup: 'Green Bay Packers @ Philadelphia Eagles', time: 'Late' },
                { matchup: 'Tampa Bay Buccaneers @ Washington Commanders', time: 'Late' },
                { matchup: 'Cleveland Browns @ Dallas Cowboys', time: 'Late' },
                { matchup: 'San Francisco 49ers @ Los Angeles Rams', time: 'SNF' },
                { matchup: 'New York Jets @ Baltimore Ravens', time: 'MNF' }
            ]
        };

        window.onload = function() {
            initializeApp();
        };

        function initializeApp() {
            try {
                if (typeof firebase !== 'undefined') {
                    firebase.initializeApp(firebaseConfig);
                    database = firebase.database();
                } else {
                    console.log('Firebase not available');
                }
            } catch (error) {
                console.error('Firebase error:', error);
            }
            
            nflSchedule = sampleNFLSchedule;
            renderAllPicks();
            updateCalculations();
        }

        function updateNFLWeek() {
            currentNFLWeek = parseInt(document.getElementById('nflWeek').value);
            renderAllPicks();
        }

        function updateWeek() {
            currentWeek = parseInt(document.getElementById('currentWeek').value);
            document.getElementById('weekDisplay').textContent = currentWeek;
            document.getElementById('summaryWeek').textContent = currentWeek;
            renderAllPicks();
            updateCalculations();
        }

        function renderAllPicks() {
            var container = document.getElementById('pickSlotsContainer');
            container.innerHTML = '';
            
            var savedPicks = weeklyPicks[currentWeek] || [];
            var numberOfLegs = parseInt(document.getElementById('numberOfLegs').value);
            
            var gameGroups = {};
            savedPicks.forEach(function(pick, index) {
                if (pick && pick.game) {
                    if (!gameGroups[pick.game]) {
                        gameGroups[pick.game] = [];
                    }
                    gameGroups[pick.game].push(pick);
                }
            });
            
            var renderedSlots = {};
            
            for (var game in gameGroups) {
                if (gameGroups[game].length >= 2) {
                    var sgpDiv = createSGPGroup(game, gameGroups[game]);
                    container.appendChild(sgpDiv);
                    
                    gameGroups[game].forEach(function(pick) {
                        var index = savedPicks.indexOf(pick);
                        if (index >= 0) renderedSlots[index] = true;
                    });
                }
            }
            
            for (var i = 0; i < numberOfLegs; i++) {
                if (!renderedSlots[i]) {
                    var pick = savedPicks[i] || null;
                    var slot = createPickSlot(i, pick);
                    container.appendChild(slot);
                }
            }
        }

        function createSGPGroup(game, picks) {
            var gameId = game.replace(/[^a-zA-Z0-9]/g, '');
            var div = document.createElement('div');
            div.className = 'sgp-group';
            
            var activeLegs = picks.filter(function(p) { return p.result !== 'draw'; });
            var hasOnlyOneLeg = activeLegs.length === 1;
            
            var status = 'PENDING';
            var statusClass = 'pending';
            var results = picks.map(function(p) { return p.result; });
            
            if (results.every(function(r) { return r === true; })) {
                status = 'WIN';
                statusClass = 'win';
            } else if (results.some(function(r) { return r === false; })) {
                status = 'LOSS';
                statusClass = 'loss';
            } else if (results.some(function(r) { return r === 'draw'; })) {
                status = 'DRAW';
                statusClass = 'draw';
            }
            
            var sgpOddsStyle = hasOnlyOneLeg ? 
                'width: 120px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; text-decoration: line-through; color: #999; background: #f5f5f5;' :
                'width: 120px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;';
            
            var html = '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">' +
                '<div style="font-size: 16px; font-weight: bold; color: #FF9800;">' + game + (hasOnlyOneLeg ? ' (Single Bet)' : '') + '</div>' +
                '<span class="result-indicator ' + statusClass + '" style="font-size: 14px;">' + (hasOnlyOneLeg ? '' : 'SGP ') + status + '</span>' +
                '</div>' +
                '<div style="display: flex; justify-content: flex-end; margin-bottom: 15px;">' +
                '<div style="display: flex; align-items: center; gap: 10px; background: white; border: 2px solid #FF9800; border-radius: 8px; padding: 8px 12px;">' +
                '<label style="font-size: 14px; font-weight: bold; color: #FF9800; margin: 0;">SGP Odds' + (hasOnlyOneLeg ? ' (not used)' : '') + ':</label>' +
                '<input type="text" value="' + (picks[0].sgpOdds || '') + '" placeholder="-110, +200" data-game="' + game + '" class="sgp-odds-input" style="' + sgpOddsStyle + '" onblur="formatSGPOddsInput(this)" ' + (hasOnlyOneLeg ? 'readonly' : '') + '>' +
                '</div>' +
                '</div>';
            
            div.innerHTML = html;
            
            picks.forEach(function(pick) {
                var pickIndex = weeklyPicks[currentWeek].indexOf(pick);
                var pickDiv = createSGPPickSlot(pickIndex, pick, hasOnlyOneLeg);
                div.appendChild(pickDiv);
            });
            
            var btnDiv = document.createElement('div');
            btnDiv.style.cssText = 'text-align: center; margin-top: 15px;';
            var saveBtn = document.createElement('button');
            saveBtn.className = 'btn';
            saveBtn.style.background = '#4CAF50';
            saveBtn.textContent = '💾 Save SGP';
            saveBtn.onclick = function() {
                saveSGPOdds(game);
            };
            btnDiv.appendChild(saveBtn);
            div.appendChild(btnDiv);
            
            return div;
        }

        function createSGPPickSlot(index, pick, hasOnlyOneLeg) {
            var div = document.createElement('div');
            div.className = 'pick-slot';
            div.style.cssText = 'background: rgba(255, 152, 0, 0.05); border-color: #FFB74D; margin-bottom: 15px;';
            
            var resultClass = pick.result === true ? 'win' : pick.result === false ? 'loss' : pick.result === 'draw' ? 'draw' : 'pending';
            var resultText = pick.result === true ? 'WIN' : pick.result === false ? 'LOSS' : pick.result === 'draw' ? 'DRAW' : 'PENDING';
            
            var winActive = pick.result === true ? 'active' : '';
            var lossActive = pick.result === false ? 'active' : '';
            var drawActive = pick.result === 'draw' ? 'active' : '';
            
            var voidWarning = '';
            if (pick.result === 'draw') {
                voidWarning = '<div style="background: #FF9800; color: white; padding: 8px; border-radius: 4px; margin-top: 10px; font-size: 12px; font-weight: bold;">⚠️ VOIDED LEG - Removed from SGP calculation</div>';
            }
            
            var oddsLabel = hasOnlyOneLeg ? 'Odds' : 'Odds <span style="font-size: 10px; color: #999;">(not used in SGP)</span>';
            var oddsStyle = hasOnlyOneLeg ? 'background: white;' : 'text-decoration: line-through; color: #666; background: #f5f5f5;';
            var oddsValue = pick.odds || '';
            
            var playerName = pick.playerName || ('Pick ' + (index + 1));
            
            var html = '<div style="background: linear-gradient(135deg, #FF9800, #F57C00); color: white; padding: 12px 20px; margin: -20px -20px 15px -20px; border-radius: 12px 12px 0 0; display: flex; justify-content: space-between; align-items: center;">' +
                '<div style="display: flex; align-items: center; gap: 10px;">' +
                '<span id="playerNameDisplay' + index + '" style="font-size: 18px; font-weight: bold;">' + playerName + '</span>' +
                '<input type="text" id="playerNameEdit' + index + '" value="' + playerName + '" style="display: none; padding: 6px 10px; border: 2px solid white; border-radius: 4px; font-size: 16px; font-weight: bold;">' +
                '<button onclick="toggleEditPlayerName(' + index + ')" id="editBtn' + index + '" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 14px;">✏️ Edit</button>' +
                '</div>' +
                '<span class="result-indicator ' + resultClass + '">' + resultText + '</span>' +
                '</div>' +
                '<div class="pick-slot-fields">' +
                '<div class="pick-slot-field"><label>Pick/Bet</label><input type="text" value="' + (pick.pick || '') + '" readonly style="background: #f5f5f5;"></div>' +
                '<div class="pick-slot-field"><label>' + oddsLabel + '</label><input type="text" value="' + oddsValue + '" readonly style="' + oddsStyle + '"></div>' +
                '<div class="pick-slot-field"><label>Game</label><input type="text" value="' + (pick.game || '') + '" readonly style="background: #f5f5f5;"></div>' +
                '<div class="pick-slot-field"><label>Time Slot</label><input type="text" value="' + (pick.timeSlot || '') + '" readonly style="background: #f5f5f5;"></div>' +
                '</div>' + voidWarning +
                '<div class="result-buttons">' +
                '<button class="result-btn win ' + winActive + '" onclick="toggleResult(' + index + ', true)">✓ Win</button>' +
                '<button class="result-btn loss ' + lossActive + '" onclick="toggleResult(' + index + ', false)">✗ Loss</button>' +
                '<button class="result-btn draw ' + drawActive + '" onclick="toggleResult(' + index + ', \'draw\')">🤝 Draw</button>' +
                '<button class="result-btn reset" onclick="toggleResult(' + index + ', null)">↻ Reset</button>' +
                '</div>';
            
            div.innerHTML = html;
            return div;
        }

        function createPickSlot(index, pick) {
            var div = document.createElement('div');
            var className = 'pick-slot';
            if (pick) {
                if (pick.playerName && pick.pick && pick.odds) className += ' filled';
                if (pick.result === true) className += ' win';
                else if (pick.result === false) className += ' loss';
                else if (pick.result === 'draw') className += ' draw';
            }
            div.className = className;
            
            var resultClass = pick && pick.result === true ? 'win' : pick && pick.result === false ? 'loss' : pick && pick.result === 'draw' ? 'draw' : 'pending';
            var resultText = pick && pick.result === true ? 'WIN' : pick && pick.result === false ? 'LOSS' : pick && pick.result === 'draw' ? 'DRAW' : 'PENDING';
            
            var winActive = pick && pick.result === true ? 'active' : '';
            var lossActive = pick && pick.result === false ? 'active' : '';
            var drawActive = pick && pick.result === 'draw' ? 'active' : '';
            
            var voidWarning = '';
            if (pick && pick.result === 'draw') {
                voidWarning = '<div style="background: #FF9800; color: white; padding: 8px; border-radius: 4px; margin-top: 10px; font-size: 12px; font-weight: bold;">⚠️ VOIDED LEG - Removed from parlay calculation</div>';
            }
            
            var defaultName = index < playerNames.length ? playerNames[index] : 'Pick ' + (index + 1);
            var playerName = pick && pick.playerName ? pick.playerName : defaultName;
            
            var html = '<div style="background: linear-gradient(135deg, #4CAF50, #45a049); color: white; padding: 12px 20px; margin: -20px -20px 15px -20px; border-radius: 12px 12px 0 0; display: flex; justify-content: space-between; align-items: center;">' +
                '<div style="display: flex; align-items: center; gap: 10px;">' +
                '<span id="playerNameDisplay' + index + '" style="font-size: 18px; font-weight: bold;">' + playerName + '</span>' +
                '<input type="text" id="playerNameEdit' + index + '" value="' + playerName + '" style="display: none; padding: 6px 10px; border: 2px solid white; border-radius: 4px; font-size: 16px; font-weight: bold;">' +
                '<button onclick="toggleEditPlayerName(' + index + ')" id="editBtn' + index + '" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 14px;">✏️ Edit</button>' +
                '</div>' +
                '<span class="result-indicator ' + resultClass + '">' + resultText + '</span>' +
                '</div>' +
                '<div class="pick-slot-fields">' +
                '<div class="pick-slot-field"><label>Pick/Bet</label><input type="text" id="pick' + index + '" value="' + (pick ? pick.pick || '' : '') + '" placeholder="Team to win, over/under"></div>' +
                '<div class="pick-slot-field"><label>Odds</label><input type="text" id="odds' + index + '" value="' + (pick ? pick.odds || '' : '') + '" placeholder="-110, +200" onblur="formatOdds(' + index + ')"></div>' +
                '<div class="pick-slot-field"><label>Game</label><select id="game' + index + '" onchange="updateTimeSlotFromGame(' + index + ')"><option value="">Select Game</option>' + generateGameOptions(pick ? pick.game : '') + '</select></div>' +
                '<div class="pick-slot-field"><label>Time Slot</label><select id="timeSlot' + index + '"><option value="">Select</option>' +
                '<option value="TNF"' + (pick && pick.timeSlot === 'TNF' ? ' selected' : '') + '>TNF</option>' +
                '<option value="Early"' + (pick && pick.timeSlot === 'Early' ? ' selected' : '') + '>Early</option>' +
                '<option value="Late"' + (pick && pick.timeSlot === 'Late' ? ' selected' : '') + '>Late</option>' +
                '<option value="SNF"' + (pick && pick.timeSlot === 'SNF' ? ' selected' : '') + '>SNF</option>' +
                '<option value="MNF"' + (pick && pick.timeSlot === 'MNF' ? ' selected' : '') + '>MNF</option>' +
                '</select></div>' +
                '</div>' + voidWarning +
                '<div class="result-buttons">' +
                '<button class="result-btn" style="background: #2196F3; color: white;" onclick="savePick(' + index + ')">💾 Save</button>' +
                '<button class="result-btn win ' + winActive + '" onclick="toggleResult(' + index + ', true)">✓ Win</button>' +
                '<button class="result-btn loss ' + lossActive + '" onclick="toggleResult(' + index + ', false)">✗ Loss</button>' +
                '<button class="result-btn draw ' + drawActive + '" onclick="toggleResult(' + index + ', \'draw\')">🤝 Draw</button>' +
                '<button class="result-btn reset" onclick="toggleResult(' + index + ', null)">↻ Reset</button>' +
                '</div>';
            
            div.innerHTML = html;
            return div;
        }

        function toggleEditPlayerName(index) {
            var display = document.getElementById('playerNameDisplay' + index);
            var edit = document.getElementById('playerNameEdit' + index);
            var btn = document.getElementById('editBtn' + index);
            
            if (edit.style.display === 'none') {
                display.style.display = 'none';
                edit.style.display = 'inline-block';
                edit.focus();
                edit.select();
                btn.textContent = '✓ Save';
            } else {
                var newName = edit.value.trim();
                if (newName) {
                    display.textContent = newName;
                    display.style.display = 'inline';
                    edit.style.display = 'none';
                    btn.textContent = '✏️ Edit';
                    
                    if (weeklyPicks[currentWeek] && weeklyPicks[currentWeek][index]) {
                        weeklyPicks[currentWeek][index].playerName = newName;
                        updateCalculations();
                    }
                }
            }
        }

        function savePick(index) {
            var playerNameDisplay = document.getElementById('playerNameDisplay' + index);
            var playerName = playerNameDisplay ? playerNameDisplay.textContent.trim() : '';
            var pick = document.getElementById('pick' + index).value.trim();
            var odds = document.getElementById('odds' + index).value.trim();
            var game = document.getElementById('game' + index).value;
            var timeSlot = document.getElementById('timeSlot' + index).value;
            
            if (!playerName || !pick || !odds) {
                alert('Please fill in Player Name, Pick, and Odds before saving.');
                return;
            }
            
            if (!weeklyPicks[currentWeek]) {
                weeklyPicks[currentWeek] = [];
            }
            
            var pickData = {
                playerName: playerName,
                pick: pick,
                odds: odds,
                game: game,
                timeSlot: timeSlot,
                result: null
            };
            
            while (weeklyPicks[currentWeek].length <= index) {
                weeklyPicks[currentWeek].push(null);
            }
            weeklyPicks[currentWeek][index] = pickData;
            
            checkForSGPs();
            updateCalculations();
            renderAllPicks();
        }

        function checkForSGPs() {
            var picks = weeklyPicks[currentWeek] || [];
            var gameGroups = {};
            
            picks.forEach(function(pick) {
                if (pick && pick.game) {
                    if (!gameGroups[pick.game]) {
                        gameGroups[pick.game] = [];
                    }
                    gameGroups[pick.game].push(pick);
                }
            });
            
            for (var game in gameGroups) {
                if (gameGroups[game].length >= 2) {
                    showNotification('🎯 SGP Auto-Detected! ' + gameGroups[game].length + ' picks for ' + game + '. Please enter SGP odds from your sportsbook.', 'warning');
                }
            }
        }

        function saveSGPOdds(game) {
            var input = document.querySelector('.sgp-odds-input[data-game="' + game + '"]');
            var sgpOdds = input ? input.value.trim() : '';
            
            if (!sgpOdds) {
                alert('Please enter the SGP odds from your sportsbook before saving.');
                if (input) input.focus();
                return;
            }
            
            var picks = weeklyPicks[currentWeek] || [];
            var updated = 0;
            picks.forEach(function(pick) {
                if (pick && pick.game === game) {
                    pick.sgpOdds = sgpOdds;
                    pick.isSGP = true;
                    updated++;
                }
            });
            
            showNotification('✓ SGP saved successfully for ' + game + '!', 'success');
            updateCalculations();
            renderAllPicks();
        }

        function toggleResult(index, result) {
            if (!weeklyPicks[currentWeek] || !weeklyPicks[currentWeek][index]) return;
            
            var pick = weeklyPicks[currentWeek][index];
            
            if (pick.result === result) {
                pick.result = null;
            } else {
                pick.result = result;
            }
            
            if (result === 'draw' && pick.isSGP && pick.game) {
                handleSGPVoid(pick.game);
            }
            
            updateCalculations();
            updateLeaderboardData();
            renderAllPicks();
        }

        function handleSGPVoid(game) {
            var picks = weeklyPicks[currentWeek] || [];
            var gamePicksActive = picks.filter(function(p) { return p && p.game === game && p.result !== 'draw'; });
            
            if (gamePicksActive.length === 1) {
                picks.forEach(function(pick) {
                    if (pick && pick.game === game) {
                        pick.isSGP = false;
                        // Keep sgpOdds to display crossed out, don't set to null
                    }
                });
                showNotification('⚠️ SGP reduced to 1 leg - now a single bet at ' + gamePicksActive[0].odds, 'warning');
            } else if (gamePicksActive.length >= 2) {
                var voidedCount = picks.filter(function(p) { return p && p.game === game && p.result === 'draw'; }).length;
                showNotification('⚠️ ' + voidedCount + ' leg(s) voided from SGP. ' + gamePicksActive.length + ' legs remain. Please enter new SGP odds!', 'warning');
            }
        }

        function formatOdds(index) {
            var oddsInput = document.getElementById('odds' + index);
            if (!oddsInput) return;
            
            var oddsValue = oddsInput.value.trim();
            if (!oddsValue) return;
            
            var cleanOdds = oddsValue.replace(/[+-]/g, '');
            if (isNaN(cleanOdds) || cleanOdds === '') return;
            
            var numericOdds = parseInt(cleanOdds);
            
            if (!oddsValue.includes('+') && !oddsValue.includes('-')) {
                if (numericOdds >= 100) {
                    oddsInput.value = '+' + numericOdds;
                } else {
                    oddsInput.value = '-' + numericOdds;
                }
            } else if (oddsValue.startsWith('+') || oddsValue.startsWith('-')) {
                oddsInput.value = oddsValue.charAt(0) + numericOdds;
            }
        }

        function formatSGPOddsInput(input) {
            var oddsValue = input.value.trim();
            if (!oddsValue) return;
            
            var cleanOdds = oddsValue.replace(/[+-]/g, '');
            if (isNaN(cleanOdds) || cleanOdds === '') return;
            
            var numericOdds = parseInt(cleanOdds);
            
            if (!oddsValue.includes('+') && !oddsValue.includes('-')) {
                if (numericOdds >= 100) {
                    input.value = '+' + numericOdds;
                } else {
                    input.value = '-' + numericOdds;
                }
            } else if (oddsValue.startsWith('+') || oddsValue.startsWith('-')) {
                input.value = oddsValue.charAt(0) + numericOdds;
            }
        }

        function updateTimeSlotFromGame(index) {
            var gameSelect = document.getElementById('game' + index);
            var timeSlotSelect = document.getElementById('timeSlot' + index);
            
            if (!gameSelect || !timeSlotSelect) return;
            
            var selectedGame = gameSelect.value;
            if (!selectedGame) return;
            
            var schedule = nflSchedule[currentNFLWeek] || [];
            var game = schedule.find(function(g) {
                return g.matchup === selectedGame;
            });
            
            if (game) {
                timeSlotSelect.value = game.time;
            }
        }

        function generateGameOptions(selectedGame) {
            var schedule = nflSchedule[currentNFLWeek] || [];
            return schedule.map(function(game) {
                return '<option value="' + game.matchup + '"' + (selectedGame === game.matchup ? ' selected' : '') + '>' +
                    game.matchup + ' (' + game.time + ')' +
                    '</option>';
            }).join('');
        }

        function showNotification(message, type) {
            var colors = {
                success: '#4CAF50',
                warning: '#FF9800',
                error: '#f44336',
                info: '#2196F3'
            };
            
            var notification = document.createElement('div');
            notification.style.cssText =
                'position: fixed; top: 20px; right: 20px; background: ' + colors[type] + '; color: white; ' +
                'padding: 15px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); ' +
                'z-index: 1000; font-weight: bold; max-width: 300px;';
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(function() {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }

        function americanToDecimal(american) {
            var odds = parseFloat(american.replace('+', ''));
            if (odds > 0) {
                return (odds / 100) + 1;
            } else {
                return (100 / Math.abs(odds)) + 1;
            }
        }
        
        function decimalToAmerican(decimal) {
            if (decimal >= 2) {
                return '+' + Math.round((decimal - 1) * 100);
            } else {
                return '-' + Math.round(100 / (decimal - 1));
            }
        }

        function updateCalculations() {
            var picks = weeklyPicks[currentWeek] || [];
            var betAmount = parseFloat(document.getElementById('betAmountInput').value) || 10;
            
            var activePicks = picks.filter(function(p) { return p && p.result !== 'draw'; });
            
            var totalOdds = 1;
            var gameGroups = {};
            var processedGames = {};
            
            // First, count active picks per game
            var gamePickCounts = {};
            activePicks.forEach(function(pick) {
                if (pick.game) {
                    gamePickCounts[pick.game] = (gamePickCounts[pick.game] || 0) + 1;
                }
            });
            
            activePicks.forEach(function(pick) {
                var activeLegsForGame = pick.game ? gamePickCounts[pick.game] : 0;
                
                // If this was an SGP but now only has 1 active leg, treat as individual bet
                if (pick.isSGP && activeLegsForGame === 1) {
                    totalOdds *= americanToDecimal(pick.odds);
                }
                // If it's an SGP with 2+ active legs, use SGP odds (only once per game)
                else if (pick.isSGP && pick.sgpOdds && activeLegsForGame >= 2) {
                    if (!processedGames[pick.game]) {
                        processedGames[pick.game] = true;
                        totalOdds *= americanToDecimal(pick.sgpOdds);
                    }
                }
                // Individual bets (not SGP)
                else if (!pick.isSGP) {
                    totalOdds *= americanToDecimal(pick.odds);
                }
            });
            
            var americanOdds = decimalToAmerican(totalOdds);
            var potentialWinnings = betAmount * totalOdds;
            var grossWinnings = potentialWinnings - betAmount;
            var taxes = grossWinnings * 0.3;
            var netWinnings = grossWinnings - taxes;
            var perPerson = activePicks.length > 0 ? netWinnings / activePicks.length : 0;
            
            document.getElementById('totalOdds').textContent = americanOdds;
            document.getElementById('totalPicks').textContent = picks.filter(function(p) { return p; }).length;
            document.getElementById('betAmount').textContent = '$' + betAmount.toFixed(2);
            document.getElementById('potentialWinnings').textContent = '$' + potentialWinnings.toFixed(2);
            document.getElementById('grossWinnings').textContent = '$' + grossWinnings.toFixed(2);
            document.getElementById('taxes').textContent = '$' + taxes.toFixed(2);
            document.getElementById('netWinnings').textContent = '$' + netWinnings.toFixed(2);
            document.getElementById('perPerson').textContent = '$' + perPerson.toFixed(2);
            
            updatePicksSummary();
        }

        function updatePicksSummary() {
            var picks = weeklyPicks[currentWeek] || [];
            var container = document.getElementById('picksSummary');
            
            if (!container) return;
            
            if (picks.filter(function(p) { return p; }).length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">No picks saved for this week</p>';
                return;
            }
            
            var gameGroups = {};
            var individualPicks = [];
            
            picks.forEach(function(pick) {
                if (!pick) return;
                
                if (pick.game) {
                    if (!gameGroups[pick.game]) {
                        gameGroups[pick.game] = [];
                    }
                    gameGroups[pick.game].push(pick);
                } else {
                    individualPicks.push(pick);
                }
            });
            
            var html = '';
            
            for (var game in gameGroups) {
                var gamePicks = gameGroups[game];
                
                if (gamePicks.length >= 2) {
                    var activeLegs = gamePicks.filter(function(p) { return p.result !== 'draw'; });
                    var hasOnlyOneLeg = activeLegs.length === 1;
                    var sgpOdds = gamePicks[0].sgpOdds || 'Not Set';
                    
                    var status = 'Pending';
                    var statusColor = '#757575';
                    var results = gamePicks.map(function(p) { return p.result; });
                    
                    if (results.every(function(r) { return r === true; })) {
                        status = 'Win';
                        statusColor = '#4CAF50';
                    } else if (results.some(function(r) { return r === false; })) {
                        status = 'Loss';
                        statusColor = '#f44336';
                    } else if (results.some(function(r) { return r === 'draw'; })) {
                        status = 'Draw';
                        statusColor = '#FF9800';
                    }
                    
                    html += '<div style="border: 2px solid #FF9800; border-radius: 8px; padding: 12px; background: rgba(255, 152, 0, 0.05);">';
                    html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">';
                    html += '<strong style="color: #FF9800;">🎯 SGP: ' + game + (hasOnlyOneLeg ? ' (Single)' : '') + '</strong>';
                    html += '<span style="background: ' + statusColor + '; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold;">' + status + '</span>';
                    html += '</div>';
                    
                    if (!hasOnlyOneLeg) {
                        html += '<div style="font-weight: bold; color: #FF9800; margin-bottom: 8px;">Odds: ' + sgpOdds + '</div>';
                    }
                    
                    gamePicks.forEach(function(pick) {
                        var isVoided = pick.result === 'draw';
                        var textStyle = isVoided ? 'text-decoration: line-through; opacity: 0.5;' : '';
                        var oddsToShow = pick.odds;
                        
                        html += '<div style="' + textStyle + 'padding: 4px 0; font-size: 14px;">';
                        html += '• ' + pick.playerName + ': ' + pick.pick;
                        if (hasOnlyOneLeg && !isVoided) {
                            html += ' @ <strong>' + oddsToShow + '</strong>';
                        }
                        if (isVoided) {
                            html += ' <span style="color: #FF9800; font-weight: bold;">[VOIDED]</span>';
                        }
                        html += '</div>';
                    });
                    
                    html += '</div>';
                } else {
                    gamePicks.forEach(function(pick) {
                        individualPicks.push(pick);
                    });
                }
            }
            
            individualPicks.forEach(function(pick) {
                var status = 'Pending';
                var statusColor = '#757575';
                
                if (pick.result === true) {
                    status = 'Win';
                    statusColor = '#4CAF50';
                } else if (pick.result === false) {
                    status = 'Loss';
                    statusColor = '#f44336';
                } else if (pick.result === 'draw') {
                    status = 'Voided';
                    statusColor = '#FF9800';
                }
                
                var textStyle = pick.result === 'draw' ? 'text-decoration: line-through; opacity: 0.5;' : '';
                
                html += '<div style="border: 2px solid #e0e0e0; border-radius: 8px; padding: 12px; background: white; ' + textStyle + '">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center;">';
                html += '<div>';
                html += '<strong>' + pick.playerName + ':</strong> ' + pick.pick;
                html += '<div style="color: #666; font-size: 13px; margin-top: 4px;">';
                html += pick.game ? pick.game : 'No game selected';
                html += ' • <strong>' + pick.odds + '</strong>';
                html += '</div>';
                html += '</div>';
                html += '<span style="background: ' + statusColor + '; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold;">' + status + '</span>';
                html += '</div>';
                html += '</div>';
            });
            
            container.innerHTML = html;
        }

        function updateLeaderboardData() {
            leaderboardData = {};
            
            for (var week in weeklyPicks) {
                if (!weeklyPicks[week]) continue;
                weeklyPicks[week].forEach(function(pick) {
                    if (!pick) return;
                    if (!leaderboardData[pick.playerName]) {
                        leaderboardData[pick.playerName] = {
                            wins: 0,
                            losses: 0,
                            draws: 0,
                            contributions: 0
                        };
                    }
                    
                    if (pick.result === true) leaderboardData[pick.playerName].wins++;
                    else if (pick.result === false) leaderboardData[pick.playerName].losses++;
                    else if (pick.result === 'draw') leaderboardData[pick.playerName].draws++;
                });
            }
            
            updateLeaderboard();
        }

        function updateLeaderboard() {
            var tbody = document.getElementById('leaderboardBody');
            tbody.innerHTML = '';
            
            var players = [];
            for (var name in leaderboardData) {
                var data = leaderboardData[name];
                var total = data.wins + data.losses + data.draws;
                var winRate = total > 0 ? (data.wins / total * 100) : 0;
                
                players.push({
                    name: name,
                    wins: data.wins,
                    losses: data.losses,
                    draws: data.draws,
                    winRate: winRate,
                    contributions: data.contributions
                });
            }
            
            players.sort(function(a, b) {
                return b.winRate - a.winRate || b.wins - a.wins;
            });
            
            if (players.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #666;">No data available</td></tr>';
                return;
            }
            
            players.forEach(function(player, index) {
                var row = document.createElement('tr');
                row.innerHTML =
                    '<td>' + (index + 1) + '</td>' +
                    '<td>' + player.name + '</td>' +
                    '<td style="color: #4CAF50; font-weight: bold;">' + player.wins + '</td>' +
                    '<td style="color: #f44336; font-weight: bold;">' + player.losses + '</td>' +
                    '<td style="color: #FF9800; font-weight: bold;">' + player.draws + '</td>' +
                    '<td>' + player.winRate.toFixed(1) + '%</td>' +
                    '<td>' + player.contributions + '</td>';
                tbody.appendChild(row);
            });
        }

        function switchTab(tabName, clickedButton) {
            var tabs = document.querySelectorAll('.tab');
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            var panes = document.querySelectorAll('.tab-pane');
            for (var i = 0; i < panes.length; i++) {
                panes[i].classList.remove('active');
            }
            
            clickedButton.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'summary') {
                updateCalculations();
            } else if (tabName === 'leaderboard') {
                updateLeaderboard();
            }
        }

        function convertOdds() {
            var american = parseFloat(document.getElementById('americanOdds').value);
            if (!isNaN(american)) {
                var decimal;
                if (american > 0) {
                    decimal = (american / 100) + 1;
                } else {
                    decimal = (100 / Math.abs(american)) + 1;
                }
                document.getElementById('decimalOdds').value = decimal.toFixed(2);
                
                var impliedProb = american > 0 ? 
                    (100 / (american + 100)) * 100 : 
                    (Math.abs(american) / (Math.abs(american) + 100)) * 100;
                document.getElementById('impliedProb').value = impliedProb.toFixed(1) + '%';
            }
        }
        
        function convertFromDecimal() {
            var decimal = parseFloat(document.getElementById('decimalOdds').value);
            if (!isNaN(decimal) && decimal > 1) {
                var american;
                if (decimal >= 2) {
                    american = '+' + Math.round((decimal - 1) * 100);
                } else {
                    american = '-' + Math.round(100 / (decimal - 1));
                }
                document.getElementById('americanOdds').value = american;
                
                var impliedProb = (1 / decimal) * 100;
                document.getElementById('impliedProb').value = impliedProb.toFixed(1) + '%';
            }
        }

        function clearAllPicks() {
            if (confirm('Are you sure you want to clear all picks for this week?')) {
                weeklyPicks[currentWeek] = [];
                renderAllPicks();
                updateCalculations();
            }
        }

        function saveAllPicks() {
            var numberOfLegs = parseInt(document.getElementById('numberOfLegs').value);
            var newPicks = [];
            
            for (var i = 0; i < numberOfLegs; i++) {
                var playerDisplay = document.getElementById('playerNameDisplay' + i);
                var pickEl = document.getElementById('pick' + i);
                var oddsEl = document.getElementById('odds' + i);
                var gameEl = document.getElementById('game' + i);
                var timeSlotEl = document.getElementById('timeSlot' + i);
                
                if (playerDisplay && pickEl && oddsEl) {
                    var playerName = playerDisplay.textContent.trim();
                    var pick = pickEl.value.trim();
                    var odds = oddsEl.value.trim();
                    
                    if (playerName && pick && odds) {
                        newPicks.push({
                            playerName: playerName,
                            pick: pick,
                            odds: odds,
                            game: gameEl ? gameEl.value : '',
                            timeSlot: timeSlotEl ? timeSlotEl.value : '',
                            result: null
                        });
                    }
                }
            }
            
            weeklyPicks[currentWeek] = newPicks;
            alert('All picks saved successfully!');
            checkForSGPs();
            renderAllPicks();
            updateCalculations();
        }

        function resetLeaderboard() {
            if (confirm('Are you sure you want to reset all season stats? This cannot be undone.')) {
                leaderboardData = {};
                weeklyPicks = {};
                renderAllPicks();
                updateCalculations();
                updateLeaderboard();
            }
        }
    </script>
</body>
</html>